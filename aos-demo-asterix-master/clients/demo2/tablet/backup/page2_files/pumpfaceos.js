this.AOS=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._consoleFn=t.consoleFn||this._consoleFn,this._logLevel=t.logLevel||0,this._filter=t.filter||""}return i(e,[{key:"_consoleFn",value:function(e){console.log(e)}},{key:"consoleFn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;this._logLevel>=n&&(""===this._filter?""!==t?this._consoleFn(e+"["+t+"]"):this._consoleFn(""+e):this._filter===t&&this._consoleFn(e+"["+t+"]"))}},{key:"emergency",value:function(e,t){this.consoleFn(e,t,0)}},{key:"error",value:function(e,t){this.consoleFn(e,t,1)}},{key:"warning",value:function(e,t){this.consoleFn(e,t,2)}},{key:"info",value:function(e,t){this.consoleFn(e,t,3)}},{key:"debug",value:function(e,t){this.consoleFn(e,t,4)}},{key:"logLevel",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._logLevel=e},get:function(){return this._logLevel}},{key:"filter",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._filter=e},get:function(){return this._filter}}]),e}(),o=null;t.LogFactory=function(e){return o||(o=new s(e)),o}},function(e,t){!function(){e.exports=this.ko}()},function(e,t,n){var i,s;i=[n(0)],void 0===(s=function(e){var t=void 0;function n(){this.handlerGuid=0,this.events={}}return n.prototype={},n.prototype.on=function(e,t,n,i){return(i=i||{}).once=i.once||!1,this.events[e]||(this.events[e]={}),this.events[e][this.handlerGuid]={fn:t,scope:n,once:i.once},this.handlerGuid++},n.prototype.off=function(e,t){var n=this.events[e];if(n){for(var i in n)delete n[i]}},n.prototype.fire=function(t,n,i){e.LogFactory().debug("Events.fire():["+t+"]","core/events");var s=this.events[t];if(s)for(var o in s)this.invoke(s[o].fn,s[o].scope,n,i),s[o].once&&delete s[o]},n.prototype.invoke=function(e,t,n,i){(i=i||{}).sync?e.call(t,n):setTimeout(function(){e.call(t,n)},0)},t||(t=new n),t}.apply(t,i))||(e.exports=s)},function(e,t){!function(){e.exports=this.camelet}()},function(e,t,n){var i,s;i=[n(0),n(24)],void 0===(s=function(e,t){function n(e){this.pump=e.pump,this.handlers={}}return e.LogFactory().debug("mixins/endpoint","mixins/endpoint"),n.prototype={},n.prototype.addPulseHandler=function(e,t){this.handlers[e]=t},n.prototype.getPulseHandler=function(e){return this.handlers[e]},n.prototype.initEndpoint=function(n,i){e.LogFactory().debug("Service Mixin init()","mixins/endpoint");for(var s=[],o=[],r=0;r<i.length;r++){var a=i[r];"PumpHouse"===a.targetName?o.push({cls:a.className,list:"white"}):s.push({cls:a.className,list:"white"}),e.LogFactory().debug("Added whitelisting of ["+a.className+"] to Target ["+a.targetName+"] ","mixins/endpoint")}this.endPoint=new t({name:n,pump:this.pump,consume:s,produce:o}),this.endPoint.onPulsed(this.pulsed,this),e.LogFactory().debug("Created generic Callback Handle for ["+n+"]","mixins/endpoint")},n.prototype.pulse=function(t,n,i,s,o){e.LogFactory().debug("Endpoint.pulse("+t+")","mixins/endpoint");var r=pumpco.core.jsbean.ExchangeFacade.getInOutCommand({ns:t,refId:i,body:n,compId:s,reqId:o});e.LogFactory().debug("Endpoint.pulse(): Exchange= "+r,"mixins/endpoint"),this.endPoint.pulse(r)},n.prototype.pulseTracked=function(t,n,i,s,o){e.LogFactory().debug("Endpoint.pulse("+t+")","mixins/endpoint");var r=pumpco.core.jsbean.ExchangeFacade.getInOutCommand({ns:t,refId:i,body:n,compId:s,reqId:o,tracked:!0});e.LogFactory().debug("Endpoint.pulse(): Exchange= "+r,"mixins/endpoint"),this.endPoint.pulse(r)},n.prototype.pulsed=function(t){var n=t.getPulseClass();e.LogFactory().debug("Endpoint.pulsed("+n+")","mixins/endpoint");var i=this.getPulseHandler(n);i?i.call(this,t):e.LogFactory().debug("No handler found for class ["+n+"]","mixins/endpoint")},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(38)],void 0===(s=function(e,t){var n=void 0;function i(e){e=e||{},this._flagEnableStaticLog=void 0===e.enableStatic||e.enableStatic,this.localStorage=function(){try{var e=[t.INDEXEDDB,t.WEBSQL,t.LOCALSTORAGE];return t.config({driver:e,name:"Platform",version:1,size:10485760,storeName:"aos",description:"aos platform storage"}),"localStorage"in window&&null!==window.localStorage&&window.localStorage}catch(e){return!1}}()}return i.prototype={},i.prototype.STORE_KEY="log",i.prototype.set=function(e,t,i){if(n.localStorage)try{var s=JSON.stringify(t);n.localStorage.setItem(e,s)}catch(e){}},i.prototype.setAsync=function(e,i,s){n.localStorage&&t.setItem(e,i,s)},i.prototype.get=function(e){if(e){var t=void 0;if(n.localStorage)try{t=n.localStorage.getItem(e),t=JSON.parse(t)}catch(i){t=void 0,n.localStorage.removeItem(e)}return t}},i.prototype.getAsync=function(e,i){e&&n.localStorage&&t.getItem(e,function(e,t){i(t)})},i.prototype.getAll=function(e){var t={};if(!e)return t;for(var i in n.localStorage){if(i.indexOf(e)>=0){var s=n.localStorage.getItem(i);t[i]=s}}return t},i.prototype.del=function(e){if("*"===e)n.localStorage.clear();else for(var t in n.localStorage){t.indexOf(e)>=0&&n.localStorage.removeItem(t)}},i.prototype.delAsync=function(e){"*"===e?t.clear():localforage.iterate(function(n,i,s){i.indexOf(e)&&t.removeItem(i)},function(e){e||console.log("Iteration has completed")})},i.prototype.delAllBut=function(e,t){if(!t)return-1;for(var i=[],s=0;s<t.length;s++)i.push(e+"."+t[s]);for(var o in n.localStorage){o.indexOf(i)>=0&&-1===found&&n.localStorage.removeItem(o)}},i.prototype.log=function(e){if(this._flagEnableStaticLog){var t=this.get(this.STORE_KEY);t||(t=[]),t.length>=50&&t.shift(),t.push(function(e){function t(e){var t=""+e;return t.length<2?"0"+t:t}var n=new Date,i=t(parseInt(n.getMonth())+1),s=t(n.getDate()),o=t(n.getHours()),r=t(n.getMinutes()),a=t(n.getSeconds());return n.getFullYear()+"-"+i+"-"+s+"_"+o+":"+r+":"+a}()+" : "+e),this.set(this.STORE_KEY,t)}},n||(n=new i),n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2)],void 0===(s=function(e){var t=void 0;function n(){this._lang={},Object.defineProperty(this,"lang",{get:function(){return this._lang},set:function(e){this._lang=e}}),this._locale="en",Object.defineProperty(this,"locale",{get:function(){return this._locale},set:function(e){this._locale=e}}),e.on("user.locale.updated",this.eventLocaleUpdated,this)}return n.prototype={},n.prototype.eventLocaleUpdated=function(e){this.locale=e.value},n.prototype.resolve=function(e){var t=this._lang[this._locale];return t||(parent=this._locale.split("-")[0],t=this._lang[parent]),t&&t[e]||""},t||(t=new n),t}.apply(t,i))||(e.exports=s)},function(e,t){!function(){e.exports=this.jQuery}()},function(e,t,n){var i;void 0===(i=function(){return{clone:function(e){var t={};for(var n in e)t[n]=e[n];return t},setObjProp:function(e,t,n){var i=typeof e[n],s=typeof t[n],o=e[n]instanceof Array;s===i?e[n]=t[n]:"object"===i&&o?e[n].push(t[n]):e[n]=t[n].toString()},fromJS:function(e,t){if(the.isArray(e)){for(var n=0;n<t.length;n++){var i=this.clone(e[0]),s=t[n],o=this.fromJS(i,s);"function"==typeof e?e().push(o):e.push(o)}"function"==typeof e?e().shift():e.shift()}else for(var r in e)t[r]&&("object"==typeof t[r]?e[r]=this.fromJS(e[r],t[r]):"function"==typeof e[r]?e[r](t[r]):this.setObjProp(e,t,r)),"*"===r&&("function"==typeof e?e(t):e=t);return e}}}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i;void 0===(i=function(){var e={switches:{coreIoPulseGapTimeout:36e5,useBrowserNotifications:!0,useAppBuilder:!1},domain:{"dev.cnect.to":{useAppBuilder:!0},"pumpco.cnect.to":{}},libraries:{test:"test.js","jquery.scrollto":"node_modules/jquery.scrollintoview/jquery.scrollintoview.js",d3:"node_modules/d3/d3.min.js",graphing:"node_modules/d3/d3.min.js",redux:"node_modules/redux/dist/redux.js"},getSwitch:function(e,t){var n=void 0;return n=this.switches[e],t&&this.domain[t]&&(n=this.domain[t][e]),n},getLibraryPath:function(e){return this.libraries[e.toLowerCase()]}};return e}.apply(t,[]))||(e.exports=i)},function(e,t){!function(){e.exports=this.the}()},function(e,t,n){var i,s;i=[n(12)],void 0===(s=function(e){function t(t){t=t||{},this.id=the.generateUuid(),this.mep="InOut",this.msgIn=void 0,this.msgIn=new e({header:void 0,attachment:void 0,body:t.inBody}),this.msgOut=new e({header:void 0,attachment:void 0,body:t.outBody})}return t.prototype={},t.prototype.serialise=function(){return JSON.stringify(this)},t.prototype.deserialise=function(e){var t={};for(var n in t="string"==typeof e?JSON.parse(e):e)this[n]=t[n]},t.prototype.getMessage=function(){return this.msgIn&&this.msgIn.body?this.msgIn:this.msgOut},t.prototype.getPulseClass=function(){return this.getMessage().body.pulseHeader.pulseClass},t.prototype.getPulseHeader=function(){return this.getMessage().body.pulseHeader},t.prototype.getPulseBody=function(){return this.getMessage().body.pulseBody},t.prototype.getPulse=function(){return this.getMessage().body},t.prototype.setResponseToClass=function(e){this.getMessage().body.pulseHeader.responseToClass=e},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){function e(e){e=e||{},this.header=e.header,this.attachment=e.attachment,this.body=e.body}return e.prototype={},e.prototype.setBody=function(e){this.body=e},e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s,o;
/*!
 * @license
 * Copyright (c) 2016 Pumpco Inc.
 * JSS.js is distributed by PumpCo Inc.
 */!function(){var r=function(){};!function(a){var c=a({});s=[t,n],i=new c({analyitcs:r}),void 0===(o="function"==typeof i?i.apply(t,s):i)||(e.exports=o)}(function(e){function t(e){e=e||{},this._version="0.0.1",this._analyitcs=e.analyitcs||function(){}}return t.OBJECT=3,t.ARRAY=2,t.PRIM=1,t.prototype={},t.prototype.timer=function(){var e=Date.now();return function(){this._analyitcs({time:Date.now()-e+"ms"})}.bind(this)},t.prototype.isA=function(e){return e instanceof Object?Array.isArray(e)?t.ARRAY:t.OBJECT:t.PRIM},t.prototype.query=function(e,t){},t.prototype.direct=function(e,t){var n=this.timer(),i=this.each(t,e);return n(),i},t.prototype.each=function(e,t){var n=void 0,i=t[0],s=!1,o=void 0,r=void 0;">"===i&&(i=(t=t.slice(1,t.length))[0],s=!0),":return"===i&&(i=(t=t.slice(1,t.length))[0],o=e);var a=void 0;if(t[0]&&t[0].indexOf("=")>=0)i=(c=t[0].split("="))[0],a=c[1];else if(t[0]&&t[0].indexOf(":")>=0){var c;i=(c=t[0].split(":"))[0],a=c[1]}if(e.hasOwnProperty(i))"parent"===a&&(r=e),n=this.perItem(e,t,i,a);else if("*"===i){for(var u in e)if(n=this.perItem(e,t,u,a))break}else if(!s)for(var u in e)if(n=this.perItem(e,t,u,a,!0))break;return n&&(o&&(n=o),r&&(n.parent=r)),n},t.prototype.perItem=function(e,n,i,s,o){var r=void 0,a=e[i],c=1;switch(o&&(c=0),this.isA(a)){case t.OBJECT:r=0===n.length?a:this.each(a,n.slice(c,n.length));break;case t.ARRAY:for(var u=0;u<a.length&&!(r=this.each(a[u],n.slice(c,n.length)));u++);break;default:s?a===s&&(r=a):r=void 0}return r},t.prototype.toString=function(){return"Jss:"+this._version},t})}()},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){function t(t){this.array=e.observableArray([]),this.key=t||"id"}return t.prototype={},t.prototype.push=function(e){this.array.splice(this.array().length,0,e)},t.prototype.length=function(){return this.array().length},t.prototype.find=function(e,t){var n=this.key;t=t||function(t,s,o){return t[n]===e&&(i=t),i?-1:0};var i=void 0;return __.eachSync2(this.array(),t),i},t.prototype.indexOf=function(e,t){var n=this.key,i=-1;return t=t||function(t,s,o){return t[n]===e&&(i=s),i>-1?-1:0},__.eachSync2(this.array(),t),i},t.prototype.insert=function(e){this.array.splice(this.array().length,0,e)},t.prototype.remove=function(e){var t=this.key,n=-1;this.find(e,function(i,s,o){if(i[t]===e)return n=s,-1}),-1!==n&&this.array.splice(n,1)},t.prototype.empty=function(){this.array([])},t.prototype.data=function(){return this.array},t.prototype.splice=function(e,t,n){this.array.splice(e,t)},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){function e(e){this.name="Abstract",this.version="0.0.1",this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{}}return e.prototype={},e.prototype.extendModel=function(e,t){this.model;this.model[e]=t},e.prototype.ready=function(e){this.kernel.invoke("kernel.process.loaded",{name:e})},e.prototype.toString=function(){return this.name+":"+this.version},e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i;void 0===(i=function(){function e(){}return e.prototype={},e.getParam=function(e,t,n){var i=n,s=the.getQueryStringParam(e);return s&&(i="true"===s||"false"===s?JSON.parse(s):s),t&&t[e]&&(i=t[e]),i},e.getLocation=function(e){var t={};return e.location?(t.origin=e.location.protocol+"://"+e.location.host,t.href=e.location.protocol+"://"+e.location.host+e.location.path,t.fqdn=!0,t.host=the.loc.host):(t.origin=the.loc.getOrigin(),t.href=the.loc.getBase(),t.fqdn=!1,t.host=the.loc.host),t.pumpface=e.pumpfacePath||"",t.fixtures=e.pumpfaceFixtures||"PumpHouse/fixture/",!0===e.wrapped&&(t.fixtures=e.pumpfaceFixtures||"fixtures/"),t},e}.apply(t,[]))||(e.exports=i)},function(e,t){!function(){e.exports=this.phil}()},function(e,t,n){var i,s;i=[n(2),n(0)],void 0===(s=function(e,t){var n,i=document.addEventListener?function(e,t,n){if(e&&e.nodeName||e===window)e.addEventListener(t,n,!1);else if(e&&e.length)for(var s=0;s<e.length;s++)i(e[s],t,n)}:function(e,t,n){if(e&&e.nodeName||e===window)e.attachEvent("on"+t,function(){return n.call(e,window.event)});else if(e&&e.length)for(var s=0;s<e.length;s++)i(e[s],t,n)};function s(){this.histories=[],this.id=0,this.path="#home/",this.place="",this.space="",this._html5=!0,void 0===history.pushState?(t.LogFactory().debug("HTML5 History API NOT available","utils/history"),this._html5=!1):(t.LogFactory().debug("HTML5 History API available","utils/history"),history.pushState({id:this.id++},"",window.location.href)),i(window,"popstate",function(e){if(e.state){var i=n.histories.pop();i&&i.id===e.state.id+1&&(t.LogFactory().info(i.id+"/"+i.place.name+"/"+i.space.name,"utils/history"),e.preventDefault(),e.stopPropagation())}else t.LogFactory().warning("Back again will leave site","utils/history"),e.preventDefault(),e.stopPropagation()}),i(window,"hashchange",function(e){}),i(window,"pageshow",function(e){}),i(window,"pagehide",function(e){}),e.on("place.shown",function(e){this.placeShown(e)},this),e.on("space.shown",function(e){this.spaceShown(e)},this)}return s.prototype={},s.prototype.placeShown=function(e){this.place=e.place},s.prototype.spaceShown=function(e){this.space=e.space;var t={id:this.id++,place:{id:this.place.id,name:this.place.name},space:{id:this.space.id,name:this.space.name}};this.histories.push(t),this._html5&&history.pushState({id:t.id},"",window.location.href)},n||(n=new s),n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){var e=void 0;function t(){this.api={}}return t.prototype={},t.prototype.addApi=function(e,t,n){this.api[e]={name:e,fn:t,scope:n}},t.prototype.listApi=function(){var e="";for(var t in this.api)e+=t+", ";return e},t.prototype.run=function(e,t,n){if(this.api[e]){var i=this.api[e];if(!i)return;var s=void 0;if(s=i.fn?i.fn.call(i.scope,t):void 0,!n)return s;n(s)}},e||(e=new t),e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(11),n(21)],void 0===(s=function(e,t){function n(){}return n.getExchange=function(n){var i=new t({componentId:n.componentId,mep:n.mep,pulseBody:n.pulseBody,pulseClass:n.pulseClass,pulseType:n.pulseType,referenceId:n.referenceId||the.generateUuid(),requestingComponentId:n.requestingComponentId,tracked:n.tracked}).envelope;return new e({inBody:i})},n.getInOut=function(e){return this.getExchange({componentId:e.compId,mep:t.INOUT,pulseBody:e.body,pulseClass:e.ns,pulseType:e.type,referenceId:e.refId,requestingComponentId:e.reqId,tracked:e.tracked})},n.getInOutCommand=function(e){return this.getInOut({compId:e.compId,body:e.body,ns:e.ns,type:t.COMMAND,refId:e.refId,reqId:e.reqId,tracked:e.tracked})},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){function e(t){t=t||{},this.envelope={},this.envelope.pulseHeader={},this.envelope.pulseHeader.pulseId=the.generateUuid(),this.envelope.pulseHeader.referenceId=t.referenceId?t.referenceId:"00000001-0001-4000-0001-000000000001",this.envelope.pulseHeader.mep=t.mep?t.mep:e.INOUT,this.envelope.pulseHeader.timestamp=the.formatDateTime(the.dateTime()),this.envelope.pulseHeader.pulseType=t.pulseType?t.pulseType:e.COMMAND,this.envelope.pulseHeader.pulseResponseTimeout=t.pulseTimeout?t.pulseTimeout:"5000",this.envelope.pulseHeader.pulseClass=t.pulseClass?t.pulseClass:"",t.componentId&&(this.envelope.pulseHeader.componentId=t.componentId),t.requestingComponentId&&(this.envelope.pulseHeader.requestingComponentId=t.requestingComponentId),t.tracked&&(this.envelope.pulseHeader.tracked=t.tracked),this.envelope.pulseBody=t.pulseBody?t.pulseBody:{}}return e.IN="in",e.INOUT="inOut",e.OUT="out",e.COMMAND="command",e.DOCUMENT="document",e.EVENT="event",e.prototype={},e.prototype.setComponentId=function(e){this.envelope.pulseHeader.componentId=e},e.prototype.setResponseToClass=function(e){this.envelope.pulseHeader.responseToClass=e},e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(23),n(3)],void 0===(s=function(e){function t(t){return new e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2),n(0),n(20),n(11),n(3)],void 0===(s=function(e,t,n,i){var s=function(e){var s={};return s.capabilities={consume:e.consume||[{cls:""}],produce:e.produce||[{cls:""}]},s.context="/pumpco/cog",s.inEp=void 0,s.name=e.name,s.outEp=void 0,s.pump=e.pump,s._onPulsed=void 0,s.connect=function(e,t){s.outEp=camelet.Endpoint({name:s.name+"-Out",scheme:"pulse",context:e,options:t.produce}),s.inEp=camelet.Endpoint({name:s.name+"-In",scheme:"pulse",context:e,options:t.consume,listeners:[{fn:s.pulsed,scope:s}]});var n=s.pump.registerConsumer(s.outEp),i=s.pump.registerProducer(s.inEp);return!(!n||!i)},s.pulse=function(e){e.getPulseClass();var t=e.getPulseHeader(),n=e.getPulseBody(),i=new camelet.Message({body:{pulseHeader:{componentId:t.componentId,requestingComponentId:t.requestingComponentId,mep:"inout",pulseClass:t.pulseClass,pulseId:t.pulseId,pulseResponseTimeout:t.pulseResponseTimeout,pulseType:t.pulseType,referenceId:t.referenceId,timestamp:t.timestamp,tracked:t.tracked},pulseBody:n}}),s=new camelet.Exchange;s.setMessage(i),this.outEp.send(s)},s.onPulsed=function(e,t){s._onPulsed={fn:e,scope:t}},s.pulsed=function(e){var o=e.getMessage().getBody(),r=n.getInOutCommand({ns:o.pulseHeader.pulseClass,body:o.pulseBody,compId:o.pulseHeader.componentId,refId:o.pulseHeader.referenceId,reqId:o.pulseHeader.requestingComponentId});if(o.pulseHeader.responseToClass&&r.setResponseToClass(o.pulseHeader.responseToClass),r.msgOut=r.msgIn,s._onPulsed){var a=r.serialise();if(the.cssFeature(["boxShadow"]))!function(e){setTimeout(function(){var t=new i({});t.deserialise(e),s._onPulsed.fn.call(s._onPulsed.scope,t)},0)}(a);else{var c=new i({});c.deserialise(a),s._onPulsed.fn.call(s._onPulsed.scope,c)}}else t.LogFactory().warning("Attempted to call _onPulsed, but no function registered ["+s.name+"]","core/io/shims/shim")},s.connect(s.context,s.capabilities),s};function o(e){return s(e)}return o.prototype={},o}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(23),n(3)],void 0===(s=function(e){function t(t){return new e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(8)],void 0===(s=function(e,t){function n(e,t){for(var n=0;n<e.length;n++)if(e[n].id===t)return!0;return!1}function i(){this.icon="",this.id="",this.name="",this.label="",this.description="",this.initialSpace=[],this.owner={id:"",fn:""},this.space=[{id:"",name:""}],this.customisation={"*":"*"},this.ns="pumpCo.user.place.request",this.parentId="",this.oVisible=e.observable(!1),this.ownersPlace=!1,this.contactCompId=void 0,this.hash=""}return i.compare=function(e,t){return e instanceof i&&t instanceof i&&e.hash===t.hash},i.prototype={},i.prototype.getContactsApp=function(e){if(e&&e.space){for(var t=void 0,n=e.space,i=0;i<n.length;i++){var s=n[i].component;if(!s)break;for(var o=0;o<s.length;o++){if("ContactBook"===__get("params.appName",s[o])){t=s[o];break}}if(t)break}t&&(this.contactCompId=t.id)}},i.prototype.getPulseBody=function(){return{place:{ownerId:this.owner.id||"",name:this.name}}},i.prototype.update=function(e){var i={deleted:[],updated:[]};if(t.fromJS(this,e),this.getContactsApp(e),e.space)for(var s=this.space.length;s>0;s--){var o=this.space[s-1];n(e.space,o.id)?i.updated.push(o.id):(this.space.splice(s,1),i.deleted.push(o.id))}return function(e){var t=[];t.push(e.id),t.push("-"),t.push(e.space.length),e.hash=t.join("")}(this),i},i.prototype.getType=function(){return"place"},i}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(8)],void 0===(s=function(e,t){function n(){this.description="",this.icon="",this.id="",this.label="",this.lang={"*":"*"},this.layout={"*":"*"},this.name="",this.params={"*":"*"},this.component=[{id:""}],this.parentId="",this.oVisible=e.observable(!1),this.added=0,this.oBackground=e.observable(""),this.oEditMode=e.observable(!1)}return n.prototype={},n.prototype._nestedI18n=function(e,t,n){if(!t||!n)return e;var i=t[n];if(i&&i[e])return i[e];var s=n.substring(0,n.indexOf("-"));return""===s?e:this._nestedI18n(e,t,s)},n.prototype.i18n=function(e){this.description=this._nestedI18n(this.description,this.lang,e),this.label=this._nestedI18n(this.label,this.lang,e)},n.prototype.update=function(e){t.fromJS(this,e)},n.prototype.editMode=function(e){this.oEditMode(e||!1)},n.prototype.each=function(e){for(var t=0;t<this.component.length;t++)e.call(this,t,this.component[t])},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(10),n(8),n(28),n(66),n(67)],void 0===(s=function(e,t,n,i,s,o){function r(){this.capability=[{"*":"*"}],this.cogType="",this.componentType="",this.description="",this.html="",this.htmlUrl="",this.icon="",this.id="",this.label="",this.lang={"*":"*"},this.langUrl="",this.layout={"*":"*"},this.name="",this.params={"*":"*"},this.permission={"*":"*"},this.script="",this.scriptUrl=[{"*":"*"}],this.state={"*":"*"},this.style="",this.styleUrl="",this.template="",this.cards=[],this.parentId="",this.booted=!1,this.repaint=e.observable(!0),this.isValid=!0,this.oVisible=e.observable(!1),this.oOrder=e.observable(""),this.oEditMode=e.observable(!1),__mixin(this,i),__mixin(this,s),__mixin(this,o)}return r.DEFAULT_SCRIPT="the.App.onReady(function() {}); ",r.DEFAULT_HTML="\x3c!-- --\x3e",r.prototype={},r.prototype.update=function(e){n.fromJS(this,e),this.capability.push({direction:"CONSUMER",trait:"pumpco.system.core.cog",version:"0.1"}),the.isArray(e.script)&&(this.script=e.script.join("\n")),the.isArray(e.html)&&(this.html=e.html.join("\n")),the.isArray(e.style)&&(this.style=e.style.join("\n"));var t,i=!0;""!==this.html&&this.html!==r.DEFAULT_HTML||(t=!1);var s=this.html.indexOf("<body");if(s>-1){this.html=this.html.substring(s+5);var o=this.html.indexOf(">"),a=this.html.indexOf("</body");this.html=this.html.substring(o+1,a)}""!==this.script&&this.script!==r.DEFAULT_SCRIPT||(i=!1),t||i||(this.isValid=!1),e.cards&&e.cards.length>=1&&(this.cards=e.cards),this.oOrder(e.order),this.params.baseUrl=this.params.baseUrl||"",this.params.location=this.params.location||{},this.params.fqdn=this.params.fqdn||!1,this.params.fullPath=this.params.fqdn?this.params.baseUrl+this.params.basePath:this.params.basePath},r.prototype.editMode=function(e){this.oEditMode(e||!1)},r.prototype.getCapabilities=function(){for(var e=[],t=0;t<this.capability.length;t++)this.capability[t].hasOwnProperty("name")&&e.push(this.capability[t]);return e},r.prototype.getPulseRegistrations=function(){for(var e=[],t=0;t<this.capability.length;t++)this.capability[t].hasOwnProperty("direction")&&e.push(this.capability[t]);return e},r}.apply(t,i))||(e.exports=s)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(0),__webpack_require__(19),__webpack_require__(12),__webpack_require__(11),__webpack_require__(29),__webpack_require__(64),__webpack_require__(65),__webpack_require__(17)],__WEBPACK_AMD_DEFINE_RESULT__=function(config,Log,invoke,Message,Exchange,RoadieUrl,Notify,VueShim){var My={boot:function(e){return this.initEndPoint(e.pump),this.createClosure(e.place,e.space,e.user,e.platform,e.contacts,e.store,e.location,e.jss,e.runtime,e.network,e.environment,e.cogParams,e.libraries),this},deboot:function(){for(var e=Object.keys(this.my),t=$(e).not(this.my._preKeys).get(),n=0;n<t.length;n++){var i=t[n];this.my[i]=void 0}phil.unbind(this.my.id),this.deinitEndPoint()},reboot:function(cog){var my=this.my,params=this.params;my.script=cog.script,my.html=cog.html,eval(this.my.script)},createClosure:function(e,t,n,i,s,o,r,a,c,u,l,p,d){var h=this.params||{};for(var m in p)h[m]=p[m];h.page=window.params,h.location=r,h.place={customisation:__get("place.customisation")||void 0};var f=this.my={};for(var m in f.id=this.id,f.name=this.name,d)m===VueShim.match&&VueShim.setup(f,d[m]);return f.cards=this.cards,f=this.addMyAble(f),f=this.addMyAttributes(f,n,c,r,l),f=this.addMyI18n(f,n),f=this.addMyLogging(f),f=this.addMyMVVM(f),f=this.addMyPump(f,h),f=this.addServices(f,e,t,i,h),f=this.addMyStartup(f,h,u),f=this.addMyUi(f,r),f=this.addMyViewport(f),f=this.addMyContacts(f,s),f=this.addMyStore(f,o,a),f=this.addMyUtils(f,h),f=this.addMyDate(f),h&&h.debug&&(this.script=this.addDebugger(this.script)),this.script=this.addTryCatch?this.addTryCatch(this.script,h.useStrict):this.script,f._preKeys=[],f._preKeys=Object.keys(f),this.runSystemEval(this.script,f,h,d),f},runSystemEval:function(script,my,params,libraries){return My=void 0,log=void 0,this.cogType&&"platform"!==this.cogType.toLowerCase()&&"user"!==this.cogType.toLowerCase()?eval(script):this.runPlatformEval(this.script,my,params,libraries),this},runPlatformEval:function(script,my,params,libraries){var $=function(){console.log("$ usage not allowed directly. try my.$ instead.")};return this.cogType&&"user"!==this.cogType.toLowerCase()?eval(script):this.runUserEval(this.script,my,params,libraries),this},runUserEval:function(script,my,params,libraries){return eval(script),this},addMyAble:function(e){return e.$able=function(e){var t={none:0,subscribe:1,visit:2,comment:4,edit:8,proxy:16,owner:16},n=this.attrs.permission.level;return e?t[e]<=t[n]:n},e},addMyAttributes:function(e,t,n,i,s){var o=e._attrs=e.attrs={};if(this.bean){var r=bean.getParent();o.parentName=r.getName(),o.parentId=r.getId()}var a=__get("location.locale.value",t);return o.locale=a||"en",o.help=this.help||"<h1>No help specified</h1>",o.lang=__clone(this.lang),o.layout=this.layout||{},o.layout.version||(o.layout.version=2),o.url=this.roadieUrl,o.state,e.state=this.state||void 0,o.data=this.data||{},o.user=t,o.runtime=n,o.environment=s,o.pumpface=i.pumpface,o.fixtures=i.fixtures,o.authToken=function(){return invoke.run("io.authToken.get",{})},o.permission={level:this.permission?this.permission.level:"none"},e},addMyEnvironment:function(e){return e.environment=this.environment||{},e.environment.version=this.version,e},addMyI18n:function(e,t){var n=e;n._lang=this.lang;var i=__get("location.locale.value",t);return n._locale=i?i.toLowerCase():"en",n._nestedI18n=function(e,t,n){var i=t[n];if(i&&i[e])return i[e];var s=n.substring(0,n.indexOf("-"));return""===s?e:this._nestedI18n(e,t,s)},n.i18n=function(e){return n._nestedI18n(e,this.attrs.lang,this.attrs.locale)},n.$i18n=function(e){return n._nestedI18n(e,this.attrs.lang,this.attrs.locale)},n.$lang=function(e,t){var n=(e=e||this._lang)[t=t||this._locale];if(n)return n;var i=t.substring(0,t.indexOf("-"));return i?this.$lang(e,i):{}},e},addMyLogging:function(e){return e.logDebug=function(e){Log.LogFactory().debug(e,this.id)},e.logInfo=function(e){Log.LogFactory().info(e,this.id)},e.logError=function(e){Log.LogFactory().error(e,this.id)},e.$notifyPermission=function(e,t){!0===config.switches.useBrowserNotifications&&(window.Notify?Notify.requestPermission(e,t):Log.LogFactory().emergency("ERROR: Notify not available. Enable (notifyjs) for enivronment",this.id))},e.$notify=function(e,t){!0===config.switches.useBrowserNotifications&&(window.Notify&&new Notify(e,t).show())},e.$alert=function(e){if(!e)return-1;e.pulseHeader&&e.pulseBody?this.$pulse("internal.system.toast.update",{message:e.pulseBody.status.message}):this.$pulse("internal.system.toast.update",{message:e})},e.$debug=function(e){Log.LogFactory().debug(e,this.id)},e.$info=function(e){Log.LogFactory().info(e,this.id)},e.$error=function(e){Log.LogFactory().error(e,this.id)},e.$emergency=function(e){Log.LogFactory().emergency(e,this.id)},e},addMyMVVM:function(e){return e.bind=function(e){phil.bind(e,this.id),Log.LogFactory().debug("my.bind has been deprecated. Please use my.$bind.",this.id)},e.$bind=function(e){phil.bind(e,this.id)},e.$unbind=function(){phil.unbin(this.id)},e.$model=function(){return phil.Model()},e._navto=[],e.$navto=function(e,t){var n=e;if("back"===e)(i=this._navto[this._navto.length-2])?(this._navto.splice(this._navto.length-1,1),n=i):(this._navto=[e],n="home");else if("$last"===e){var i;n=i=this._navto[this._navto.length-1]}else"home"===e?this._navto=[e]:this._navto.push(e);phil.goTo(this.id,n);var s={name:n};return __mixin(s,t),this.$fire("my.navto",s),n},e.$reveal=function(e){phil.reveal(this.id,e)},e},addMyPump:function(e,t){var n=e;return n._pump={_id:this.id,_endpoint:this.endPoint,pulse:function(e){e.getMessage().body.pulseHeader.componentId=this._id,this._endpoint.pulse(e)},create:function(e,t,i){i=i||{};var s={ns:e,body:t,compId:n.id};return i.refId&&(s.refId=i.refId),pumpco.core.jsbean.ExchangeFacade.getInOutCommand(s)},send:function(e,t,n){var i=this.create(e,t,n);this._endpoint.pulse(i)},onPulsed:function(e,t){this._endpoint.onPulsed(e,t)}},n.$pulseAs=function(e,t,i,s){if(!e)return-1;s=s||{};var o=n._pump.create(t,i,s),r=JSON.stringify(o.getMessage().body);i={actor:{id:e},payload:JSON.parse(r)};n._pump.send("pumpCo.user.forward.request",i)},n.$pulse=function(e,i,s){s=s||{},n.$debug(">"+e);for(var o=t.mocks||[],r=void 0,a=0;a<o.length;a++)o[a].request===e&&(r=o[a]);if(void 0!==r){var c="/PumpHouse/fixture"+r.url;console.log("requesting:"+c),$.ajax({url:c,dataType:"json"}).done(function(e){console.log("loaded mock:"+c),n.$fire(r.response,e)}).error(function(e){console.log(e)})}else s.uid?n.$pulseAs(s.uid,e,i,s):n._pump.send(e,i,s)},n.$pulsed=function(e,t){n._pump.onPulsed(e,t)},n._events={},n.$on=function(e,t,i){n._events[e]=n._events[e]||[];var s={name:e,fn:t,scope:i,guid:the.generateUuid()};return n._events[e].push(s),s.guid},n.$once=function(e,t,i){n._events[e]=n._events[e]||[];var s={name:e,fn:t,scope:i,guid:the.generateUuid(),once:!0,found:[]};return n._events[e].push(s),s.guid},n.$off=function(e){},n.$fire=function(e,t){var i=n._events[e];if(i)for(var s=0;s<i.length;s++){var o=void 0;(o=i[s].once?i.splice(s,1)[0]:i[s])&&o.fn.call(o.scope||this,t)}},n.$ajax=function(e,t){e=e||{};var i=invoke.run("io.authToken.get",{});e.authToken=i;var s=$.ajax(e);s.done(function(t){var i={data:this.data,response:t,status:200};n.$fire(e.name,i)}),s.fail(function(t,i){var s={data:this.data,response:t.responseText,status:t.status};n.$fire(e.name,s)})},e},addServices:function(e,t,n,i,s){var o=e;return o._place=t,o._space=n,o._platform=i,o.$platform=function(){return o._platform},o.$place=function(){return o._place},o.$space=function(){return o._space},o.$hold=function(e,t){t._key=e;var n={key:e,package:t};o.$pulse("pumpCo.roadie.hold.request",n)},o.$release=function(e,t){t=t||!0,o.$pulse("pumpCo.roadie.release.request",{key:e,clear:t})},o.$roadie={},o.$roadie.parse=RoadieUrl.parse,o.$roadie.generate=RoadieUrl.generate,o.$roadie.queryStringToObject=RoadieUrl.queryStringToObject,o.$roadie.objectToQueryString=RoadieUrl.objectToQueryString,o.$roadie.getType=RoadieUrl.getType,o.$roadie.parseExternal=RoadieUrl.parseExternal,o.$roadie.createPack=function(){var e={};if(!s.roadie)return e;if(!s.roadie.set||!s.roadie.params)return e;e.set=s.roadie.set,e.body={};for(var t=0;t<s.roadie.params.length;t++){var n=s.roadie.params[t],i=void 0;if(n.val.indexOf("my.")>-1){var r=n.val.substring(n.val.indexOf("my.")+3);i=__get(r,o)}if(n.val.indexOf("params.")>-1){r=n.val.substring(n.val.indexOf("params.")+7);i=__get(r,s)}void 0!==i&&(e.body[n.name]=i)}return e}.bind(o),o.$roadie.release=o.$release,o.$roadie.hold=o.$hold,o.$copy=function(e,t){if(!e||!t)return-1;o.$pulse("internal.clipboard.copy.request",{type:t,obj:e})},o.$paste=function(){o.$pulse("internal.clipboard.paste.request",{})},o},addMyViewport:function(e){var t=e;return t.viewport={},t},addMyUi:function(e){var t=e;return t.$=function(e){return e?$("#"+t.id).find(e):$("#"+t.id)},t.$resolveHtml=function(){phil.resolveHtml()},t.$getPageProperty=function(e){return __get(e)},t.$consoleApi=function(e,t){console.log("$consoleApi ["+e+"]");var n=window.aos;n&&n.action&&(n.action[this.id]=n.action[this.id]||{},n.action[this.id][e]=t)},t._resolveCard=function(e){return phil.pathFor(e)},t.$spa=function(e){!0===(e=e||!1)?invoke.run("header.hide",{}):invoke.run("header.show",{})},t},addMyContacts:function(e,t){var n=e;return n.$contacts=phil.model.ContactList({id:"uid",label:"nickname",multi:!1}),n.$contacts.loadFromPulse=function(e){var t={};t=e.getPulseBody?e.getPulseBody():e.pulseBody,n.$contacts.clear(),n.$contacts.load(t.contacts)},n.$contacts.loadDefault=function(){n.$contacts.load(t.contacts)},n},addMyStartup:function(e,t,n){var i=e;n=n;i._unwrapExchange=!!t.unwrapExchange;var s=function(){for(var e=this.getCapabilities(),t="knockout",n=0;n<e.length;n++)"Vue"===e[n].name&&(t="vue");return t}.bind(this);return i._cards={},i.$card=function(e){var t=this._resolveCard(e);return t?(t.status=this._cards[e],t):""},i._requestCards=function(){function e(e,t){this._cards[o]=1,$.ajax({url:t,context:this}).done(function(t,n,s){eval.call(this,t),this._cards[e]=0,i.$fire("postCardCreate",{name:o,status:0})}.bind(this)).fail(function(t,n,i){this._cards[e]=-1}.bind(this))}var n=[];if(i.cards.length&&i.cards.length>=0&&(n=i.cards),t.cards&&t.cards.length>=0&&(n=t.cards),0===n.length)return-1;for(var s=0;s<n.length;s++){var o=n[s].name,r=i._resolveCard(o);e.call(this,o,r.js)}},i._createModel=function(){i.model=i.$model(),i.model._waitingOnResponse=phil.observe(!1),i.model._waitingOnListResonse=i.model._waitingOnResponse,i.model._hidden=phil.observe(!1),i.model.oProgress=phil.model.Progress({value:"",progress:100}),i.model.uiState=phil.observe(0),i.model.isOs2=!0,i.model.i18nLoad(i.$lang()),i.$fire("postModelCreate",{})},i._chainedCallback=void 0,i._pulseResponses={},i.$addChainedHandler=function(e){i._chainedCallback=e},i._pulseHandler=function(e){if("pumpCo.user.forward.response"===(o=e.getPulseClass())){var t=e.getPulseBody().payload;if(!t)return-1;var n=new Message({body:t}),s=new Exchange({inBody:n.body}),o=s.getPulseClass(),r=s;i._unwrapExchange&&(r=s.getPulse()),i.$fire(o,r)}else{r=e;i._unwrapExchange&&(r=e.getPulse()),i.$fire(o,r)}},i._hidden=function(){i.$fire("postHidden",{})},i._resumed=function(e){e=e||{},i.$fire("postResume",e)},i._shown=function(e){e=e||{},i.$fire("postShown",e)},i._systemCoreCogPulseHandler=function(e){var t=void 0;"resumed"===(t=e&&e.pulseHeader&&e.pulseBody?e.pulseBody:e&&e.getPulseBody?e.getPulseBody():{}).state?i._resumed(t):"visible"===t.visibility?i._shown(t):"hidden"===t.visibility&&i._hidden(t)},i.$uninit=function(){i.$unbind()},i.$init=function(){var e=s();"knockout"===e&&(i.$resolveHtml(),phil.attachUiHandlers(i.id),i._createModel()),"vue"===e&&i.$fire("postModelCreate",{}),i.$pulsed(i._pulseHandler),i.$on("pumpco.system.core.cog",i._systemCoreCogPulseHandler,i),"knockout"===e&&(i.$bind(i.model),i._requestCards(),i.$navto("home")),i.$fire("postInit",{network:n})},i},addMyUtils:function(e,t){var n=e;return n.$round=function(e,t){var n=Math.pow(10,t),i=e*n;return Math.round(i)/n},n.$urlParam=function(e){var t=the.getQueryStringParam(e);return t&&(t=decodeURIComponent(t)),t},n.$runMethod={_references:{},onceThenEvery:function(e,t,n){this._references[e]&&clearInterval[this._references[e]],this._references[e]=setInterval(t,6e4*n),t()}},n.$setManifest=function(e){var t=the.loc.href+"&manifest="+e;window.location=t},n},addMyStore:function(e,t,n){var i=e;function s(e,t,n,i){i=i||function(e){return e},"string"==typeof t&&(t=t.split(".")),t.length>1?phil.isObservable(e)?s(e()[t.shift()],t,n,i):s(e[t.shift()],t,n,i):phil.isObservable(e[t[0]])?e[t[0]](i(n)):e[t[0]]=i(n)}return i._STOREKEY="cog."+i.id+".",i._persisted={},i.$jss=function(e,t){return n.direct(e,t)},i.$store=function(e,n){t.set(i._STOREKEY+e,n)},i.$storeAsync=function(e,n,s){t.setAsync(i._STOREKEY+e,n,s)},i.$retrieve=function(e){return t.get(i._STOREKEY+e)},i.$retrieveAsync=function(e,n){return t.getAsync(i._STOREKEY+e,n)},i.$clear=function(e){"STORAGE"===e?t.del(i._STOREKEY):t.del(e)},i._updator=function(e){i.$store(this.ns,e)},i.$persist=function(e){var t=__get(e,i,{peek:!0});if(t||i.$debug("No observable found "+e),t.subscribe){var n=the.isToStr(t()),s={sub:t.subscribe(i._updator,{ns:e})};n==the.ISNUMBER&&(s.parser=i.$parseInt),i._persisted[e]=s,i.$recover(e)}},i.$recover=function(e){for(var n in i._persisted){var o=i.$retrieve(n);o&&s(i,n,o,i._persisted[n].parser)}return t.get(i._STOREKEY+e)},i.$parseInt=function(e){return e?parseInt(e):0},i},addMyDate:function(e){var t=e;return t.$date=function(e,t){return"string"==typeof(e=e||the.dateTime())&&(e=the.parseDateTime(e,t)),{toString:function(t){return t=t||"dd-MMM-yyyy HH:mm:ss",null===e?null:e.toString(t)||""},toTime:function(t){return t=t||"HH:mm",null===e?null:e.toString(t)||""},toDate:function(t){return t=t||"dd-MMM-yyyy",null===e?null:e.toString(t)||""},compare:function(t){return null===e?null:the.compareDateTime(e,t)},toDateJS:function(){return null===e?null:e}}},t}};return My}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,n){var i;void 0===(i=function(){var e=void 0,t=/^(?:([a-z]+):\/\/)?(['0-9.\-_A-Za-z]+)?\/(['0-9.\-_A-Za-z]+)?\/?(['0-9.\-_A-Za-z]+)?\/?(['0-9.\-_A-Za-z]+)?\/?(['0-9.\-_A-Za-z]+)?\/?(['0-9.\-_A-Za-z]+)?(\?[^#]*)?$/,n=["url","protocol","verb","identifier","user","place","space","cog","params"];function i(){}return i.prototype={},i.prototype.generate=function(e){var t=e.protocol||"roadie",n=e.verb||"visit",i=e.identifier?"/"+e.identifier:"",s=e.user?"/"+e.user:"",o=e.place?"/"+e.place:"",r=e.space?"/"+e.space:"",a=e.cog?"/"+e.cog:"",c=e.params?"?"+this.objectToQueryString(e.params):"";return phil.printf("{0}://{1}{2}{3}{4}{5}{6}{7}",t,n,i,s,o,r,a,c)},i.prototype.queryStringToObject=function(e){if(e){for(var t={},n=e.split("&"),i=0;i<n.length;i++){var s=n[i].split("=");2===s.length&&(t[s[0]]=s[1])}return t}},i.prototype.objectToQueryString=function(e){if(e){if("object"!=typeof e)return e;var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")}},i.prototype.parse=function(e){e=phil.unescape(e);var i=t.exec(e);if(i){for(var s=i.length>0?{}:void 0,o=0;o<n.length;o++)s[n[o]]=i[o];var r=void 0;if(s.params){var a=s.params.substring(1);r=this.queryStringToObject(a)}s.params=r}return s},i.prototype.getType=function(e){if(e&&e.match){var t=e.match(/^(\w)+/g);if(0!==t.length)return"http"===t[0]||"https"===t[0]?"anchor":"roadie"===t[0]?"roadie":void 0}},i.prototype.parseExternal=function(e){var t=(e=phil.unescape(e)).indexOf("#"),n=this.parse(e.substring(t+1));return this.generate(n)},e||(e=new i),e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(7)],void 0===(s=function(){function e(e){this.files={},this.finishedCallback=e}return e.prototype={},e.prototype.load=function(e){for(var t in this.files=e,e){var n=e[t];for(var i in n)this.asyncLoad.call(this,t,i)}this.finished()},e.prototype.asyncLoad=function(e,t){window.fetch?fetch(t).then(function(n){n.text().then(function(n){this.loaded.call(this,e,t,n)}.bind(this))}.bind(this)).catch(function(n){this.loaded.call(this,e,t,"error")}.bind(this)):$.ajax({dataType:"text",url:t}).done(function(n){this.loaded.call(this,e,t,n)}.bind(this)).fail(function(n,i,s){this.loaded.call(this,e,t,"error")}.bind(this))},e.prototype.loaded=function(e,t,n){this.files[e][t]=n,this.finished()},e.prototype.finished=function(){var e=!0;for(var t in this.files){var n=this.files[t];for(var i in n){var s=n[i];void 0!==s&&0!==s.indexOf("http")||(e=!1)}}return!!e&&(this.finishedCallback(this.files),!0)},e}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(7)],void 0===(s=function(e){var t=void 0;function n(){}return n.prototype={},n.prototype.select=function(t){return e(t)},n.prototype.addCss=function(t,n){var i=e("#"+t);0===i.length?e("head").append('<link id="'+t+'" rel="stylesheet" type="text/css" media="screen" href="'+n+'">'):i.remove()},n.prototype.addStyle=function(t,n){var i=e("#"+t);0===i.length?e("head").append('<style id="'+t+'" rel="stylesheet" type="text/css" media="screen">'+n+"</style>"):i.remove()},n.prototype.constrain=function(e,t){var n=t.match(/[[@ \.\w\-\+\s\n():\*>]+{/g);if(!n||null===n)return t;for(var i=0;i<n.length;i++){var s=n[i];if(-1===s.indexOf("@")){var o="\n\r"+e+" "+s.replace(/[\n\r]/g," ").trim();t=t.replace(s,o)}}return t},n.prototype.constrainUrls=function(e,t){var n=t.match(/url\(['"]*(.*)['"]*\)/g);if(!n||null===n)return t;for(var i=0;i<n.length;i++){var s=n[i];if(-1===s.indexOf("data:")){var o=-1===s.indexOf("'")?s.indexOf('"'):s.indexOf("'");if(o>-1){var r=s.substring(0,o+1)+e+s.substring(o+1);t=t.replace(s,r)}}}return t},t||(t=new n),t}.apply(t,i))||(e.exports=s)},function(e,t,n){e.exports=n(33)},function(e,t,n){var i,s;i=[n(9),n(71),n(16),n(35),n(36),n(1),n(7),n(37),n(10),n(17),n(0),n(18),n(5),n(2),n(39),n(62),n(70),n(34),n(72),n(74),n(76),n(78),n(80),n(81),n(82),n(86),n(90),n(91),n(92),n(95),n(96),n(97),n(98),n(28)],void 0===(s=function(e,t,n,i,s,o,r,a,c,u,l,p,d,h,m,f,g,y,v,_,b,k,C,w,x,S,P,E,T){return function(){__mark("boot");var e=t.queryAppParams();t.serviceWorkers(),t.basicAppStyles(i,e.appParams),t.configureLogging(e.logConfig),t.configurePhil(e.location),h.on("kernel.started",function(e){var t=window.siteId||void 0,n=window.siteName||void 0,i=__markEnd("boot");l.LogFactory().emergency(i),d.log(i),__mark(t),h.fire("site.addSystemSite",{id:t,app:n})},{once:!0});try{new m({debug:e.debugParams||!1,location:e.location,lang:s,platform:e.platform,socket:e.useSocket,runtime:{wrapped:e.wrappedParams,minimal:e.minimalParams,pwa:e.pwaParams},services:[{cls:C,params:{consoleParams:e.consoleParams}},{cls:f,params:{driveParams:e.driveParams,location:e.location,build:e.buildParams}},{cls:g,params:{}},{cls:y,params:{appParams:e.appParams}},{cls:v,params:{launchParams:e.launchParams,roadieParams:e.roadieParams}},{cls:_,params:{}},{cls:b,params:{cogDebug:e.cogDebug,cogParams:e.cogParams,location:e.location}},{cls:k,params:{platform:e.platform}},{cls:w,params:{}},{cls:x,params:{appParams:e.appParams}},{cls:S,params:{}},{cls:P,params:{}},{cls:E,params:{}},{cls:T,params:{}}]}).start()}catch(e){var n=l.LogFactory();n.emergency("EXCEPTION: "+e.message),n.emergency(e.stack.toString())}}}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0)],void 0===(s=function(e,t,n){function i(n){this.name="site",this.version="0.0.1",this.kernel=n.kernel,this.runtime=n.runtime||{},n.model.sites=this.sites=e.observableArray([]),this._appParams=n.appParams,this.systemSiteSpec=void 0,t.on("site.addSystemSite",function(e){this.addSystem(e)},this),t.on("user.loaded",function(e){this.addUser({id:e.profileBody.id,username:e.id})},this),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return n.LogFactory().debug("services/site","services/site"),i.prototype={},i.prototype.addSystem=function(e){e||this.systemSiteSpec?(n.LogFactory().debug("service.site.addSystem()","services/site"),t.fire("site.add.start",{site:e}),e&&(this.systemSiteSpec=e),this.kernel.invoke("security.hasAuthMechanism",{})?(n.LogFactory().debug("Try Security autologin, using oauth","services/site"),this.kernel.invoke("security.autoLogin",{})):(n.LogFactory().debug("Site.addSystem(): site.add ["+this.systemSiteSpec.id+":"+this.systemSiteSpec.name+"]","services/site"),this.systemSiteSpec.app?t.fire("drive.get.appsystemsite",{app:this.systemSiteSpec.app,id:this.systemSiteSpec.id,name:this.systemSiteSpec.name,fn:this.loaded,scope:this}):t.fire("drive.get.systemsite",{id:this.systemSiteSpec.id,fn:this.loaded,scope:this}))):n.LogFactory().debug("Site.addSystem(): No Site Spec provided","services/site")},i.prototype.addUser=function(e){e?(n.LogFactory().debug("Site.addUser(): site.add ["+e.id+"]","services/site"),t.fire("site.add.start",{site:e}),this.delayedShowOrCancel("Loading site ["+e.id+"] for "+e.username),this._appParams?t.fire("drive.get.appsite",{app:this._appParams,id:e.id,username:e.username,fn:this.loaded,scope:this}):t.fire("drive.get.usersite",{id:e.id,username:e.username,fn:this.loaded,scope:this})):n.LogFactory().debug("Site.addUser(): No Site Spec provided","services/site")},i.prototype.delayedShowOrCancel=function(e){this._delayedShowOrCancel?(clearTimeout(this._delayedShowOrCancel),delete this._delayedShowOrCancel,this.kernel.invoke("snackbar.hide")):this._delayedShowOrCancel=setTimeout(function(){this.kernel.invoke("snackbar.show",{msg:e})}.bind(this),5e3)},i.prototype.find=function(e){var t=void 0;return __.eachSync2(this.sites(),function(n,i,s){n.id===e&&(t=n)}),t},i.prototype.hide=function(e){this.find(e).oVisible(!1),t.fire("site.hidden",{id:e})},i.prototype.show=function(e){var i=this.find(e);if(n.LogFactory().debug("Site.show("+e+")","services/site"),i){this.hide(this.current),i.oVisible(!0),t.fire("site.shown",i);var s=""===i.place.Home.id?i.place.Mobile.id:i.place.Home.id;t.fire("place.show",{id:s},{sync:!0})}else n.LogFactory().debug("Site.show(): Site NOT FOUND ["+e+"]","services/site")},i.prototype.loaded=function(e,i){if(n.LogFactory().debug("service.site.loaded()","services/site"),e){this.kernel.invoke("spinner.hide"),this.delayedShowOrCancel(),t.fire("site.loaded",e),this.current=e.id,this.sites.push(e),this.show(e.id);var s=""===e.place.Home.id?e.place.Mobile.id:e.place.Home.id;s&&""!==s?t.fire("place.add",{id:s}):(n.LogFactory().emergency("EMERGENCY: PlaceService: No placeId found. Halting...","services/site"),this.kernel.invoke("toast.alert",{msg:"error: No 'Mobile' version found. Consider switching to the 'Desktop' version"}));var o=__markEnd(e.id);void 0!==o&&n.LogFactory().emergency(o,"services/site"),t.fire("site.add.finish",{site:e})}else n.LogFactory().debug(this.name+": Invalid Site returned with error: "+i,"services/site"),this.kernel.invoke("snackbar.show",{msg:this.name+": Invalid Site returned with error: "+i}),t.fire("site.load.fail",{})},i.prototype.toString=function(){return this.name+":"+this.version},i}.apply(t,i))||(e.exports=s)},function(e,t){e.exports='\r\n\x3c!-- Base Card - used as a fallback for all card rendering --\x3e\r\n<script type="text/html" id="card-default">\r\n\t<div class="span span1">\r\n\t\t<p class="p width8 height2 text-clip">Base Card</p>\r\n\t</div>\r\n<\/script>\r\n\r\n\x3c!-- HEADER --\x3e\r\n<div id="insert-template-header"></div>\r\n\r\n\x3c!-- MASK --\x3e\r\n<div id="mask" class="concealed" style="position:absolute;z-order:100;background-color:rgba(0,0,0,0.5);height:100%;width:100%;"></div>\r\n\r\n\x3c!-- TOAST --\x3e\r\n\x3c!-- Template for Toast-Message --\x3e\r\n<script type="text/html" id="toast-message">\r\n\t<div data-bind="css:{\'removing\':!$data.visible()}" class="toast span2" style="padding:2px 0px;">\r\n\t\t<p data-bind="html:$data.msg"></p>\r\n\t\t<div class="toast-btns">\r\n\t\t\t\x3c!-- ko if:$data.auto===false --\x3e\r\n\t\t\t\t\x3c!-- ko if:$data.btnCancel --\x3e\r\n\t\t\t\t\t<button data-bind="click:$data.btnCancel" class="btn is-error">cancel</button>\r\n\t\t\t\t\x3c!-- /ko --\x3e\r\n\t\t\t\t<button data-bind="click:$data.btnOk" class="btn is-success">ok</button>\r\n\t\t\t\x3c!-- /ko --\x3e\r\n\t\t</div>\r\n\t</div>\r\n<\/script>\r\n<div id="toast" data-bind="toast:$data.toast"></div>\r\n\r\n\x3c!-- LOADERBAR --\x3e\r\n<div data-bind="loader:$data.loader" class="loaderbar"></div>\r\n\r\n\x3c!-- MAIN site i.e. main web flow content --\x3e\r\n<div class="centralise" >\r\n\t\x3c!-- PLACES --\x3e\r\n\t\x3c!-- ko foreach:$data.places --\x3e\r\n\t\t<div data-bind="place:$data">\r\n\r\n\t\t\t\x3c!-- AMONIS: 21/08/2015: Removed old ( incorrect ) header references, as the purpose has moved to the header console --\x3e\r\n\r\n\t\t\t\x3c!-- SPACES --\x3e\r\n\t\t\t\x3c!-- ko foreach:$root.getSpaces( $data.id ) --\x3e\r\n\t\t\t\t<div data-bind="space:$data">\r\n\r\n\t\t\t\t\t\x3c!-- COGS --\x3e\r\n\t\t\t\t\t\x3c!-- ko foreach:$root.getCogs( $data.id ) --\x3e\r\n\r\n\t\t\t\t\t\t<div data-bind="cog:$data"></div>\r\n\r\n\t\t\t\t\t\x3c!-- /ko --\x3e\r\n\r\n\t\t\t\t</div>\r\n\t\t\t\x3c!-- /ko --\x3e\r\n\r\n\t\t</div>\r\n\t\x3c!-- /ko --\x3e\r\n\r\n\t\x3c!-- SnackBar --\x3e\r\n\t<script type="text/html" id="snackbar-template">\r\n\t\t<p data-bind="html:$data.msg"></p>\r\n\t<\/script>\r\n\t<div data-bind="snackbar:$data.snackBar" class="snackbar concealed"></div>\r\n</div>\r\n'},function(e){e.exports={en:{"header-you-are-visiting":"you are visiting \n **{0}**","header-you-are-home":"**Home**","security-establish-network":"establishing network connection...","security-network-ok":"network ok","security-invalid-credentials":"Invalid credentials supplied","security-sccount-problem":"A problem has occurred with you account, signing out.","space-loading-space":"on our way","place-loading-msg":"ok, we're on our way","place-roadieUrl-msg":"redirecting to requested location","drive-site-refreshed":"site updated, it will be refreshed on next login"},sv:{"header-you-are-visiting":"hos\n **{0}**","header-you-are-home":"**hemma**","security-establish-network":"upprättandet nätverksanslutning ...","security-network-ok":"nätverk o","security-invalid-credentials":"Ogiltiga referenser levereras","security-sccount-problem":" Ett problem har uppstått med ditt konto, logga ut.","space-loading-space":"på väg","place-loading-msg":"ok, vi är på väg","place-roadieUrl-msg":"omdirigerar till önskad plats","drive-site-refreshed":"webbplats uppdateras, kommer den att uppdateras vid nästa inloggning"}}},function(e,t){Date.CultureInfo={name:"en-GB",englishName:"English (United Kingdom)",nativeName:"English (United Kingdom)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:1,twoDigitYearMax:2029,dateElementOrder:"dmy",formatPatterns:{shortDate:"dd/MM/yyyy",longDate:"dd MMMM yyyy",shortTime:"HH:mm",longTime:"HH:mm:ss",fullDateTime:"dd MMMM yyyy HH:mm:ss",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"dd MMMM",yearMonth:"MMMM yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-04-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 * @website: http://www.datejs.com/
 */
function(){var e,t,n,i=Date,s=i.prototype,o=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};s.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},s.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},i.today=function(){return(new Date).clearTime()},i.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},i.equals=function(e,t){return 0===e.compareTo(t)},i.getDayNumberFromName=function(e){for(var t=i.CultureInfo.dayNames,n=i.CultureInfo.abbreviatedDayNames,s=i.CultureInfo.shortestDayNames,o=e.toLowerCase(),r=0;r<t.length;r++)if(t[r].toLowerCase()==o||n[r].toLowerCase()==o||s[r].toLowerCase()==o)return r;return-1},i.getMonthNumberFromName=function(e){for(var t=i.CultureInfo.monthNames,n=i.CultureInfo.abbreviatedMonthNames,s=e.toLowerCase(),o=0;o<t.length;o++)if(t[o].toLowerCase()==s||n[o].toLowerCase()==s)return o;return-1},i.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},i.getDaysInMonth=function(e,t){return[31,i.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},i.getTimezoneAbbreviation=function(e){for(var t=i.CultureInfo.timezones,n=0;n<t.length;n++)if(t[n].offset===e)return t[n].name;return null},i.getTimezoneOffset=function(e){for(var t=i.CultureInfo.timezones,n=0;n<t.length;n++)if(t[n].name===e.toUpperCase())return t[n].offset;return null},s.clone=function(){return new Date(this.getTime())},s.compareTo=function(e){return Date.compare(this,e)},s.equals=function(e){return Date.equals(this,e||new Date)},s.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},s.isAfter=function(e){return 1===this.compareTo(e||new Date)},s.isBefore=function(e){return-1===this.compareTo(e||new Date)},s.isToday=s.isSameDay=function(e){return this.clone().clearTime().equals((e||new Date).clone().clearTime())},s.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+1*e),this},s.addSeconds=function(e){return this.addMilliseconds(1e3*e)},s.addMinutes=function(e){return this.addMilliseconds(6e4*e)},s.addHours=function(e){return this.addMilliseconds(36e5*e)},s.addDays=function(e){return this.setDate(this.getDate()+1*e),this},s.addWeeks=function(e){return this.addDays(7*e)},s.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*e),this.setDate(Math.min(t,i.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},s.addYears=function(e){return this.addMonths(12*e)},s.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),this},s.getWeek=function(){var i,s,o,r,a,c,u;return e=e||this.getFullYear(),t=t||this.getMonth()+1,n=n||this.getDate(),t<=2?(u=(s=((i=e-1)/4|0)-(i/100|0)+(i/400|0))-(((i-1)/4|0)-((i-1)/100|0)+((i-1)/400|0)),o=0,r=n-1+31*(t-1)):(o=(u=(s=((i=e)/4|0)-(i/100|0)+(i/400|0))-(((i-1)/4|0)-((i-1)/100|0)+((i-1)/400|0)))+1,r=n+(153*(t-3)+2)/5+58+u),e=t=n=null,(c=r+3-(r+(a=(i+s)%7)-o)%7|0)<0?53-((a-u)/5|0):c>364+u?1:1+(c/7|0)},s.getISOWeek=function(){return e=this.getUTCFullYear(),t=this.getUTCMonth()+1,n=this.getUTCDate(),o(this.getWeek())},s.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())};var r=function(e,t,n,i){if(void 0===e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(e<t||e>n)throw new RangeError(e+" is not a valid value for "+i+".");return!0};i.validateMillisecond=function(e){return r(e,0,999,"millisecond")},i.validateSecond=function(e){return r(e,0,59,"second")},i.validateMinute=function(e){return r(e,0,59,"minute")},i.validateHour=function(e){return r(e,0,23,"hour")},i.validateDay=function(e,t,n){return r(e,1,i.getDaysInMonth(t,n),"day")},i.validateMonth=function(e){return r(e,0,11,"month")},i.validateYear=function(e){return r(e,0,9999,"year")},s.set=function(e){return i.validateMillisecond(e.millisecond)&&this.addMilliseconds(e.millisecond-this.getMilliseconds()),i.validateSecond(e.second)&&this.addSeconds(e.second-this.getSeconds()),i.validateMinute(e.minute)&&this.addMinutes(e.minute-this.getMinutes()),i.validateHour(e.hour)&&this.addHours(e.hour-this.getHours()),i.validateMonth(e.month)&&this.addMonths(e.month-this.getMonth()),i.validateYear(e.year)&&this.addYears(e.year-this.getFullYear()),i.validateDay(e.day,this.getFullYear(),this.getMonth())&&this.addDays(e.day-this.getDate()),e.timezone&&this.setTimezone(e.timezone),"number"==typeof e.timezoneOffset&&this.setTimezoneOffset(e.timezoneOffset),e.week&&r(e.week,0,53,"week")&&this.setWeek(e.week),this},s.moveToFirstDayOfMonth=function(){return this.set({day:1})},s.moveToLastDayOfMonth=function(){return this.set({day:i.getDaysInMonth(this.getFullYear(),this.getMonth())})},s.moveToNthOccurrence=function(e,t){var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)},s.moveToDayOfWeek=function(e,t){var n=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===n?n+=7*(t||1):n)},s.moveToMonth=function(e,t){var n=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===n?n+=12*(t||1):n)},s.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},s.getTimezone=function(){return i.getTimezoneAbbreviation(this.getUTCOffset())},s.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return this.addMinutes(n-t)},s.setTimezone=function(e){return this.setTimezoneOffset(i.getTimezoneOffset(e))},s.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},s.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset()},s.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return t<0?(e=(t-1e4).toString()).charAt(0)+e.substr(2):"+"+(e=(t+1e4).toString()).substr(1)},s.getElapsed=function(e){return(e||new Date)-this},s.toISOString||(s.toISOString=function(){function e(e){return e<10?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),s._toString=s.toString,s.toString=function(e){var t=this;if(e&&1==e.length){var n=i.CultureInfo.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(n.shortDate);case"D":return t.t(n.longDate);case"F":return t.t(n.fullDateTime);case"m":return t.t(n.monthDay);case"r":return t.t(n.rfc1123);case"s":return t.t(n.sortableDateTime);case"t":return t.t(n.shortTime);case"T":return t.t(n.longTime);case"u":return t.t(n.universalSortableDateTime);case"y":return t.t(n.yearMonth)}}return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return o(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return o(t.h());case"H":return t.h();case"mm":return o(t.getMinutes());case"m":return t.getMinutes();case"ss":return o(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return o(t.getFullYear(),4);case"yy":return o(t.getFullYear());case"dddd":return i.CultureInfo.dayNames[t.getDay()];case"ddd":return i.CultureInfo.abbreviatedDayNames[t.getDay()];case"dd":return o(t.getDate());case"d":return t.getDate();case"MMMM":return i.CultureInfo.monthNames[t.getMonth()];case"MMM":return i.CultureInfo.abbreviatedMonthNames[t.getMonth()];case"MM":return o(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?i.CultureInfo.amDesignator.substring(0,1):i.CultureInfo.pmDesignator.substring(0,1);case"tt":return t.h()<12?i.CultureInfo.amDesignator:i.CultureInfo.pmDesignator;case"S":return function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}}(t.getDate());default:return e}}):this._toString()}}(),
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-04-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 * @website: http://www.datejs.com/
 */
function(){var e=Date,t=e.prototype,n=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,n._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},n.fromNow=n.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},n.ago=n.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var i,s="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),o="january february march april may june july august september october november december".split(/\s/),r="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),a="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),c="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<r.length;t++)e[r[t].toLowerCase()]=this["get"+a[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var u=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var i=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>i)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},l=function(t){return function(){var n=e.today(),i=t-n.getDay();return 0===t&&1===D.CultureInfo.firstDayOfWeek&&0!==n.getDay()&&(i+=7),n.addDays(i)}},p=0;p<s.length;p++)e[s[p].toUpperCase()]=e[s[p].toUpperCase().substring(0,3)]=p,e[s[p]]=e[s[p].substring(0,3)]=l(p),t[s[p]]=t[s[p].substring(0,3)]=u(p);for(var d=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},h=function(t){return function(){return e.today().set({month:t,day:1})}},m=0;m<o.length;m++)e[o[m].toUpperCase()]=e[o[m].toUpperCase().substring(0,3)]=m,e[o[m]]=e[o[m].substring(0,3)]=h(m),t[o[m]]=t[o[m].substring(0,3)]=d(m);for(var f=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),n=(arguments[0]||new Date).toObject(),i="",s=e.toLowerCase(),o=r.length-1;o>-1;o--){if(t[i=r[o].toLowerCase()]!=n[i])return!1;if(s==i)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},g=function(e){return function(){return this._dateElement=e,this}},y=0;y<r.length;y++)t[i=r[y].toLowerCase()]=t[i+"s"]=f(r[y]),n[i]=n[i+"s"]=g(i);t._ss=f("Second");for(var v=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},_=0;_<c.length;_++)t[c[_]]=v(0===_?-1:_)}(),
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-04-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 * @website: http://www.datejs.com/
 */
function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(n){var i=n.match(t);if(i)return[i[0],n.substring(i[0].length)];throw new e.Exception(n)}},token:function(e){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(e){n.push(i[0]),t=i[1];continue}break}return[n,t]}},many:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(e){return[n,t]}n.push(i[0]),t=i[1]}return[n,t]}},optional:function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(e){return[null,t]}return[n[0],n[1]]}},not:function(t){return function(n){try{t.call(this,n)}catch(e){return[null,n]}throw new e.Exception(n)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),i=[],s=0;s<e.length;s++)i.push(t.each(e[s],n));return i},cache:function(t){var n={},i=null;return function(s){try{i=n[s]=n[s]||t.call(this,s)}catch(e){i=n[s]=e}if(i instanceof e.Exception)throw i;return i}},any:function(){var t=arguments;return function(n){for(var i=null,s=0;s<t.length;s++)if(null!=t[s]){try{i=t[s].call(this,n)}catch(e){i=null}if(i)return i}throw new e.Exception(n)}},each:function(){var t=arguments;return function(n){for(var i=[],s=null,o=0;o<t.length;o++)if(null!=t[o]){try{s=t[o].call(this,n)}catch(t){throw new e.Exception(n)}i.push(s[0]),n=s[1]}return[i,n]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(n,i,s){return i=i||t.rtoken(/^\s*/),s=s||null,1==n.length?n[0]:function(t){for(var o=null,r=null,a=[],c=0;c<n.length;c++){try{o=n[c].call(this,t)}catch(e){break}a.push(o[0]);try{r=i.call(this,o[1])}catch(e){r=null;break}t=r[1]}if(!o)throw new e.Exception(t);if(r)throw new e.Exception(r[1]);if(s)try{o=s.call(this,o[1])}catch(t){throw new e.Exception(o[1])}return[a,o?o[1]:t]}},between:function(e,n,i){i=i||e;var s=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=s.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,n,i){return n=n||t.rtoken(/^\s*/),i=i||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(i)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(i))},set:function(n,i,s){return i=i||t.rtoken(/^\s*/),s=s||null,function(o){for(var r=null,a=null,c=null,u=null,l=[[],o],p=!1,d=0;d<n.length;d++){c=null,a=null,r=null,p=1==n.length;try{r=n[d].call(this,o)}catch(e){continue}if(u=[[r[0]],r[1]],r[1].length>0&&!p)try{c=i.call(this,r[1])}catch(e){p=!0}else p=!0;if(p||0!==c[1].length||(p=!0),!p){for(var h=[],m=0;m<n.length;m++)d!=m&&h.push(n[m]);(a=t.set(h,i).call(this,c[1]))[0].length>0&&(u[0]=u[0].concat(a[0]),u[1]=a[1])}if(u[1].length<l[1].length&&(l=u),0===l[1].length)break}if(0===l[0].length)return l;if(s){try{c=s.call(this,l[1])}catch(t){throw new e.Exception(l[1])}l[1]=c[1]}return l}},forward:function(e,t){return function(n){return e[t].call(this,n)}},replace:function(e,t){return function(n){var i=e.call(this,n);return[t,i[1]]}},process:function(e,t){return function(n){var i=e.call(this,n);return[t.call(this,i[0]),i[1]]}},min:function(t,n){return function(i){var s=n.call(this,i);if(s[0].length<t)throw new e.Exception(i);return s}}},n=function(e){return function(){var t=null,n=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var i=0,s=t.shift();i<s.length;i++)return t.unshift(s[i]),n.push(e.apply(null,t)),t.shift(),n}},i="optional not ignore cache".split(/\s/),s=0;s<i.length;s++)t[i[s]]=n(t[i[s]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},a="each any all".split(/\s/),c=0;c<a.length;c++)t[a[c]]=o(t[a[c]])}(),function(){var e=Date,t=(e.prototype,function(e){for(var n=[],i=0;i<e.length;i++)e[i]instanceof Array?n=n.concat(t(e[i])):e[i]&&n.push(e[i]);return n});e.Grammar={},e.Translator={hour:function(e){return function(){this.hour=Number(e)}},minute:function(e){return function(){this.minute=Number(e)}},second:function(e){return function(){this.second=Number(e)}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},Z:function(e){return function(){this.timezone="UTC"}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},year:function(t){return function(){var n=Number(t);this.year=t.length>2?n:n+(n+2e3<e.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);var i=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear()),this.month||0===this.month||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var s=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?s.set({timezone:this.timezone}):"number"==typeof this.timezoneOffset&&s.set({timezoneOffset:this.timezoneOffset}),s},finish:function(n){if(0===(n=n instanceof Array?t(n):[n]).length)return null;for(var i=0;i<n.length;i++)"function"==typeof n[i]&&n[i].call(this);var s=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(s=new Date);var o,r,a,c=!!(this.days&&null!==this.days||this.orient||this.operator);if(a="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||s.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,c=!0),!c&&this.weekday&&!this.day&&!this.days){var u=Date[this.weekday]();this.day=u.getDate(),this.month||(this.month=u.getMonth()),this.year=u.getFullYear()}if(c&&this.weekday&&"month"!=this.unit&&(this.unit="day",o=e.getDayNumberFromName(this.weekday)-s.getDay(),r=7,this.days=o?(o+a*r)%r:a*r),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(s.set({day:1*this.value}),c||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,c=!0),c&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",o=this.month-s.getMonth(),r=12,this.months=o?(o+a*r)%r:a*r,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*a:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*a),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){u=Date[this.weekday]();this.day=u.getDate(),u.getMonth()!==s.getMonth()&&(this.month=u.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(c&&this.timezone&&this.day&&this.days&&(this.day=this.days),c?s.add(this):s.set(this)):Date.today().setWeek(this.value)}};var n,i=e.Parsing.Operators,s=e.Grammar,o=e.Translator;s.datePartDelimiter=i.rtoken(/^([\s\-\.\,\/\x27]+)/),s.timePartDelimiter=i.stoken(":"),s.whiteSpace=i.rtoken(/^\s*/),s.generalDelimiter=i.rtoken(/^(([\s\,]|at|@|on)+)/);var r={};s.ctoken=function(t){var n=r[t];if(!n){for(var s=e.CultureInfo.regexPatterns,o=t.split(/\s+/),a=[],c=0;c<o.length;c++)a.push(i.replace(i.rtoken(s[o[c]]),o[c]));n=r[t]=i.any.apply(null,a)}return n},s.ctoken2=function(t){return i.rtoken(e.CultureInfo.regexPatterns[t])},s.h=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),o.hour)),s.hh=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2])/),o.hour)),s.H=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),o.hour)),s.HH=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3])/),o.hour)),s.m=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),o.minute)),s.mm=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),o.minute)),s.s=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),o.second)),s.ss=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),o.second)),s.hms=i.cache(i.sequence([s.H,s.m,s.s],s.timePartDelimiter)),s.t=i.cache(i.process(s.ctoken2("shortMeridian"),o.meridian)),s.tt=i.cache(i.process(s.ctoken2("longMeridian"),o.meridian)),s.Z=i.cache(i.process(i.rtoken(/^Z/),o.Z)),s.z=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),o.timezone)),s.zz=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),o.timezone)),s.zzz=i.cache(i.process(s.ctoken2("timezone"),o.timezone)),s.timeSuffix=i.each(i.ignore(s.whiteSpace),i.set([s.tt,s.zzz])),s.time=i.each(i.optional(i.ignore(i.stoken("T"))),s.hms,s.timeSuffix),s.d=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1]|\d)/),i.optional(s.ctoken2("ordinalSuffix"))),o.day)),s.dd=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1])/),i.optional(s.ctoken2("ordinalSuffix"))),o.day)),s.ddd=s.dddd=i.cache(i.process(s.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),s.M=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d|\d)/),o.month)),s.MM=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d)/),o.month)),s.MMM=s.MMMM=i.cache(i.process(s.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),o.month)),s.y=i.cache(i.process(i.rtoken(/^(\d\d?)/),o.year)),s.yy=i.cache(i.process(i.rtoken(/^(\d\d)/),o.year)),s.yyy=i.cache(i.process(i.rtoken(/^(\d\d?\d?\d?)/),o.year)),s.yyyy=i.cache(i.process(i.rtoken(/^(\d\d\d\d)/),o.year)),n=function(){return i.each(i.any.apply(null,arguments),i.not(s.ctoken2("timeContext")))},s.day=n(s.d,s.dd),s.month=n(s.M,s.MMM),s.year=n(s.yyyy,s.yy),s.orientation=i.process(s.ctoken("past future"),function(e){return function(){this.orient=e}}),s.operator=i.process(s.ctoken("add subtract"),function(e){return function(){this.operator=e}}),s.rday=i.process(s.ctoken("yesterday tomorrow today now"),o.rday),s.unit=i.process(s.ctoken("second minute hour day week month year"),function(e){return function(){this.unit=e}}),s.value=i.process(i.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),s.expression=i.set([s.rday,s.operator,s.value,s.unit,s.orientation,s.ddd,s.MMM]),n=function(){return i.set(arguments,s.datePartDelimiter)},s.mdy=n(s.ddd,s.month,s.day,s.year),s.ymd=n(s.ddd,s.year,s.month,s.day),s.dmy=n(s.ddd,s.day,s.month,s.year),s.date=function(t){return(s[e.CultureInfo.dateElementOrder]||s.mdy).call(this,t)},s.format=i.process(i.many(i.any(i.process(i.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?|Z)/),function(t){if(s[t])return s[t];throw e.Parsing.Exception(t)}),i.process(i.rtoken(/^[^dMyhHmstz]+/),function(e){return i.ignore(i.stoken(e))}))),function(e){return i.process(i.each.apply(null,e),o.finishExact)});var a={},c=function(e){return a[e]=a[e]||s.format(e)[0]};s.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(c(e[n]));return i.any.apply(null,t)}return c(e)},s._formats=s.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),s._start=i.process(i.set([s.date,s.time,s.expression],s.generalDelimiter,s.whiteSpace),o.finish),s.start=function(e){try{var t=s._formats.call({},e);if(0===t[1].length)return t}catch(e){}return s._start.call({},e)},e._parse=e.parse,e.parse=function(t){var n=null;if(!t)return null;if(t instanceof Date)return t;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(e){return null}return 0===n[1].length?n[0]:null},e.getParseFunction=function(t){var n=e.Grammar.formats(t);return function(e){var t=null;try{t=n.call({},e)}catch(e){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}();
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-04-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 * @website: http://www.datejs.com/
 */
var n=function(e,t,i,s,o){for(var r="days hours minutes seconds milliseconds".split(/\s+/),a=function(e){return function(){return this[e]}},c=function(e){return function(t){return this[e]=t,this}},u=0;u<r.length;u++){var l=r[u],p=l.slice(0,1).toUpperCase()+l.slice(1);n.prototype[l]=0,n.prototype["get"+p]=a(l),n.prototype["set"+p]=c(l)}if(4==arguments.length)this.setDays(e),this.setHours(t),this.setMinutes(i),this.setSeconds(s);else if(5==arguments.length)this.setDays(e),this.setHours(t),this.setMinutes(i),this.setSeconds(s),this.setMilliseconds(o);else if(1==arguments.length&&"number"==typeof e){var d=e<0?-1:1;this.setMilliseconds(Math.abs(e)),this.setDays(Math.floor(this.getMilliseconds()/864e5)*d),this.setMilliseconds(this.getMilliseconds()%864e5),this.setHours(Math.floor(this.getMilliseconds()/36e5)*d),this.setMilliseconds(this.getMilliseconds()%36e5),this.setMinutes(Math.floor(this.getMilliseconds()/6e4)*d),this.setMilliseconds(this.getMilliseconds()%6e4),this.setSeconds(Math.floor(this.getMilliseconds()/1e3)*d),this.setMilliseconds(this.getMilliseconds()%1e3),this.setMilliseconds(this.getMilliseconds()*d)}return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(e){var t,n=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return n<(t=null===e?new Date(1970,1,1,0,0,0):new Date(1970,1,1,e.getHours(),e.getMinutes(),e.getSeconds()))?-1:n>t?1:0},this.equals=function(e){return 0===this.compareTo(e)},this.add=function(e){return null===e?this:this.addSeconds(e.getTotalMilliseconds()/1e3)},this.subtract=function(e){return null===e?this:this.addSeconds(-e.getTotalMilliseconds()/1e3)},this.addDays=function(e){return new n(this.getTotalMilliseconds()+864e5*e)},this.addHours=function(e){return new n(this.getTotalMilliseconds()+36e5*e)},this.addMinutes=function(e){return new n(this.getTotalMilliseconds()+6e4*e)},this.addSeconds=function(e){return new n(this.getTotalMilliseconds()+1e3*e)},this.addMilliseconds=function(e){return new n(this.getTotalMilliseconds()+e)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(e){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(e){return e.toString().length<2?"0"+e:e};var t=this;return e?e.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(e){switch(e){case"d":return t.getDays();case"dd":return t.p(t.getDays());case"H":return t.getHours();case"HH":return t.p(t.getHours());case"h":return t.get12HourHour();case"hh":return t.p(t.get12HourHour());case"m":return t.getMinutes();case"mm":return t.p(t.getMinutes());case"s":return t.getSeconds();case"ss":return t.p(t.getSeconds());case"t":return(t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}}):this._toString()},this};Date.prototype.getTimeOfDay=function(){return new n(0,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())}},function(e,t){!function(){e.exports=this.localforage}()},function(e,t,n){var i,s;i=[n(1),n(2),n(19),n(3),n(40),n(58),n(59),n(0),n(6)],void 0===(s=function(e,t,n,i,s,o,r,a,c){function u(e){(e=e||{}).runtime=e.runtime||{},__mark("kernel"),this.name="pumpface",this.version="0.1.06",this.log=a.LogFactory(),this.debug=!!e.debug,this.location=e.location||void 0,this.services=e.services||[],this.apps=e.apps||[],this.model=this.createModel(),this.platform=e.platform||"Desktop",this.api={},this.useSocket=e.socket,this.runtime={},this.runtime.wrapped=!!e.runtime.wrapped,this.runtime.pwa=!!e.runtime.pwa,!0===e.runtime.minimal||"true"===e.runtime.minimal?this.runtime.minimal=!0:this.runtime.minimal=!1,this.runtime.hostname=the.loc.hostname,this.events=t,this.processRequired=0,this.processLoaded=0,this._paused=!1,this.pump=new s({kernel:this,debug:this.debug,location:this.location,platform:this.platform,useSocket:this.useSocket}),this.security=new r({kernel:this,pump:this.pump,location:this.location}),c.lang=this.loadLang(e.lang),this.addApi("kernel.process.loaded",this.loadedProcess,this),this.addApi("kernel.get.pumpface.path",function(){return this.location.pumpface}.bind(this)),this.addApi("kernel.list.api",this.listApi.bind(this)),this.addApi("kernel.get.info",this.displayVersion.bind(this)),this.addApi("kernel.get.paused",this.isPaused.bind(this)),t.on("platform.offline",this.offline,this),t.on("platform.online",this.online,this),t.on("platform.pause",this.paused,this),t.on("platform.resume",this.resumed,this),t.on("kernel.reboot",this.reboot,this),this.debug&&(window.kernel=this)}return u.prototype={},u.prototype.createModel=function(){var t=new o;return t.kernel={},t.kernel.platform=e.observable({os:null,size:null,orient:null}),t.services={},t},u.prototype.start=function(){this.log.debug("kernel.start()"),t.fire("kernel.preservice",{name:this.name,version:this.version,debug:this.debug,model:this.model,pump:this.pump,runtime:this.runtime},{sync:!0}),this.loadProcesses(this.services,"services")},u.prototype.started=function(){this.debug&&(window.model=this.model),e.applyBindings(this.model),this.logPrettyMessage(),this.registerBrowserEvents(),this.log.info("kernel.started"),__markEnd("kernel"),t.fire("kernel.started",{kernel:this}),t.fire("kernel.postservice",{name:this.name,version:this.version})},u.prototype.logPrettyMessage=function(){var e=["    _  __"," _ / \\(_ ","(_|\\_/__)"].join("\n");console.log(e)},u.prototype.offline=function(e){this.log.info("kernel.offline()")},u.prototype.online=function(e){this.log.info("kernel.online()"),t.fire("place.reshow",{})},u.prototype.paused=function(e){this._paused=!0,this.log.info("kernel.paused()")},u.prototype.resumed=function(e){this._paused=!1,this.log.info("kernel.resumed()"),t.fire("place.reshow",{state:"resumed"})},u.prototype.reboot=function(e){this.log.info("kernel.reboot()");var t=window.location.search.replace(/([&]*login.bypass=[\w.|]+)/,""),n=window.location.origin+window.location.pathname+t;window.location.replace(n)},u.prototype.loadProcesses=function(e,t){this.processRequired=e.length,__.eachSync2(e,function(e,n,i){e.params.kernel=this,e.params.model=this.model,e.params.pump=this.pump,e.params.runtime=this.runtime,e.params.debug=this.debug,e.params.location=this.location;var s=new e.cls(e.params);this.model[t][s.name]=s},function(){},{scope:this})},u.prototype.loadedProcess=function(e){this.processLoaded++,this.log.debug(this.name+": kernel loaded: "+e.name),this.processLoaded===this.processRequired&&(this.log.debug(this.name+": All processes ready. Booting."),this.started())},u.prototype.loadLang=function(e){if(the.isObject(e))return e;var t={};try{t=JSON.parse(e)}catch(e){this.log.emergency(this.name+": Failed to load language pack successfully.")}return t},u.prototype.addApi=function(e,t,i){n.addApi(e,t,i)},u.prototype.listApi=function(){return n.listApi()},u.prototype.invoke=function(e,t,i){return n.run(e,t,i)},u.prototype.displayVersion=function(){return{name:this.name,version:this.version}},u.prototype.isPaused=function(){return this._paused},u.prototype.determineEnvironment=function(){var e="other",t="windows",n=__get("screen.orientation.type",window)||"landscape-primary";the.isDesktop?the.isWindows?t="windows":the.isMac?t="osx":the.isLinux&&(t="linux"):the.isIos?t="ios":the.isAndroid&&(t="android");e="small";"landscape-primary"===(n=__get("screen.orientation.type",window)||"landscape")?n="landscape":"portrait-primary"===n&&(n="portrait");var i=__get("screen.width",window)||0;i>=768&&(e="medium"),i>1024&&(e="large"),(0,this.model.kernel.platform)({os:t,size:e,orient:n})},u.prototype.registerBrowserEvents=function(){window.addEventListener("resize",this.determineEnvironment.bind(this),!1),window.addEventListener("orientationchange",this.determineEnvironment.bind(this),!1),this.determineEnvironment()},u.prototype.toString=function(){return this.name+":"+this.version},u}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2),n(0),n(20),n(11),n(12),n(21),n(42),n(44),n(22),n(24),n(47),n(48),n(41),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(3),n(10)],void 0===(s=function(e,t,n,i,s,o,r,a,c,u,l,p,d,h,m,f,g,y,v,_,b,k){t.LogFactory().debug("core/pump","core/pump");var C=void 0;function w(t){C=this,t=t||{},this.debug=t.debug||!1,this.name="pump",this.version="0.0.1",this._location=t.location||"",this._baseUrl=this._location.origin+"/pump",this._camelet=camelet.Camelet({}),this._online=navigator.onLine,this.kernel=t.kernel,this._endpointId=the.generateUuid(),"Desktop"===t.platform?this.platform=void 0:this.platform=t.platform,this.authToken="",this.socketReconnectCount=0,this._connection="gprs",this._qualityAverages=[],this.isIE8IE9=!the.cssFeature(["webkitBoxFlex","MozBoxFlex","msFlex"]),this.useXhr=!1,this.socketReconnectCount=0,this.isIE8IE9||(this.isIE8IE9=!t.useSocket||this.isIE8IE9),this.build(this._endpointId),this.endpoints=this.customise(),e.on("platform.online",this.online,this),e.on("platform.pause",this.paused,this),e.on("platform.resume",this.resumed,this),this.kernel.addApi("pump.setAuthToken",this.setAuthToken,this),this.kernel.addApi("io.authToken.get",this.getAuthToken,this),this.kernel.addApi("pump.isOnline",this.isOnline,this),this.kernel.addApi("pump.signout",this.signout,this)}return __ns("pumpco.core.jsbean"),pumpco.core.jsbean.Message=function(e){return t.LogFactory().debug("pumpco.core.jsbean.Message","core/pump"),new s(e)},pumpco.core.jsbean.Exchange=function(e){return t.LogFactory().debug("pumpco.core.jsbean.Exchange","core/pump"),new i(e)},pumpco.core.jsbean.ExchangeFacade=n,pumpco.core.jsbean.Pulse=function(e){return t.LogFactory().debug("pumpco.core.jsbean.Pulse","core/pump"),new o(e)},w.prototype={},w.prototype.build=function(e){this._camelet.registerConsumer(new g({name:"consumer-pulse-cog",endpointId:e})),this._camelet.registerConsumer(new y({name:"consumer-pulse-external-open",endpointId:e})),this._camelet.registerConsumer(new v({name:"consumer-pulse-external-secure",endpointId:e})),this._camelet.registerComponent(new p({name:"component-pulse-controller",endpointId:e,platform:this.platform})),this._camelet.registerComponent(new d({name:"component-pulse-external-in",endpointId:e})),this._camelet.registerComponent(new h({name:"component-pulse-external-out",endpointId:e})),this._camelet.registerComponent(new m({name:"component-pulse-external-polling",endpointId:e})),this._camelet.registerComponent(new f({name:"component-pulse-internal-inout",endpointId:e})),this._camelet.registerComponent(new l({name:"component-pulse-registry",endpointId:e})),this._camelet.registerProducer(new _({name:"producer-pulse-cog",endpointId:e})),this._camelet.registerProducer(new b({name:"producer-pulse-external-open",endpointId:e})),this._camelet.registerProducer(new k({name:"producer-pulse-external-secure",endpointId:e})),this._camelet.wire("consumer-pulse-cog","component-pulse-internal-inout"),this._camelet.wire("component-pulse-internal-inout","producer-pulse-cog"),this._camelet.wire("consumer-pulse-cog","component-pulse-controller"),this._camelet.wire("component-pulse-controller","component-pulse-external-polling"),this._camelet.wire("component-pulse-external-polling","component-pulse-external-out"),this._camelet.wire("component-pulse-external-out","producer-pulse-external-open"),this._camelet.wire("component-pulse-external-out","producer-pulse-external-secure"),this._camelet.wire("consumer-pulse-external-open","component-pulse-external-in"),this._camelet.wire("consumer-pulse-external-secure","component-pulse-external-in"),this._camelet.wire("component-pulse-external-in","producer-pulse-cog"),this._camelet.wire("component-pulse-external-in","component-pulse-registry"),this._camelet.wire("consumer-pulse-cog","component-pulse-registry"),this._camelet.wire("component-pulse-registry","producer-pulse-cog"),this._camelet.getComponentByName("component-pulse-external-in").listen("authtoken",this.onAuthToken,!0)},w.prototype.customise=function(){var e=new r({id:"openXhr",name:"openXhr",context:"/pumpco/external/open",pump:this,url:this._baseUrl+"/inout",onError:this.xhrPingError,onSuccess:this.xhrPingSuccess,onQos:this.qualityOfService.bind(this)});e.connect();var t=new r({id:"secureXhr",name:"secureXhr",context:"/pumpco/external/secure",pump:this,url:this._baseUrl+"/secureInout",onError:this.xhrPingError,onSuccess:this.xhrPingSuccess,onQos:this.qualityOfService.bind(this)});t.connect();var n=this._location.origin+"/PumpHouse/pumpws/websocket";n=n.replace("http","ws");var i=new a({id:"secureWebSocket",name:"secureWebSocket",context:"/pumpco/external/secure",pump:this,url:n,onSuccess:this.socketCreated.bind(this),onError:this.socketError.bind(this),onClose:this.socketClose.bind(this)});return i.wireEndpoints(),this.secureSocket=i,{open:e,secure:t,secureSocket:i}},w.prototype.createEndPoint=function(e,t,n,i){return new u({name:t.address,pump:this,produce:n,consume:i})},w.prototype.registerConsumer=function(e){this._camelet.registerConsumer(e)},w.prototype.registerComponent=function(e){this._camelet.registerComponent(e)},w.prototype.registerProducer=function(e){this._camelet.registerProducer(e)},w.prototype.wire=function(e,t){this._camelet.wire(e,t)},w.prototype.registerConsumer=function(e){return this._camelet.registerConsumerEndpoint(e)},w.prototype.registerProducer=function(e){return this._camelet.registerProducerEndpoint(e)},w.prototype.unsetAuthToken=function(){C._camelet.setComponentProperty("component-pulse-external-out","authToken",void 0)},w.prototype.onAuthToken=function(e){t.LogFactory().debug("AUTHTOKEN:"+e.authtoken,"core/pump"),console.log(e.authtoken),e.authtoken&&(C.authtoken=e.authtoken,C._camelet.setComponentProperty("component-pulse-external-out","authToken",e.authtoken),C._camelet.setComponentProperty("component-pulse-external-out","Authorization",void 0)),e.oauth&&(C.oAuthToken="Bearer "+e.oauth.access_token),t.LogFactory().debug("core.Pump.onAuthToken( "+C.authtoken+" )","core/pump"),this.socketOpen()},w.prototype.socketOpen=function(){C.isIE8IE9||C.useXhr||(C._camelet.getComponentProperty("component-pulse-external-polling","keepAlive",!0),C._camelet.setComponentProperty("component-pulse-controller","scheme","paused"),C.secureSocket.open(C.authtoken))},w.prototype.xhrOpen=function(){C._camelet.setComponentProperty("component-pulse-controller","scheme","xhr"),C._camelet.setComponentProperty("component-pulse-external-polling","scheme","xhr"),C._camelet.getComponentProperty("component-pulse-external-polling","start",!0),C._camelet.getComponentProperty("component-pulse-controller","flush",!0)},w.prototype.setAuthToken=function(e){e&&(e.authtoken||e.oauth)?this.onAuthToken(e):this.unsetAuthToken()},w.prototype.getAuthToken=function(){return C._camelet.getComponentProperty("component-pulse-external-out","authToken")},w.prototype.socketCreated=function(n){C.socketReconnectCount=0,t.LogFactory().debug("core.Pump.socketCreated():","core/pump"),C._camelet.setComponentProperty("component-pulse-controller","scheme","socket"),C._camelet.setComponentProperty("component-pulse-external-polling","scheme","socket"),C._camelet.getComponentProperty("component-pulse-controller","flush",!0),e.fire("pump.socket-connected",n)},w.prototype.socketError=function(e){C.socketReconnectCount++,t.LogFactory().debug("core.Pump.socketError(): "+C.socketReconnectCount,"core/pump"),C.socketReconnectCount<1?this.socketOpen():this.xhrOpen()},w.prototype.socketClose=function(n){t.LogFactory().debug("core.Pump.socketClose():"),e.fire("pump.socket-close",n)},w.prototype.xhrPingError=function(n,i,s){t.LogFactory().emergency("pump:xhrPingError:"),this._online&&e.fire("pump.network.status",{state:"offline"}),this._online=!1;var o={pulseClass:"no defined"};try{o=JSON.parse(n)}catch(e){}e.fire("pump.xhr-ping-error",{state:"offline",request:o})},w.prototype.xhrPingSuccess=function(n){t.LogFactory().debug("Pump.xhrPingSuccess( 200 )"),!1===this._online&&e.fire("pump.network.status",{state:"online"}),this._online=!0,e.fire("pump.xhr-ping-success",{state:"online"})},w.prototype.qualityOfService=function(n){this._qualityAverages.push(n.bps),this._qualityAverages.length>5&&(this._qualityAverages.shift(),this._qualityAverages.shift());for(var i=0,s=0;s<this._qualityAverages.length;s++)i+=this._qualityAverages[s];var o="gprs";(i/=this._qualityAverages.length)>=3e4?o="wifi":i>=2e4?o="4g":i>=5e3?o="3g":i>=1750&&(o="2g"),o!==this._connection&&(this._connection=o,e.fire("pump.network.status",{connection:o}),t.LogFactory().debug("Pump:Connection:"+o))},w.prototype.isOnline=function(){return this._online},w.prototype.signout=function(){this.internelSend("pumpCo.user.logout.request",{})},w.prototype.internelSend=function(e,t,n,i){var s=e.indexOf("event")>-1?"event":"command",o=e.indexOf("event")>-1?"outOnly":"inOut",r={};i&&(r.componentId=i),r.mep=o,r.pulseClass=e,r.pulseId="000000-0000-00-0000-000000",r.pulseResponseTimeout="5000",r.pulseType=s,r.referenceId="command-line",r.timestamp=the.formatDateTime(the.dateTime());var a=new camelet.Message({body:{pulseHeader:r,pulseBody:t}}),c=new camelet.Exchange;c.setMessage(a),("outOnly"===o?C._camelet.getComponentByName("component-pulse-external-in"):e.indexOf("internal")>-1?C._camelet.getComponentByName("component-pulse-internal-inout"):C._camelet.getComponentByName("component-pulse-controller")).pulsed(c)},w.prototype.delRoute=function(){},w.prototype.paused=function(){console.log("pausing pump"),C._camelet.getComponentProperty("component-pulse-external-polling","stop",!0)},w.prototype.resumed=function(){C._camelet.getComponentProperty("component-pulse-external-polling","start",!0),C._camelet.getComponentProperty("component-pulse-external-polling","pollNow",!0)},w.prototype.toString=function(){return this.name+":"+this.version},w}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={_listeners:{},listen:function(e,n,i){i=i||!1,t._listeners[e]||(t._listeners[e]=[]),t._listeners[e].push({fn:n,single:i})},fire:function(e,n){var i=t._listeners[e];if(!i)return-1;for(var s=0;s<i.length;s++){var o=i[s];o.fn.call(this,n),o.single&&i.splice(s,1)}},onsend:function(e,n){n.getHeaders();var i=n.getBody(),s=e.withOptions(i.pulseHeader.pulseClass);return t.fire("presend",n),s},onprocess:function(e,n){var i=n.getMessage().getBody();("pumpCo.user.login.response"===i.pulseHeader.pulseClass&&i.pulseBody.authToken&&t.fire("authtoken",{authtoken:i.pulseBody.authToken}),"pumpCo.user.logout.response"===i.pulseHeader.pulseClass)&&this.getCameletInstance().setComponentProperty("component-pulse-external-out","authToken",void 0);"pumpCo.user.pulse.request"===i.pulseHeader.pulseClass&&this.getCameletInstance().getComponentProperty("component-pulse-external-polling","pollReceived",!0);-1===i.pulseHeader.pulseClass.indexOf("exception")?this.getCameletInstance().getComponentProperty("component-pulse-external-polling","pollFaster",!0):this.getCameletInstance().getComponentProperty("component-pulse-external-polling","pollSlower",!0);i.pulseHeader.additionalResponses&&this.getCameletInstance().getComponentProperty("component-pulse-external-polling","poll",!0);return n}};(e=e||{}).name=e.name||"component-pulse-external-in",e.scheme=e.scheme||"",e.context=e.context||"",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}];var n=camelet.DynamicRouter(e);for(var i in n)t[i]||(t[i]=n[i]);return t._super=n,t._super.onprocess=t.onprocess,t._super.onsend=t.onsend,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2),n(0),n(43),n(3),n(7)],void 0===(s=function(e,t,n){var i=function(e){var i={capabilities:{consume:[{cls:""}],produce:[{cls:""}]},_timeout:500};return i.context=e.context||"/pumpco/external/open",i._inbox=[],i.inEp=void 0,i.name=e.name,i.outEp=void 0,i._properties=e.properties||{},i.pump=e.pump,i.msgIn=e.msgIn,i._url=e.url,i._lastSent=-1,i.onError=e.onError,i.onSuccess=e.onSuccess,i.onQos=e.onQos||function(){},i.qos=new n,i.connect=function(e,t){i.outEp=camelet.Endpoint({name:i.name+"-Out",scheme:"xhr",context:i.context,options:i.capabilities.produce}),i.inEp=camelet.Endpoint({name:i.name+"-In",scheme:"xhr",context:i.context,options:i.capabilities.consume,listeners:[{fn:i.pulsed,scope:i}]});var n=i.pump.registerConsumer(i.outEp),s=i.pump.registerProducer(i.inEp);return!(!n||!s)},i.disconnect=function(){i.pump.unregisterConsumer(i.outEp),i.pump.unregisterProducer(i.inEp)},i.generatePollRequest=function(){var e=new camelet.Message({body:{pulseHeader:{mep:"inout",pulseClass:"pumpCo.user.pulse.request",pulseId:camelet.Utils.generateUuid(),pulseResponseTimeout:"0",pulseType:"command",referenceId:"PollingP-ulse-0000-0000-000000000001",timestamp:camelet.Utils.now()},pulseBody:{}}}),t=new camelet.Exchange;return t.setMessage(e),t},i.exchangeToXhr=function(e){var t={Accept:"application/json","Content-Type":"application/json",pumpReferer:window.location.toString()},n=e.properties.getValue("authToken");n&&(t.authToken=n);var i=e.properties.getValue("Authorization");i&&(t.Authorization=i);var s=e.getMessage().getBody();return{header:t,data:JSON.stringify(s)}},i.xhrToExchange=function(e){var t=new camelet.Exchange,n=(t.properties,new camelet.Message({body:e}));return t.setMessage(n),t},i.poller=function(){0===i._inbox.length&&i._inbox.push(i.generatePollRequest()),i.xhrSend(),i._poll},i._poll=!1,i.poll=function(){i.poller()},i.send=function(e){i._inbox.push(e),i.poll()},i.xhrReceive=function(e){var t=JSON.stringify(e).length;if(t>2){var n=i.xhrToExchange(e),s=n.message.getBody().pulseHeader,o=i.qos.response(s.referenceId,t);o&&i.onQos(o),i.pulse(n)}},i.xhrSend=function(){var e=i._inbox.pop(),n=e.message.getBody().pulseHeader,s=i.exchangeToXhr(e),o=JSON.stringify(s).length+182;i.qos.request(n.referenceId,o);var r=$.ajax({url:i._url,headers:s.header,type:"POST",data:s.data,dataType:"json"});r.done(function(e){i.onSuccess(this.data,e),e&&i.xhrReceive(e)}),r.fail(function(e,n){t.LogFactory().debug("Request failed: "+n,"core/io/endpoints/xhr"),i.onError(this.data,e.responseText,e.status)})},i.pulse=function(e){i.outEp.send(e)},i.onPulsed=function(e){},i.pulsed=function(e){i.send(e)},i};function s(e){return i(e)}return s.prototype={},s}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(0),n(3)],void 0===(s=function(e){function t(e){this._ids={}}return t.prototype={},t.prototype.request=function(e,t){this._ids[e]={sent:Date.now(),size:t}},t.prototype.response=function(e,t){var n=this._ids[e];if(n){var i=Date.now(),s=this.process(e,n.sent,n.size,i,t);return this.prune(e),s}},t.prototype.process=function(e,t,n,i,s){var o=i-t,r=(n+s)*(1e3/o);return{bps:Math.round(r),ms:o}},t.prototype.prune=function(t){delete this._ids[t];var n=Object.keys(this._ids).length;n>10&&(e.LogFactory().emergency("endpoint.xhr:stored QoS keys >= "+n,"core/io/endpoints/qos"),this._ids={})},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(0),n(45),n(46)],void 0===(s=function(e,t,n){var i=function(e){e=e||{},t.call(this,e),this.SCHEME="socket",this._timeout=null,this._outbox=new n};return WebSocket.TIMEOUT=5e3,i.supported=function(){return"WebSocket"in window},(i.prototype=Object.create(t.prototype)).open=function(t){t&&(this._authToken=t);var n=this.url+"?authToken="+this._authToken;return e.LogFactory().emergency("WebSocketEP.open(): (re)connecting","core/io/endpoints/websocket"),this._socket&&this.close(),this._socket=new WebSocket(n),this._socket.onopen=this.onsuccess.bind(this),this._socket.onerror=this.onerror.bind(this),this._socket.onmessage=this.onmessage.bind(this),this._socket.onclose=this.onclose.bind(this),this._socket},i.prototype.close=function(){return void 0!==this._socket&&(this._socket.onopen=function(){},this._socket.onerror=function(){},this._socket.onmessage=function(){},this._socket.close(),delete this._socket,!0)},i.prototype.onmessage=function(e){t.prototype.onmessage.call(this,e)},i.prototype.send=function(e){e=e||{},this._socket&&1===this._socket.readyState?(this._outbox.add(e),this._socket.send(JSON.stringify(e))):this._socket&&3===this._socket.readyState&&this.open()},i}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(0),n(3),n(10)],void 0===(s=function(e){var t=function(e){e=e||{},this.SCHEME="socket",this._authToken=null,this._standalone=e.standalone||!1,this._socket=void 0,this._inEp=void 0,this._outEp=void 0,this.capabilities={consume:[{cls:""}],produce:[{cls:""}]},this.name=e.name,this.context=e.context||"/pumpco/external/secure",this.pump=e.pump,this.url=e.url||void 0,this.onsuccess=e.onSuccess||function(){},this.onclose=e.onClose||function(){},this.onfailure=e.onFailure||function(){},this.onreconnect=e.onReconnect||function(){},this.onerror=e.onError||function(){},this.onTransportFailure=e.onTransportFailure||function(){}};return t.supported=function(){return!0},t.xhrToExchange=function(e){var t=new camelet.Exchange,n=(t.properties,new camelet.Message({body:e}));return t.setMessage(n),t},(t.prototype={}).wireEndpoints=function(){if(!1===this._standalone){if(this._outEp=camelet.Endpoint({name:this.name+"-Out",scheme:this.SCHEME,context:this.context,options:this.capabilities.produce}),this._inEp=camelet.Endpoint({name:this.name+"-In",scheme:this.SCHEME,context:this.context,options:this.capabilities.consume,listeners:[{fn:this.pulsed,scope:this}]}),this.pump)this.pump.registerConsumer(this._outEp),this.pump.registerProducer(this._inEp);else e.LogFactory().emergency("core/io/endpoints/sockjs: Error no pump reference found to register endpoint with.","core/io/endpoints/basic");return!(!this._inEp||!this._outEp)&&{in:this._inEp,out:this._outEp}}return!1},t.prototype.onmessage=function(e){if(e.data.length>2){var n=JSON.parse(e.data),i=t.xhrToExchange(n);__get("pulseHeader.referenceId",n);this.pulse(i)}},t.prototype.close=function(){return!0},t.prototype.send=function(e){return!0},t.prototype.pulse=function(t){var n=t.getMessage().getBody(),i=the.dateTime(),s=the.formatTime(i,"HH:mm:ss")+":"+i.getMilliseconds(),o=__get("pulseHeader.pulseClass",n);o&&e.LogFactory().info(this,"["+s+"]:"+this.SCHEME+"-<-"+o,"core/io/endpoints/basic"),this._outEp&&this._outEp.send(t)},t.prototype.pulsed=function(t){var n=t.getMessage().getBody(),i=the.dateTime(),s=the.formatTime(i,"HH:mm:ss")+":"+i.getMilliseconds();e.LogFactory().info(this,"["+s+"]:"+this.SCHEME+"->-"+n.pulseHeader.pulseClass,"core/io/endpoints/basic");__get("pulseHeader.referenceId",n);this.send(n)},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){var e=function(){this._data=[]};return e.MAX=10,(e.prototype={}).add=function(e){this._data.push(e),this._data.length>10&&this._data.shift()},e.prototype.find=function(e,t){for(var n=void 0,i=void 0,s=0;s<this._data.length;s++)if(this._data[s][e]===t){n=this._data[s],i=s;break}return i&&(this.data=this.data.splice(i,1)),n},e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={_tracking:{},createExceptionMessage:function(e){var n=new camelet.Message({body:{pulseHeader:{mep:"inout",pulseClass:"exception.pulse.failure",pulseId:camelet.Utils.generateUuid(),pulseResponseTimeout:"0",pulseType:"command",referenceId:t._referenceId,timestamp:camelet.Utils.now(),requestingComponentId:e},pulseBody:{status:{code:"error",message:"timeout"}}}}),i=new camelet.Exchange;return i.setMessage(n),i},tracker:function(){var e=Object.keys(t._tracking);if(e.length>0)for(var n=0;n<e.length;n++){var i=t._tracking[e[n]];!1===i.notified&&(i.notified=!0)}setTimeout(t.tracker.bind(t),5e3)},track:function(e){var n=e.getMessage().getBody();t._tracking[n.pulseHeader.referenceId]={exchange:e,notified:!1,timestamp:Date.now(),compId:n.pulseHeader.componentId}},untrack:function(e){var n=e.getMessage().getBody();if(void 0!==t._tracking[n.pulseHeader.referenceId]){t._tracking[n.pulseHeader.referenceId].exchange.getMessage().getBody();delete t._tracking[n.pulseHeader.referenceId]}},onsend:function(e,t){t.getHeaders(),t.getBody();return!1},onprocess:function(e,n){var i=n.getMessage().getBody();i.pulseHeader.tracked?(i.pulseHeader.referenceId||console.log("ComponentPulseRegistry: cannot track message without a refId."),t.track(n)):"component-pulse-external-in"===n.properties.getAuditItems()[1].name&&t.untrack(n);return n}};(e=e||{}).name=e.name||"component-pulse-registry",e.scheme=e.scheme||"",e.context=e.context||"",e.inOptions=e.inOptions||[{cls:"pumpco.system.core.cog",list:"black"},{cls:"pumpco.roadie.",list:"black"},{cls:"pumpco.internal.",list:"black"},{cls:"pumpco.",list:"white"},{cls:"user.registration",list:"white"}],e.outOptions=e.outOptions||[],e.onsend=t.onsend,e.onprocess=t.onprocess;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t._super.onsend=t.onsend,setTimeout(t.tracker.bind(t),5e3),t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={};t.platform=e.platform||void 0,t._listeners={},t.inbox=[],t.onsend=function(e,n){n.getHeaders();var i=n.getBody(),s=e.withOptions(i.pulseHeader.pulseClass);return"paused"===t.getOption("scheme")&&(s=!1),s},t.onprocess=function(e,n){var i=n.getMessage().getBody(),s=i.pulseHeader,o=t.getOption("scheme");return"paused"===o&&t.inbox.push({exchange:n,scope:t}),"pumpCo.user.oauth2.refresh.request"===s.pulseClass.toLowerCase()&&n.properties.setValue("scheme","xhr"),n.properties.setValue("scheme",o),t.platform&&("pumpCo.system.site.request"!==i.pulseHeader.pulseClass&&"pumpCo.user.site.request"!==i.pulseHeader.pulseClass||(i.pulseBody.place=t.platform)),n},t.optionFlush=function(){for(var e=0;e<t.inbox.length;e++){var n=t.inbox.pop();t.pulsed.call(n.scope,n.exchange)}},(e=e||{}).name=e.name||"component-pulse-controller",e.scheme=e.scheme||"",e.context=e.context||"",e.inOptions=e.inOptions||[{cls:"pumpco.system.core.cog",list:"black"},{cls:"pumpco.roadie.",list:"black"},{cls:"pumpco.internal.",list:"black"},{cls:"pumpco.",list:"white"},{cls:"user.registration",list:"white"}],e.outOptions=e.outOptions||[{cls:""}];var n=camelet.DynamicRouter(e);for(var i in n)t[i]||(t[i]=n[i]);return t._super=n,t._super.onprocess=t.onprocess,t._super.onsend=t.onsend,t.setOption("scheme","xhr"),t.setOption("flush",t.optionFlush),t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(9),n(2),n(3)],void 0===(s=function(e,t){var n=function(n){var i={};i.LAST_SEND_TIMEOUT=e.getSwitch("coreIoPulseGapTimeout")||36e5,i._lastSend=Date.now(),i.onprocess=function(e,t){var n=e.getOption("authToken");n&&t.properties.setValue("authToken",n);var i=e.getOption("Authorization");return i&&t.properties.setValue("Authorization",i),t},i.onsend=function(e,n,s){n.getHeaders();var o="/pumpco/external/open",r=n.getBody().pulseHeader;r.endpointId=i._endpointId,"pumpco.user.login.request"===r.pulseClass.toLowerCase()&&(o="/pumpco/external/secure"),s.getValue("authToken")&&(o="/pumpco/external/secure"),s.getValue("Authorization")&&(o="/pumpco/external/secure"),"pumpco.user.oauth2.login.request"!==r.pulseClass.toLowerCase()&&"pumpco.user.oauth2.refresh.request"!==r.pulseClass.toLowerCase()||(o="/pumpco/external/open");var a=e.withOptions(r.pulseClass);if(a&&(a=e.context===o),!0===a){var c=Date.now();c-i._lastSend>i.LAST_SEND_TIMEOUT&&t.fire("core.io.external.send.gap",{now:c,last:i._lastSend,header:r}),i._lastSend=c}return a},(n=n||{}).name=n.name||"component-pulse-external-out",n.scheme=n.scheme||"",n.context=n.context||"",n.inOptions=n.inOptions||[{cls:"pumpco.",list:"white"},{cls:"user.registration",list:"white"}],n.outOptions=n.outOptions||[{cls:""}],n.onsend=i.onsend;var s=camelet.DynamicRouter(n);for(var o in s)i[o]||(i[o]=s[o]);return i._super=s,i._super.onprocess=i.onprocess,i._endpointId=n.endpointId||"no endpintId set",i};function i(e){return n(e)}return i.prototype={},i}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={_timeout:void 0,_delay:144,_previous:89};t._referenceId=camelet.Utils.generateUuid(),t._stopped=!1,t._keepAlive=!1,t.createPollingMessage=function(){var e=new camelet.Message({body:{pulseHeader:{mep:"inout",pulseClass:"pumpCo.user.pulse.request",pulseId:camelet.Utils.generateUuid(),pulseResponseTimeout:"100",pulseType:"command",referenceId:t._referenceId,timestamp:camelet.Utils.now()},pulseBody:{}}}),n=new camelet.Exchange;n.setMessage(e);var i=t.getOption("scheme");return n.properties.setValue("scheme",i),n},t.resetDelay=function(){return t._keepAlive?(t._delay=12e4,t._previous=6e4):(t._delay=144,t._previous=89),t._delay},t.decrementDelay=function(){if(t._delay>144){var e=t._previous;t._previous=t._delay-t._previous,t._delay=e}return t._delay},t.incrementDelay=function(){if(t._delay<4e3){var e=t._delay;t._delay=t._delay+t._previous,t._previous=e}return t._delay},t.poll=function(){clearTimeout(t._timeout);var e=t.createPollingMessage();t.pulse(e),t._timeout=setTimeout(t.poll,t.incrementDelay())},t.optionPoll=function(e){clearTimeout(t._timeout),t._stopped||(t._timeout=setTimeout(t.poll,t.resetDelay()))},t.stopPoll=function(){clearTimeout(t._timeout),t._stopped=!0},t.keepAlive=function(){t._delay=17711,t._previous=10946,t._stopped=!1,t._keepAlive=!0,t.optionPoll()},t.startPoll=function(){t._stopped=!1,t._keepAlive=!1,t.optionPoll()},t.slowdownPoll=function(){clearTimeout(t._timeout),t._stopped||(t._timeout=setTimeout(t.poll,t.incrementDelay()))},t.speedupPoll=function(){clearTimeout(t._timeout),t._stopped||(t._timeout=setTimeout(t.poll,t.decrementDelay()))},t.onsend=function(e,n){n.getHeaders();var i=n.getBody(),s=e.withOptions(i.pulseHeader.pulseClass),o=i.pulseHeader;return"00000001-0001-4000-0001-000000000001"===o.referenceId&&(o.referenceId=t._referenceId),t._stopped||t.startPoll(),s},(e=e||{}).name=e.name||"component-pulse-external-polling",e.scheme=e.scheme||"",e.context=e.context||"",e.inOptions=e.inOptions||[{cls:"pumpco.system.core.cog",list:"black"},{cls:"pumpco.roadie.",list:"black"},{cls:"pumpco.internal.",list:"black"},{cls:"pumpco.",list:"white"},{cls:"user.registration",list:"white"}],e.outOptions=e.outOptions||[{cls:""}];var n=camelet.DynamicRouter(e);for(var i in n)t[i]||(t[i]=n[i]);return t._super=n,t._super.onsend=t.onsend,t.setOption("poll",t.optionPoll),t.setOption("pollNow",t.poll),t.setOption("pollFaster",t.speedupPoll),t.setOption("pollSlower",t.slowdownPoll),t.setOption("stop",t.stopPoll),t.setOption("start",t.startPoll),t.setOption("keepAlive",t.keepAlive),t.setOption("pollReceived",t.pollReceived),t.setOption("scheme","xhr"),t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={onsend:function(e,t){t.getHeaders();var n=t.getBody(),i=n.pulseBody,s=n.pulseHeader;return i.compId&&(s.requestingComponentId=i.compId),e.withOptions(n.pulseHeader.pulseClass)}};(e=e||{}).name=e.name||"",e.scheme=e.scheme||"",e.context=e.context||"",e.inOptions=e.inOptions||[{cls:"pumpco.system.core.cog",list:"white"},{cls:"pumpco.roadie.",list:"white"},{cls:"pumpco.internal.",list:"white"},{cls:"internal."},{cls:"user.registration",list:"black"}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={messageInCount:0,onsend:function(e,n){n.getHeaders();var i=n.getBody(),s=e.withOptions(i.pulseHeader.pulseClass);return"paused"===t.getOption("scheme")&&(s=!1),s},onprocess:function(e,t){return t}};(e=e||{}).name=e.name||"consumer-pulse-cog",e.scheme=e.scheme||"pulse",e.context=e.context||"/pumpco/cog",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend,e.onprocess=t.onprocess;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={onsend:function(e,t){t.getHeaders();var n=t.getBody();return e.withOptions(n.pulseHeader.pulseClass)}};(e=e||{}).name=e.name||"consumer-pulse-external-open",e.scheme=e.scheme||"xhr",e.context=e.context||"/pumpco/external/open",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={onsend:function(e,t){t.getHeaders();var n=t.getBody();return e.withOptions(n.pulseHeader.pulseClass)}};(e=e||{}).name=e.name||"consumer-pulse-external-secure",e.scheme=e.scheme||"pulse",e.context=e.context||"/pumpco/external/secure",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(0),n(3)],void 0===(s=function(e){var t=function(t){var n={onsend:function(t,i){i.getHeaders();var s=i.getBody(),o=t.withOptions(s.pulseHeader.pulseClass);if(s.pulseHeader.referenceId&&s.pulseHeader.referenceId.indexOf("routing-override::")>-1){o=!1;var r=s.pulseHeader.referenceId.substring("routing-override::".length),a=r.indexOf("-");a>-1&&(r=r.substring(0,a)),t.name.indexOf(r)>=0?o=!0:camelet.Log.debug(this,"*S* CP:"+n.name+"["+r+"](ComponentId Does not match EndPoints)")}else{if(s.pulseHeader.requestingComponentId)if(o=!1,t.name.indexOf(s.pulseHeader.requestingComponentId)>=0)!1===t.withOptions(s.pulseHeader.pulseClass)&&e.LogFactory().emergency("WARNING: Wiring Pulse ["+s.pulseHeader.pulseClass+"] sent to Component ["+s.pulseHeader.requestingComponentId+"] is not Registered: Check resources.json.","core/io/components/producerpulsecog"),o=!0;else camelet.Log.debug(this,"*S* CP:"+n.name+"["+s.pulseHeader.pulseClass+"](ComponentId Does not match EndPoints)")}return camelet.Log.debug(this,"*S* CP:"+n.name+"["+s.pulseHeader.pulseClass+"]("+n.messageInCount+++")"),o}};(t=t||{}).name=t.name||"producer-pulse-cog",t.scheme=t.scheme||"pulse",t.context=t.context||"/pumpco/cog",t.inOptions=t.inOptions||[{cls:""}],t.outOptions=t.outOptions||[{cls:""}],t.onsend=n.onsend;var i=camelet.DynamicRouter(t);for(var s in i)n[s]=i[s];return n._super=i,n};function n(e){return t(e)}return n.prototype={},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={onprocess:function(e,t){},onsend:function(e,t){t.getHeaders();var n=t.getBody();return e.withOptions(n.pulseHeader.pulseClass)}};(e=e||{}).name=e.name||"producer-pulse-external-open",e.scheme=e.scheme||"xhr",e.context=e.context||"/pumpco/external/open",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t._super.onprocess=t.onprocess,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(3)],void 0===(s=function(){var e=function(e){var t={onsend:function(e,t,n){t.getHeaders();var i=t.getBody(),s=e.withOptions(i.pulseHeader.pulseClass);s&&(n.getValue("scheme")!==e.scheme&&(s=!1));return s}};(e=e||{}).name=e.name||"producer-pulse-external-secure",e.scheme=e.scheme||"pulse",e.context=e.context||"/pumpco/external/secure",e.inOptions=e.inOptions||[{cls:""}],e.outOptions=e.outOptions||[{cls:""}],e.onsend=t.onsend;var n=camelet.DynamicRouter(e);for(var i in n)t[i]=n[i];return t._super=n,t};function t(t){return e(t)}return t.prototype={},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i;void 0===(i=function(){function e(e){e=e||{}}return e.prototype={},e}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(4),n(5),n(60),n(61),n(6)],void 0===(s=function(e,t,n,i,s,o,r,a){function c(e){this.name="security",this.kernel=e.kernel,this.pump=e.pump,this.location=e.location,this._authMechanismAvailable={name:void 0,token:void 0},this.createEndpointConfig(),this._plugins=[];var n=new o({parent:this});this._plugins[n.name]=n;var i=new r({parent:this});this._plugins[i.name]=i,this.pulsing(e),this.hasAuthMechanism()||this.addPulseHandler("exception.pumpCo.user.authentication.validation.invalidCredentials",this.exceptionPumpcoUserAuthenticationValidationInvalidCredentials.bind(this)),this.kernel.addApi("security.hasAuthMechanism",this.hasAuthMechanism.bind(this),this),this.kernel.addApi("security.autoLogin",this.autoLogin.bind(this)),this.kernel.addApi("security.logout",this.internalSecurityClearRequest.bind(this)),t.on("security.plugin.success",this.authPluginSuccess,this),t.on("security.plugin.timeout",this.authPluginTimeout,this),t.on("security.plugin.failure",this.authPluginFailure,this),t.on("security.plugin.invalidCredentials",this.authPluginInvalidCredentials,this),t.on("security.plugin.autoauth.failure",this.authPluginAutoAuthFailure,this),t.on("security.plugin.authtoken.invalid",this.authPluginAuthTokenInvalid,this),t.on("core.io.external.send.gap",function(e){console.log("Security: Pulse GAP io.send at: "+new Date(e.ts).toString()),this.autoLogin()}.bind(this))}return c.EVENT_NO_TOKEN="security.auth.no.token",c.prototype={},c.prototype.createEndpointConfig=function(){this.addEndpointConfig({className:"pumpCo.user.logout.request",targetName:"out"}),this.addEndpointConfig({className:"internal.security.auth.attempt",targetName:"in"}),this.addEndpointConfig({className:"internal.security.auth.success",targetName:"in"}),this.addEndpointConfig({className:"internal.security.auth.exists.request",targetName:"in"}),this.addEndpointConfig({className:"internal.security.auth.exists.response",targetName:"out"}),this.addEndpointConfig({className:"internal.security.auth.invalidCredentials",targetName:"out"}),this.addEndpointConfig({className:"internal.security.clear.request",targetName:"in"}),this.addEndpointConfig({className:"exception.pumpCo.user.authentication.validation.invalidCredentials",targetName:"in"})},c.prototype.addEndpointConfig=function(e){this._endpointConfig=this._endpointConfig||[],"in"===e.targetName?this._endpointConfig.push({className:e.className,targetName:this.name}):this._endpointConfig.push({className:e.className,targetName:"PumpHouse"})},c.prototype.pulsing=function(e){for(var t in __mixin(this,new i(e)),this.initEndpoint(this.name,this._endpointConfig),this.addPulseHandler("internal.security.auth.attempt",this.internalSecurityAuthAttempt.bind(this)),this.addPulseHandler("internal.security.auth.success",this.internalSecurityAuthSuccess.bind(this)),this.addPulseHandler("internal.security.auth.exists.request",this.internalSecurityAuthExistsRequest.bind(this)),this.addPulseHandler("internal.security.clear.request",this.internalSecurityClearRequest.bind(this)),this._plugins)this._plugins.hasOwnProperty(t)&&this._plugins[t].registerPulseHandlers()},c.prototype.internalSecurityAuthSuccess=function(e){var t=e.getPulseBody(),n=(e.getPulseHeader(),t.authToken);if((n||oauth)&&n){for(var i in this._plugins)this._plugins.hasOwnProperty(i)&&this._plugins[i].postAuthSuccess(t);this.processAuthentication.call(this,n)}},c.prototype.processAuthentication=function(e,n){var i={authtoken:e,oauth:n};this.kernel.invoke("pump.setAuthToken",i),this.pulse("internal.security.auth.response",{status:"ok"}),t.fire("security.auth.success",i)},c.prototype.pumpcoUserOauthLoginRequest=function(e){this.pulse("pumpCo.user.oauth2.login.request",{})},c.prototype.pumpcoUserOauthLoginResponse=function(e){var t=e.getPulseBody();this.processLogin(t.authToken)},c.prototype.internalSecurityAuthAttempt=function(e){var t=e.getPulseBody(),i=t.type;i||n.LogFactory().emergency("ERROR: internalSecurityAuthAttempt","core/security"),this._plugins[i.toLowerCase()].attempt(t.params)},c.prototype.internalSecurityAuthExistsRequest=function(e){var t=this.internalSecurityAuthExists.call(this);!1===t.exists&&this.pulse("internal.security.auth.exists.response",t)},c.prototype.internalSecurityAuthExists=function(){var e={exists:!1,type:"none"},t=s.get("security.oauth");t&&(the.dateTime().isBefore(the.parseDateTime(t.expires_at))?(e.exists=!0,e.type="oauth",this.processAuthentication.call(this,void 0,t)):s.del("security."));return e},c.prototype.internalSecurityClearRequest=function(e){e=e||{wait:0},s.del("security."),this.kernel.invoke("drive.deauth",{}),setTimeout(function(){t.fire("kernel.reboot",{})}.bind(this),e.wait)},c.prototype.exceptionPumpcoUserAuthenticationValidationInvalidCredentials=function(e){console.log("Security.prototype.exceptionPumpcoUserAuthenticationValidationInvalidCredentials");e.getPulseBody();var i=this._authMechanismAvailable.name,s=this._authMechanismAvailable.token;i?(n.LogFactory().debug("Security: Clean plugin auth: '"+i+"', '"+s+"'","core/security"),this._plugins[i].clean(),this.checkForAuthTokens()):t.fire("security.plugin.failure",{})},c.prototype.checkForAuthTokens=function(){for(var e in this._authMechanismAvailable={name:void 0,token:void 0},this._plugins)if(this._plugins.hasOwnProperty(e)){var t=this._plugins[e].check();if(void 0!==t&&null!==t){this._authMechanismAvailable.name=this._plugins[e].name,this._authMechanismAvailable.token=t;break}}return this._authMechanismAvailable},c.prototype.hasAuthMechanism=function(){return this.checkForAuthTokens(),this._authMechanismAvailable.name?this._authMechanismAvailable:void t.fire("security.auth.no.token",{})},c.prototype.authPluginAuthTokenInvalid=function(){this.kernel.invoke("pump.setAuthToken")},c.prototype.autoLogin=function(){var e=this._authMechanismAvailable.name,i=this._authMechanismAvailable.token;e&&i?(n.LogFactory().debug("AUTO-LOGIN: '"+e+"', '"+i+"'","core/security"),this._plugins[e].autoLogin()):t.fire("security.plugin.failure",{})},c.prototype.authPluginSuccess=function(e){this.processAuthentication(e.authToken)},c.prototype.authPluginTimeout=function(e){t.fire("security.auth.offline")},c.prototype.authPluginInvalidCredentials=function(e){this.kernel.invoke("toast.show",{msg:a.resolve("security-invalid-credentials")}),this.pulse("internal.security.auth.invalidCredentials",{})},c.prototype.authPluginAutoAuthFailure=function(e){setTimeout(function(){this.internalSecurityClearRequest()}.bind(this),0)},c.prototype.authPluginFailure=function(e){this.kernel.invoke("toast.show",{msg:a.resolve("security-sccount-problem")}),setTimeout(function(){this.internalSecurityClearRequest()}.bind(this),5e3)},c}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(7),n(2),n(0),n(4),n(5)],void 0===(s=function(e,t,n,i,s,o){function r(e,t,n){return{access_token:e.access_token,refresh_token:e.refresh_token,bearer:e.bearer,expires_in:e.expires_in,client_id:t,client_pw:n}}function a(e,t){return"Basic "+btoa(e+":"+t)}var c="security.oauth";function u(e){this.name="oauth",this._hasToken=!1,this._parent=e.parent,this._pulseTimeout=void 0,this._addedHandlers=!1,this._parent.addEndpointConfig({className:"pumpCo.user.oauth2.login.request",targetName:"out"}),this._parent.addEndpointConfig({className:"pumpCo.user.oauth2.login.response",targetName:"in"}),this._parent.addEndpointConfig({className:"pumpCo.user.oauth2.refresh.request",targetName:"out"}),this._parent.addEndpointConfig({className:"pumpCo.user.oauth2.refresh.response",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.pumpCo.user.authentication.validation.invalidCredentials",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.pumpCo.user.authorisation.validation.accessDenied",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.pulse.failure",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.system.internal",targetName:"in"})}return u.prototype={},u.prototype.registerPulseHandlers=function(){this._parent.addPulseHandler("pumpCo.user.oauth2.login.response",this.loginResponse.bind(this)),this._parent.addPulseHandler("pumpCo.user.oauth2.refresh.response",this.oauthRefreshResponse.bind(this))},u.prototype.postAuthSuccess=function(e){},u.prototype.attempt=function(e){var t={grant_type:"password",scope:"pulse",client_id:e.client_id||void 0,client_pw:e.client_pw||void 0,username:e.username.toLowerCase()||void 0,password:e.password||void 0};t.client_id&&t.client_pw&&t.username&&t.password||i.LogFactory().emergency("ERROR: OAuth.prototype.attempt: missing credentials","core/security/oauth");var n=r({},e.client_id,e.client_pw);this.clean(n);var s=a(t.client_id,t.client_pw);!function(e,t){var n=$.ajax(e);n.done(function(e){var n={data:this.data,response:e,status:200};t(n)}),n.fail(function(e,n){var i={data:this.data,response:e.responseText,status:e.status};t(i)})}({name:"oauth",url:this._parent.location.origin+"/PumpHouse/oauth2/token",data:{grant_type:t.grant_type,client_id:t.client_id,scope:t.scope,username:t.username,password:t.password},method:"POST",headers:{Authorization:s}},this.attemptCallback.bind(this))},u.prototype.attemptCallback=function(e){if(200===e.status){var t=r(e.response);this.clean(t),this.autoLogin()}else n.fire("security.plugin.invalidCredentials",{})},u.prototype.loginResponse=function(e){var t=e.getPulseBody();o.log("pumpCo.user.oauth2.login.response "+JSON.stringify(t)),this.internalSecurityAuthResponse.call(this,t)},u.prototype.refreshOAuthToken=function(){if(this._hasToken){var e={authentication:a(this._hasToken.client_id,this._hasToken.client_pw),refresh:{refresh_token:this._hasToken.refresh_token,client_id:this._hasToken.client_id,grant_type:"refresh_token"}};o.log("pumpCo.user.oauth2.refresh.request "+JSON.stringify(e)),this._parent.pulseTracked("pumpCo.user.oauth2.refresh.request",e)}},u.prototype.oauthRefreshResponse=function(e){var t=e.getPulseBody();o.log("pumpCo.user.oauth2.refresh.response "+JSON.stringify(e));var n=r(t);this.clean(n),this.autoLogin()},u.prototype.securityTimeout=function(e){clearTimeout(this._pulseTimeout),n.fire("security.plugin.timeout",{})},u.prototype.internalSecurityAuthResponse=function(e){clearTimeout(this._pulseTimeout),this._pulseTimeout=void 0,"success"===e.status.code?(i.LogFactory().debug("OAuth exchanged for: "+e.authToken,"core/security/oauth"),n.fire("security.plugin.success",{authToken:e.authToken})):(i.LogFactory().debug("OAuth could not be exchanged: "+e.status.message,"core/security/oauth"),o.del(c),n.fire("security.plugin.failure",{}))},u.prototype.exceptionPumpcoUserAuthenticationValidationInvalidCredentials=function(e){e.getPulseBody();var t=e.getPulseHeader();return this._hasToken?(o.log(JSON.stringify(e)),!0===this._parent.kernel.invoke("kernel.get.paused",{})?(o.log("Ignoring exception. I'm asleep..."),-1):void("pumpCo.user.oauth2.login.request"===t.responseToClass?(n.fire("security.plugin.authtoken.invalid",{},{sync:!0}),this.refreshOAuthToken()):"pumpCo.user.oauth2.refresh.request"===t.responseToClass&&(i.LogFactory().emergency("OAUTH: Login & Refresh fail. Re-direct to login.","core/security/oauth"),n.fire("security.plugin.autoauth.failure",{},{sync:!0})))):(i.LogFactory().debug("OAUTH: CANCELLING exception as its not for me.","core/security/oauth"),-1)},u.prototype.exceptionPumpcoUserAuthorisationValidationAccessDenied=function(e){e.getPulseBody(),e.getPulseHeader();o.log(JSON.stringify(e)),this.autoLogin()},u.prototype.exceptionSystemInternal=function(e){e.getPulseBody();"pumpCo.user.oauth2.refresh.request"===e.getPulseHeader().responseToClass&&n.fire("security.plugin.autoauth.failure",{},{sync:!0})},u.prototype.exceptionPulseFailure=function(e){console.log("exceptionPulseFailure")},u.prototype.clean=function(e){var t=o.get(c);if(t||(t=r({})),e){for(var n in e)e[n]&&""!==e[n]&&(t[n]=e[n]);o.set(c,t)}else o.del(c);o.log("local-storage "+JSON.stringify(t)),this.check()},u.prototype.check=function(){if(this._hasToken=o.get(c),this._hasToken)return this._hasToken.access_token&&this._hasToken.refresh_token&&this._hasToken.expires_in||(this._hasToken=void 0),this._hasToken&&!1===this._addedHandlers&&(this._parent.addPulseHandler("exception.pumpCo.user.authentication.validation.invalidCredentials",this.exceptionPumpcoUserAuthenticationValidationInvalidCredentials.bind(this)),this._parent.addPulseHandler("exception.pumpCo.user.authorisation.validation.accessDenied",this.exceptionPumpcoUserAuthorisationValidationAccessDenied.bind(this)),this._parent.addPulseHandler("exception.pulse.failure",this.exceptionPulseFailure.bind(this)),this._parent.addPulseHandler("exception.system.internal",this.exceptionSystemInternal.bind(this)),this._addedHandlers=!0),this._hasToken},u.prototype.autoLogin=function(){this._hasToken;this.check();var e="Bearer "+this._hasToken.access_token;i.LogFactory().debug(e,"core/security/oauth"),this._pulseTimeout=setTimeout(this.securityTimeout.bind(this),2e3),o.log("pumpCo.user.oauth2.login.request { authentication:"+e+"}"),this._parent.pulse("pumpCo.user.oauth2.login.request",{authentication:e})},u}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(7),n(2),n(0),n(4),n(5)],void 0===(s=function(e,t,n,i,s,o){var r="rememberMeToken";function a(e){var t={};return t[c]=e[r],t}var c="security.rememberme";function u(e){this.name="rememberme",this._hasToken=!1,this._parent=e.parent,this._pulseTimeout=void 0,this._parent.addEndpointConfig({className:"pumpCo.user.rememberme.login.request",targetName:"out"}),this._parent.addEndpointConfig({className:"pumpCo.user.rememberme.login.response",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.pumpCo.user.authentication.validation.invalidCredentials",targetName:"in"}),this._parent.addEndpointConfig({className:"exception.pumpCo.user.rememberme.login.failed",targetName:"in"}),n.on("security.plugin.rememberme.response",this.refreshRememberMeToken,this)}return u.prototype={},u.prototype.registerPulseHandlers=function(){this._parent.addPulseHandler("pumpCo.user.rememberme.login.response",this.loginResponse.bind(this)),this._parent.addPulseHandler("exception.pumpCo.user.rememberme.login.failed",this.exceptionHandler.bind(this))},u.prototype.postAuthSuccess=function(e){if(e[r]){var t=a(e);this.clean(t)}},u.prototype.attempt=function(e){},u.prototype.loginResponse=function(e){var t=e.getPulseBody();n.fire("security.plugin.rememberme.response",{}),this.internalSecurityAuthResponse.call(this,t)},u.prototype.refreshRememberMeToken=function(){},u.prototype.securityTimeout=function(e){clearTimeout(this._pulseTimeout),this._pulseTimeout="timeout_actioned",n.fire("security.plugin.timeout",{})},u.prototype.internalSecurityAuthResponse=function(e){if(this._pulseTimeout&&"timeout_actioned"===this._pulseTimeout)return i.LogFactory().debug("SECURITY: Pulse timed out on auth request.","core/security/rememberme"),-1;if(clearTimeout(this._pulseTimeout),this._pulseTimeout=void 0,"success"===e.status.code){i.LogFactory().debug("RememberMe exchanged for: "+e.authToken,"core/security/rememberme");var t=a(e);this.clean(t),n.fire("security.plugin.success",{authToken:e.authToken})}else i.LogFactory().debug("RememberMe could not be exchanged: "+e.status.message,"core/security/rememberme"),o.del(c),n.fire("security.plugin.failure",{})},u.prototype.exceptionHandler=function(e){var t=e.getPulseBody(),s=e.getPulseHeader();if(i.LogFactory().emergency(s.pulseClass,"core/security/rememberme"),i.LogFactory().debug("++body++","core/security/rememberme"),i.LogFactory().debug(JSON.stringify(t),"core/security/rememberme"),i.LogFactory().debug("++this++","core/security/rememberme"),i.LogFactory().debug(JSON.stringify(this._hasToken),"core/security/rememberme"),"exception.pumpCo.user.rememberme.login.failed"===s.pulseClass&&(i.LogFactory().emergency("exception.pumpCo.user.rememberme.login.failed","core/security/rememberme"),n.fire("security.plugin.autoauth.failure",{})),!this._hasToken)return i.LogFactory().debug("REMEMBERME: CANCELLING exception as its not for me.","core/security/rememberme"),-1;"exception.pumpCo.user.authentication.validation.invalidCredentials"===s.pulseClass&&(this._hasToken&&this._hasToken[c]?(n.fire("security.plugin.authtoken.invalid",{},{sync:!0}),this.autoLogin()):n.fire("security.plugin.autoauth.failure",{}))},u.prototype.clean=function(e){var t=o.get(c);if(t||(t=a({})),e){for(var n in e)e[n]&&""!==e[n]&&(t[n]=e[n]);o.set(c,t)}else o.del(c);this.check()},u.prototype.check=function(){if(this._hasToken=o.get(c),this._hasToken)return this._hasToken[c]||(this._hasToken=void 0),this._hasToken&&this._parent.addPulseHandler("exception.pumpCo.user.authentication.validation.invalidCredentials",this.exceptionHandler.bind(this)),this._hasToken},u.prototype.autoLogin=function(){var e=o.get(c);delete this._hasToken[c],o.set(c,this._hasToken),this._parent.pulse("pumpCo.user.rememberme.login.request",{token:e[c]})},u}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(13),n(2),n(0),n(6),n(4),n(63),n(25),n(26),n(27),n(68),n(5),n(69)],void 0===(s=function(e,t,n,i,s,o,r,a,c,u,l,p){n.LogFactory().debug("services/drive","services/drive");var d="build";function h(e){if(this.name="drive",this.version="0.0.1",this.timestamp=Date.now(),this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{},this.location=e.location||{},this._useMinimal=this.runtime.wrapped||!1,this._useMinimal=this.runtime.minimal||!1,this._preferCache="prefer"===e.driveParams,this._beans={},this._cache={},this._callbacks={},this.build=e.build,__mixin(this,new s(e)),this.initEndpoint(this.name,[{className:"pumpCo.system.site.request",targetName:"PumpHouse"},{className:"pumpCo.system.site.response",targetName:"Drive"},{className:"pumpCo.user.site.request",targetName:"PumpHouse"},{className:"pumpCo.user.site.response",targetName:"Drive"},{className:"pumpCo.user.place.request",targetName:"PumpHouse"},{className:"pumpCo.user.place.response",targetName:"Drive"},{className:"pumpCo.user.profile.get.request",targetName:"PumpHouse"},{className:"pumpCo.user.profile.get.response",targetName:"Drive"},{className:"exception.system.site.request.noSiteId",targetName:"Drive"},{className:"exception.system.site.request.siteNotFound",targetName:"Drive"}]),this.addPulseHandler("pumpCo.system.site.response",this.systemSiteLoaded),this.addPulseHandler("pumpCo.user.site.response",this.userSiteLoaded),this.addPulseHandler("pumpCo.user.place.response",this.userPlaceLoaded),this.addPulseHandler("pumpCo.user.profile.get.response",this.userLoaded),this.addPulseHandler("exception.system.site.request.noSiteId",this.userSiteException),this.addPulseHandler("exception.system.site.request.siteNotFound",this.userSiteException),t.on("drive.get.systemsite",function(e){this.getSystemSite(e)},this),t.on("drive.get.appsystemsite",function(e){this.getAppSystemSite(e)},this),t.on("drive.get.usersite",function(e){this.getUserSite(e)},this),t.on("drive.get.appsite",function(e){this.getAppSite(e)},this),t.on("drive.get.place",function(e){this.getPlace(e)},this),t.on("drive.get.space",function(e){this.getSpace(e)},this),t.on("drive.get.cog",function(e){this.getCog(e)},this),t.on("drive.get.user",function(e){this.getUser(e)},this),t.on("pump.xhr-ping-error",function(e){this.xhrError(e)},this),t.on("security.auth.no.token",function(e){this.cacheClear("drive.auth-user")},this),this.kernel.addApi("drive.cache",function(e){this.cache(e.key,e.obj)},this),this.kernel.addApi("drive.clear",function(e){e=e||"*",this.cacheClear(e)},this),this.kernel.addApi("drive.clean",this.cacheClean,this),this.kernel.addApi("drive.deauth",this.cacheRemoveCredentials,this),this._preferCache||this.cacheClear("drive."),"clear"===e.driveParams&&this.cacheClear("*"),this._preferCache){var n=l.get(d);n&&n===this.build||(this.cacheClear("*"),l.set(d,this.build)),this.cacheLoad()}this.onready()}return h.prototype={},h.prototype.onready=function(){this.kernel.invoke("kernel.process.loaded",{name:this.name})},h.prototype.CLASSMAP={"pumpCo.system.site.response":"processSystemSite","pumpCo.user.site.response":"processUserSite","pumpCo.user.profile.get.response":"processUser","pumpCo.user.place.response":"processPlace"},h.prototype.cacheLoad=function(){this._cache={};var e=l.getAll("drive.");for(var t in e){var n=t.substring(6),i=JSON.parse(e[t]);this.cache(n,i)}},h.prototype.cacheClean=function(e){l.delAllBut("drive",[d,"auth-user","pumpco-error-site-01"])},h.prototype.cacheRemoveCredentials=function(e){l.del("drive.auth-user")},h.prototype.cacheClear=function(e){e=e||"drive.",l.del(e),this.cacheLoad()},h.prototype.cache=function(e,t){void 0===this._cache[e]&&(this._cache[e]=t),this._preferCache&&l.set("drive."+e,t)},h.prototype.addRoute=function(e){n.LogFactory().debug("Drive.addRoute():["+e.ns+":"+e.type+"]","services/drive")},h.prototype.addCallback=function(e,t,n){this._callbacks[e]={fn:t,scope:n}},h.prototype.getCallback=function(e){return this._callbacks[e]},h.prototype.delCallback=function(e){delete this._callbacks[e]},h.prototype.invokeCallback=function(e,t,n){t=t||e.id;var i=this.getCallback(t);i&&(this.delCallback(t),i.fn.call(i.scope,e,n))},h.prototype.find=function(e,t,n,i){var s=["params"],o=void 0;if(the.isArray(e))for(var r=0;r<e.length;r++){var a=e.id||i;if(o=this.find(e[r],t,n,a))break}if(the.isObject(e))for(var r in e)if(-1===$.inArray(r,s))if(the.isObject(e[r])||the.isArray(e[r])){a=e.id||i;if(o=this.find(e[r],t,n,a))break}else if(r===t&&e[r]===n){(o=e).parentId=i;break}return o},h.prototype.xhrError=function(e){if("pumpCo.system.site.request"===__get("request.pulseHeader.pulseClass",e)){var t=__get("request.pulseBody.siteId",e);this.invokeCallback(void 0,t,"404")}},h.prototype.getSystemSite=function(e){this.addCallback(e.id,e.fn,e.scope);the.generateUuid();e.minimal=this._useMinimal?"true":"false",this._cache[e.id]?(n.LogFactory().debug("getSystemSite(): get site["+e.id+"] from cache.","services/drive"),this.processSystemSite(this._cache[e.id])):(n.LogFactory().debug("getSystemSite(): load site["+e.id+"] from pumphouse.","services/drive"),this.loadSystemSite(e))},h.prototype.getUserSite=function(e){this.addCallback(e.id,e.fn,e.scope);the.generateUuid();if(e.minimal=this._useMinimal?"true":"false",this._cache[e.id]){n.LogFactory().debug("getUserSite(): get site["+e.id+"] from cache.","services/drive");var t=this._cache[e.id];this.processUserSite(t),e.hash=__get("hash",t)||"no-hash",e.refId="hash="+e.hash,this.loadUserSite(e)}else n.LogFactory().debug("getUserSite(): load site["+e.id+"] from pumphouse.","services/drive"),this.loadUserSite(e)},h.prototype.getAppSite=function(t){this.addCallback(t.id,t.fn,t.scope),t.refId="app="+t.app,t.minimal=this._useMinimal?"true":"false";var i=e.direct(["*",":return","owner",">","id:"+t.id],this._cache);i?(n.LogFactory().debug("getUserSite(): get site["+i.id+"] from cache.","services/drive"),this.processUserSite(i)):(n.LogFactory().debug("getUserSite(): load site["+t.id+"] from pumphouse.","services/drive"),this.loadUserSite(t))},h.prototype.getAppSystemSite=function(e){this.addCallback(e.id,e.fn,e.scope),e.refId="app="+e.app,e.minimal=this._useMinimal?"true":"false";var t=void 0;if(e.app)for(var i in this._cache)if(this._cache[i].name===e.app){t=this._cache[i];break}t||(t=this._cache[e.id]),t?(n.LogFactory().debug("getSystemSite(): get site["+t.id+"] from cache.","services/drive"),this.processSystemSite(t)):(n.LogFactory().debug("getSystemSite(): load site["+e.id+"] from pumphouse.","services/drive"),this.loadSystemSite(e))},h.prototype.getPlace=function(e){e=e||{},this.addCallback("place-loaded",e.fn,e.scope),n.LogFactory().info("Place: Getting ["+e.id+"] from drive.","services/drive"),n.LogFactory().debug('287: this.find( this._cache, "id", '+e.id+" ) )","services/drive");var t=this.find(this._cache,"id",e.id);if(!t&&e.ownerId)for(var s in this._cache){var o=this._cache[s];if(o.owner&&o.owner.id&&o.owner.id===e.ownerId){t=o;break}}if(t&&!e.refresh)this.processPlace(t);else{this.kernel.invoke("toast.show",{msg:i.resolve("place-loading-msg")});var r=e.place;s=the.generateUuid();this.pulse("pumpCo.user.place.request",r.getPulseBody(),s)}},h.prototype.getSpace=function(e){var t="id";e.id||(t="name");var i=void 0;if(this.addCallback(t,e.fn,e.scope),"id"===t)n.LogFactory().debug('328:this.find( this._cache, "id", '+e[t]+" ) )"),i=this.find(this._cache,t,e[t]);else{n.LogFactory().debug('332:this.find( this._cache, "id", '+e.parentId+" ) )","services/drive");for(var s=this.find(this._cache,"id",e.parentId),o=s.space||s.Home.space,r=0;r<o.length;r++)if(o[r].name===e[t]){(i=o[r]).parentId=e.parentId,n.LogFactory().debug("services/drive.getSpace(): Found space ["+i.name+"]","services/drive");break}if(!i)for(r=0;r<o.length;r++){var a=e[t].toLowerCase(),c=a.indexOf(".");if(a=a.substring(0,c+1)+"mobile"+a.substring(c+1),o[r].name.toLowerCase()===a){(i=o[r]).parentId=e.parentId,n.LogFactory().debug("services/drive.getSpace(): Found space ["+i.name+"]","services/drive");break}}}if(i)this.processSpace(i,t);else{var u={ok:!1,key:e[t]};this.invokeCallback(void 0,t,u)}},h.prototype.getCog=function(e){this.addCallback(e.id,e.fn,e.scope);var t=this.find(this._cache,"id",e.id);t&&this.processCog(t)},h.prototype.getUser=function(t){this.addCallback(t.id,t.fn,t.scope),n.LogFactory().debug('410: this.find( this._cache, "id", '+t.id+" ) )","services/drive"),!0===t.refresh&&delete this._cache["auth-user"];var i=e.direct(["auth-user",":return"],this._cache);i?this.processUser(i):this.loadUser(t)},h.prototype.loadSystemSite=function(e){n.LogFactory().debug("Drive.loadSystemSite("+e.id+");","services/drive");var t=e.minimal||"false",i={siteId:e.id,site:{minimal:t}};this.pulse("pumpCo.system.site.request",i,e.refId)},h.prototype.loadUserSite=function(e){n.LogFactory().debug("Drive.loadUserSite("+e.id+");","services/drive");var t={site:{minimal:e.minimal||"false"}};e.hash&&(t.site.hash=e.hash),this.pulse("pumpCo.user.site.request",t,e.refId)},h.prototype.loadUser=function(e){n.LogFactory().debug("Drive.loadUser("+e.id+");","services/drive");this.pulse("pumpCo.user.profile.get.request",{},e.ref)},h.prototype.systemSiteLoaded=function(e){e.getPulseHeader(),e.getPulseBody();this.loaded(e,function(e){return e.site.id},function(e){return e.site})},h.prototype.userSiteLoaded=function(e){function t(e){return(e.site.place.Home||e.site.place.Mobile).owner.id}function n(e){return e.site}var i=e.getPulseHeader(),s=e.getPulseBody();i.referenceId.indexOf("hash=")>=0?__get("site.hashMatch",s)||this.cache(t(s),n(s)):this.loaded(e,t,n)},h.prototype.userSiteException=function(e){var t=e.getPulseBody();kernel.invoke("snackbar.show",{msg:t.status.message})},h.prototype.userPlaceLoaded=function(e){this.loaded(e,function(e){return e.place.id},function(e){return e.place})},h.prototype.userLoaded=function(e){this.loaded(e,function(e){return"auth-user"},function(e){return e})},h.prototype.loaded=function(e,t,i){if(n.LogFactory().debug("Drive.loaded():","services/drive"),e){var s=e.getPulseHeader().referenceId,o=e.getPulseClass();if(o){var r=e.getPulseBody(),a=t(r);this.cache(a,i(r)),this[this.CLASSMAP[o]](this._cache[a],s)}}},h.prototype.processSystemSite=function(e){var t=new o;t.update(e),this.invokeCallback(t)},h.prototype.processUserSite=function(e,t){var n=void 0,i=void 0;e?((n=new o).update(e),i=(e.place.Home||e.place.Mobile).owner.id):i=t.id;this.invokeCallback(n,i)},h.prototype.processPlace=function(e,t){var n=new r;n.update(e),this.invokeCallback(n,"place-loaded")},h.prototype.processSpace=function(e,t){var n=new a;n.update(e),this.invokeCallback(n,t)},h.prototype.processCog=function(e){function t(e,t){var n=[];for(var i in e)n.push(e[i]);return n.join(t)}function i(e){if(e[Object.keys(e)[0]],void 0!==e){var t=Object.keys(e);return t.length>0&&"error"!==e[t[0]]}return!1}var s=new c;s.update(e),this._useMinimal?new p({origin:this.location.origin,runtime:this.runtime}).done(function(e){if(n.LogFactory().debug("CogLoader Promise: "+s.id+"-"+s.name,"services/drive"),s.isValid=!0,i(e.js)?s.script=t(e.js,"\n\n"):s.isValid=!1,i(e.html)?s.html=t(e.html,"\n\n"):s.isValid=!1,i(e.css)&&(s.style=t(e.css,"\n\n")),i(e.lang)){e=t(e.lang,"\n\n");s.lang=JSON.parse(e)}this.invokeCallback(s)}.bind(this)).load(s):this.invokeCallback(s)},h.prototype.processUser=function(e){var t=new u;t.update(e),this.invokeCallback(t,"auth-user")},h.prototype.toString=function(){return this.name+":"+this.version},h}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(8)],void 0===(s=function(e,t){function n(){this.application={"*":"*"},this.bootstrapSite="",this.bootstrapPath="",this.id="",this.name="",this.style=e.observable(""),this.title=e.observable(""),this.wallpaper=e.observable(""),this.owner={"*":"*"},this.place={Home:{id:""},Mobile:{id:""}},this.parentId="",this.oVisible=e.observable(!1)}return n.prototype={},n.prototype.update=function(e){t.fromJS(this,e)},n}.apply(t,i))||(e.exports=s)},function(e,t){!function(){e.exports=this.Notify}()},function(e,t,n){var i;void 0===(i=function(){return{match:"Vue",setup:function(e,t){return e.$Vue=function(n){(n=n||{}).el=void 0===n.el?"#"+e.id:"#"+e.id+" "+n.el,t.call(this,n)},e.$Vue.prototype=Object.create(t.prototype),__mixin(e.$Vue,t),e}}}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,s;i=[n(0)],void 0===(s=function(e){return{_addTry:function(e){var t=[];return!1!==(e=e||!1)&&t.push('"use strict";\n'),t.push("\n// CI Try block"),t.push("\ntry {\n"),t.join("")},_addCatch:function(){return'// CI Catch Block\n} catch ( ex ) {\nvar msg = ex.message || ex;\nmy.$emergency( "Error in Cog [" + my.name + "]: " + ex.message );}\n'},_addDebug:function(){return"// Dynamic debugger\n debugger;\n"},addTryCatch:function(t,n){n=n||!1;var i=t,s=this.script.indexOf("the.App.onReady");if(-1===s)return i;var o=this.script.indexOf("{",s),r=this.script.lastIndexOf("}");if(-1===o||-1===r)return e.LogFactory().debug("Try / Catch enhancement Failed.","cog/script"),i;o=0,r=this.script.length;var a=this.script.substring(0,o),c=this.script.substring(o,r),u=this.script.substring(r);return i=a+this._addTry(n)+c+this._addCatch()+u},addDebugger:function(e){var t=e,n=this.script.indexOf("the.App.onReady");if(-1===n)return t;var i=this.script.indexOf("{",n),s=this.script.substring(0,i+1),o=this.script.substring(i+1);return t=s+this._addDebug()+o}}}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(0),n(22)],void 0===(s=function(e,t){return{initEndPoint:function(e){var t=this.id;this.createV2Endpoints(e,t,this.capability)},createV2Endpoints:function(n,i,s){e.LogFactory().debug("Service Mixin init()","cog/endpoint");for(var o=[],r=[],a=this.getPulseRegistrations(),c=0;c<a.length;c++){var u=a[c];"PRODUCER"===u.direction?r.push({cls:u.trait,list:"white"}):o.push({cls:u.trait,list:"white"}),e.LogFactory().debug("COG Route whitelisting of ["+u.trait+"] to Target ["+u.direction+"] ","cog/endpoint")}this.endPoint=new t({name:i,pump:n,consume:o,produce:r})},deinitEndPoint:function(){this.endPoint.delRoute({targetName:this.address})}}}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(8)],void 0===(s=function(e,t){function n(){this.profileImage={"*":"*"},this.profileBody={"*":"*"},this.contactDetails={"*":"*"},this.extensions={"*":"*"},this.visibility={"*":"*"},this.vcard={"*":"*"},this.team={"*":"*"},this.location={tz:{label:"time zone",type:"tz",value:"Europe/London"},locale:{label:"locale",type:"locale",value:"en-gb"}},this.current={"*":"*"}}return n.prototype={},n.prototype.setLocation=function(e){for(var t=0;t<e.length;t++)this.location[e[t].type]=e[t]},n.prototype.update=function(e){return t.fromJS(this,e),this.id=this.profileBody.username,this},n.prototype.getTeams=function(){return this.team||[]},n.prototype.getInitials=function(){var e=__get("vcard.fn",this);return e?the.abbreviate(e):""},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2),n(0),n(13),n(30)],void 0===(s=function(e,t,n,i){function s(e){this._origin=e.origin||"http://no-origin-set",this._path=e.path||null,this._done=function(e){return this},this._loader=new i(this.loadedCode.bind(this)),this._staticCode=!1,e.runtime&&!0===e.runtime.wrapped?(this._staticCode=!0,!0===e.testmode?this.workingUrl=this._origin+this._path:this.workingUrl="fixtures"):null!==this._path?this.workingUrl=this._origin+this._path:this.workingUrl=this._origin+"/PumpHouse/fixture"}return s.prototype={},s.prototype.done=function(e){return this._done=e,this},s.prototype.load=function(e){return!1===this._staticCode?this.loadCode(e):this.loadResources(e.name,function(t){e.htmlUrl=t.htmlUrl||"",e.langUrl=t.langUrl||"",e.scriptUrl=t.scriptUrl||[],e.styleUrl=t.styleUrl||"",this.loadCode(e)}.bind(this)),this},s.stripComments=function(e){return e.replace(/\/\*([\s\S])*?\*\//g,"").replace(/(?:^|\s)\/\/([^'"]*?).*/g,"")},s.parseResources=function(e){e=s.stripComments(e);var t=JSON.parse(e);return t.htmlUrl=t.html,t.langUrl=t.lang,t.scriptUrl=the.isArray(t.script)?t.script:[t.script],t.styleUrl=t.style,t},s.prototype.loadResources=function(e,t){var n={json:{}},o=e.split("."),r=o[0].toLowerCase()+"/"+o[1],a=this.workingUrl+"/"+r+"/resources.json";n.json[a]=void 0,new i(function(e){var n=e.json[a],i=s.parseResources(n);t(i)}.bind(this)).load(n)},s.prototype.loadCode=function(e){function t(e){if(!e||""===e)return e;if(e.replace){var t=e.replace(/file:\/(.)*fixtures\//,""),n=t.indexOf("/");t=t.substring(n)}return t||""}for(var n={js:{},html:{},css:{},lang:{}},s=0;s<e.scriptUrl.length;s++)n.js[this.workingUrl+t(e.scriptUrl[s])]=void 0;var o=t(e.htmlUrl);o&&(n.html[this.workingUrl+o]=void 0);var r=t(e.styleUrl);r&&(n.css[this.workingUrl+r]=void 0);var a=t(e.langUrl);return a&&(n.lang[this.workingUrl+a]=void 0),new i(this.loadedCode.bind(this)).load(n),this},s.prototype.loadedCode=function(e){this._done(e)},s}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(4),n(14)],void 0===(s=function(e,t,n,i,s){var o;function r(e){o=this,this.name="Contact",this.version="0.0.1",this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{},this.components={},this.model.contacts=this.contacts={notifyContacts:function(){this._readyContacts=!0},denotifyContacts:function(){this._readyContacts=!1},readyContacts:function(){return this._readyContacts},notifyActor:function(){this._readyActor=!0},ready:function(){return!(!this._readyContacts||!this._readyActor)},_readyContacts:!1,_readyActor:!1,user:void 0,local:void 0,actors:new s("uid")},this.model.circles=this.circles={},__mixin(this,new i(e)),this.initEndpoint(this.name,[{className:"pumpCo.user.contact.add.request",targetName:"PumpHouse"},{className:"pumpCo.user.contact.add.response",targetName:this.name},{className:"exception.pumpCo.contactAdd.contactAlreadyExists",targetName:this.name},{className:"pumpCo.user.contact.list.request",targetName:"PumpHouse"},{className:"pumpCo.user.contact.list.response",targetName:this.name},{className:"pumpCo.event.user.contact.list.updated",targetName:this.name},{className:"pumpCo.event.user.contact.updated",targetName:this.name},{className:"pumpCo.user.actor.details.request",targetName:"PumpHouse"},{className:"pumpCo.user.actor.details.response",targetName:"Contact"},{className:"internal.contact.list.request",targetName:"Contact"},{className:"internal.contact.list.response",targetName:"PumpHouse"},{className:"internal.contact.list.event",targetName:"PumpHouse"},{className:"internal.user.contact.add.request",targetName:this.name},{className:"internal.user.contact.add.response",targetName:"PumpHouse"},{className:"internal.circle.list.request",targetName:"Contact"},{className:"internal.circle.list.response",targetName:"PumpHouse"},{className:"internal.circle.list.event",targetName:"PumpHouse"},{className:"pumpCo.user.circle.list.response",targetName:"Contact"},{className:"pumpCo.user.circle.list.request",targetName:"PumpHouse"}]),this.addPulseHandler("pumpCo.user.contact.add.response",this.userContactAddResponse),this.addPulseHandler("pumpCo.user.contact.list.response",this.userContactListResponse),this.addPulseHandler("pumpCo.user.actor.details.response",this.userActorDetailsResponse),this.addPulseHandler("pumpCo.event.user.contact.list.updated",this.eventUserContactListUpdated),this.addPulseHandler("pumpCo.event.user.contact.updated",this.eventUserContactListUpdated),this.addPulseHandler("internal.contact.list.request",this.internalContactListRequest),this.addPulseHandler("internal.user.contact.add.request",this.internalContactAddRequest),this.addPulseHandler("internal.circle.list.request",this.internalCircleListRequest),this.addPulseHandler("pumpCo.user.circle.list.response",this.externalCircleListResponse),this.addPulseHandler("exception.pumpCo.contactAdd.contactAlreadyExists",this.exceptionContactAlreadyExists.bind(this)),t.on("place.shown",function(e){this.placeShown(e)},this),t.on("user.loaded",function(e){this.userLoaded(e)},this),this.kernel.addApi("getUser",this.getUser,this),this.kernel.addApi("contacts.get.contacts",this.getContactList,this),this.kernel.addApi("contacts.get.contact.by.id",function(e){return this.getContactById(e.id)},this),this.addLegacyAPI(),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return r.prototype={},r.prototype.addLegacyAPI=function(){var e=this;__ns("pumpco.interfaces.local"),pumpco.interfaces.local.ContactsInterface=function(t){t.pump;var n=t.loaded;return{loadContacts:function(){n&&n.call(this)},getAllContacts:function(){return e.getAllContacts("local")},getContactById:function(t){var i=e.getContactById.call(e,t);return i||e.actorRequest(t,n),i},pulsed:function(){}}},__ns("pumpco.interfaces.remote"),pumpco.interfaces.remote.ContactsInterface=function(t){t.pump;var n=t.loaded;return{loadContacts:function(){n&&n.call(this)},getAllContacts:function(){var t=o.kernel.invoke("getPlace",{});return e.getAllContacts(t.id)},getContactById:function(t){return e.getContactById.call(e,t)},pulsed:function(){}}}},r.prototype.registerComponent=function(e,t){this.components[e]=t},r.prototype.getContactById=function(e){return this.findInAll(e)},r.prototype.getAllContacts=function(e){return this.findAll(e)},r.prototype.findAll=function(e){var t=[],n=this.contacts[e];return n&&__.eachSync2(n.array(),function(e,n,i){t.push(e)}),t},r.prototype.findInAll=function(e){if(this.contacts.user&&this.contacts.user.id===e)return this.contacts.user;var t=void 0;for(var n in this.contacts){var i=this.contacts[n];if(i&&i.find&&(t=i.find(e)))break}return t},r.prototype.userActorDetailsResponse=function(e){n.LogFactory().debug("UserActorDetailsResponse","services/contact");var t=e.getPulseBody();e.getPulseHeader();if(this.contacts.user||(this.contacts.user=t.actor[0]),t.actor&&t.actor.length>=1&&this.contacts.local){var i=t.actor[0];i.uid=i.uid||i.id,this.contacts.actors.insert(i),this.actorRequestCallback&&(this.actorRequestCallback(),this.actorRequestCallback=void 0)}this.contacts.notifyActor(),this.contacts.ready()&&this.pulseContactListToAll()},r.prototype.eventUserContactListUpdated=function(e){n.LogFactory().debug("eventUserContactListUpdated","services/contact");var t=e.getPulseBody();e.getPulseHeader();"success"===t.status.code&&!0===this.contacts.readyContacts()&&(this.contacts.denotifyContacts(),this.requestContactList())},r.prototype.hasPlaceContacts=function(e){return!!this.contacts[e]},r.prototype.addNewPlaceContacts=function(e,t){var n;(n=this.contacts[e]?this.contacts[e]:this.contacts[e]=new s("uid")).empty();for(var i=0;i<t.length;i++)n.push(t[i])},r.prototype.userContactListResponse=function(e){n.LogFactory().debug("UserContactListResponse","services/contact");var t=e.getPulseBody(),i=e.getPulseHeader().referenceId.substring("routing-override::Contact-".length);if(i){this.addNewPlaceContacts.call(this,i,t.contacts);var s=this.kernel.invoke("place.get.owners",{});s&&s.id===i&&(this.contacts.local=this.contacts[i])}this.contacts.notifyContacts(),this.pulse("internal.contact.list.event",{type:"updated"})},r.prototype.getUser=function(e){return this.contacts.user},r.prototype.placeShown=function(e){n.LogFactory().debug("Event:PlaceShown","services/contact");var t=e.place;if(!this.kernel.invoke("user.get.auth"))return n.LogFactory().emergency("Contact.placeShown: User NOT authenticated.","services/contact"),-2;this.hasPlaceContacts(t.id)||t.contactCompId&&void 0!==t.contactCompId&&this.requestContactList(t)},r.prototype.requestContactList=function(e){e||(e=this.kernel.invoke("place.get.owners",{}));var t="routing-override::Contact-"+e.id;this.pulse("pumpCo.user.contact.list.request",{},t,e.contactCompId)},r.prototype.userLoaded=function(e){n.LogFactory().debug("Event:UserLoaded","services/contact"),this.actorRequest(e.profileBody.id)},r.prototype._actorRequests=[],r.prototype.actorRequest=function(e,t){if(-1===$.inArray(e,this._actorRequests)){this._actorRequests.push(e),this.actorRequestCallback=t;this.pulse("pumpCo.user.actor.details.request",{id:e},"routing-override::Contact-")}},r.prototype.internalActorRequest=function(e,t){},r.prototype.internalContactListRequest=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=__get("place.id",n),s=this.getContactList({placeId:i});this.registerComponent(t.componentId,i),this.pulseContactListTo(s,t.componentId)},r.prototype.internalContactAddRequest=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=this.kernel.invoke("place.get.owners",{}),s="routing-override::Contact-"+t.componentId;this.pulse("pumpCo.user.contact.add.request",n,s,i.contactCompId)},r.prototype.userContactAddResponse=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=t.referenceId.split("Contact-");this.pulse("internal.user.contact.add.response",n,void 0,i[1])},r.prototype.pulseContactListToAll=function(){for(var e in this.components){var t=this.getContactList({placeId:this.components[e]});this.pulseContactListTo(t,e)}this.components={}},r.prototype.pulseContactListTo=function(e,t){this.contacts.ready&&this.pulse("internal.contact.list.response",e,void 0,void 0,t)},r.prototype.getContactList=function(e){var t=[];return e.placeId?o.contacts[e.placeId]&&(t=o.contacts[e.placeId].array()):o.contacts.local&&(t=o.contacts.local.array()),{contacts:t,group:[]}},r.prototype.internalCircleListRequest=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=n.name;if(!i)return-1;o.circles[i],o.circles[i]={_componentId:t.componentId},this.pulse("pumpCo.user.circle.list.request",n,void 0,void 0,t.componentId)},r.prototype.externalCircleListResponse=function(e){e.getPulseHeader();var t=e.getPulseBody().circle;o.circles[t.name]&&(o.circles[t.name].body=t,o.internalCircleListResponse(t.name))},r.prototype.internalCircleListResponse=function(e){var t=o.circles[e],n={circle:t.body};this.pulse("internal.circle.list.response",n,void 0,void 0,t._componentId)},r.prototype.exceptionContactAlreadyExists=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=t.referenceId.split("Contact-");this.pulse("internal.user.contact.add.exception",n,void 0,i[1])},r.prototype.scanforDataContacts=function(e){},r}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(16),n(0)],void 0===(s=function(e,t){var n={basicAppStyles:function(e,t){var n=document.body;n.innerHTML=e,n.setAttribute("data-bind","body:$data"),n.setAttribute("style","background-attachment:fixed;")},queryAppParams:function(){var t={},n=window.params||{};return t.platform="Desktop",t.useSocket=e.getParam("socket",n,!0),t.cogDebug=e.getParam("cog",n,!0),t.appParams=e.getParam("app",n,void 0),t.driveParams=e.getParam("drive",n,void 0),t.buildParams=e.getParam("build",n,"0.1"),t.wrappedParams=e.getParam("wrapped",n,void 0),t.pwaParams=e.getParam("pwa",n,void 0),t.minimalParams=e.getParam("minimal",n,!0),t.launchParams=e.getParam("launch",n,void 0),t.roadieParams=e.getParam("roadieUrl",n,void 0),t.consoleParams=e.getParam("console",n,void 0),t.debugParams=e.getParam("debug",n,void 0),t.logConfig=e.getParam("log",n,0),t.location=e.getLocation(window.params),t},configureLogging:function(e){var n={level:parseInt(e)||0,ns:""};if(e&&e.indexOf(":")>-1){var i=e.split(":");n.level=i[0],n.ns=i[1]}var s=t.LogFactory();s.logLevel=n.level,s.filter=n.ns,the.log.debug=function(e,n){t.LogFactory().debug(n)},the.log.error=function(e,n){t.LogFactory().error(n)},the.log.warning=function(e,n){t.LogFactory().warning(n)},the.log.info=function(e,n){t.LogFactory().info(n)},the.log.emergency=function(e){t.LogFactory().emergency(e)},the.log.just=function(e,t){}},configurePhil:function(e){phil._paths.phil=e.pumpface+"templates/phil",phil._paths.aos=e.pumpface+"templates/aos",phil._paths.fixture=e.fixtures},serviceWorkers:function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(function(){t.LogFactory().debug("Service Worker Registered")})}};return n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(4),n(25),n(73),n(18),n(6)],void 0===(s=function(e,t,n,i,s,o,r,a){var c;function u(n){c=this,this.name="place",this.version="0.0.1",this._launch=n.launchParams||void 0,this._roadie=n.roadieParams?decodeURIComponent(n.roadieParams):void 0,this.current=void 0,this.waitingToShow=[],this.kernel=n.kernel,this.runtime=n.runtime||{},n.model.places=this.places=e.observableArray([]),t.on("place.add",function(e){this.add(e)},this),t.on("place.show",function(e){this.preshow(e)},this),t.on("place.home",function(e){this.goOwnerHome(e)},this),t.on("place.goto.owner.home",function(e){this.goOwnerHome(e)},this),t.on("place.reshow",function(e){this.reshow(e)},this),this.kernel.addApi("getPlace",this.getPlace,this),this.kernel.addApi("place.get.owners",this.getOwnersPlace,this),this.addLegacyAPI(),__mixin(this,new i(n)),this.addPulsing(),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return n.LogFactory().debug("services/place","services/place"),u.prototype={},u.prototype.addPulsing=function(){this.initEndpoint(this.name,[{className:"pumpCo.user.place.request",targetName:"PumpHouse"},{className:"pumpCo.event.core.place",targetName:this.name},{className:"pumpCo.user.place.response",targetName:this.name},{className:"exception.pumpCo.user.authorisation.validation.accessDenied",targetName:this.name}]),this.addPulseHandler("pumpCo.event.core.place",this.onEventCorePlace),this.addPulseHandler("exception.pumpCo.user.authorisation.validation.accessDenied",this.onException.bind(this))},u.prototype.addLegacyAPI=function(){__ns("pumpco.utils.UserUtils"),pumpco.utils.UserUtils.isUserPlace=function(){var e;if(t.fire("user.get",{fn:function(t){e=t},scope:c},{sync:!0}),e){var n=c.find(c.current);return void 0!==n&&n.owner.id===e.profileBody.id}}},u.prototype.onEventCorePlace=function(e){if(void 0===e||!e.getPulseClass)return n.LogFactory().error("services/place.onEventCorePlace: Invalid exchange passed to method","services/place"),-1;e.getPulseClass();var i=e.getPulseBody(),s=this.find(i.placeId);s&&(this.waitingToShow.push(s.id),t.fire("drive.get.place",{place:s,id:s.id,ownerId:s.owner,fn:this.loaded,scope:this,refresh:!0}))},u.prototype.comparePlaces=function(e,t){s.compare(e,t)},u.prototype.add=function(e){if(e){n.LogFactory().debug("Place.add(): place.add ["+e.id+":"+e.ownerId+"]","services/place"),t.fire("place.add.start",{place:e});var i=new s;i.update({id:e.id,name:e.name,owner:{id:e.ownerId}}),t.fire("drive.get.place",{place:i,id:e.id,ownerId:e.ownerId,fn:this.loaded,scope:this})}else n.LogFactory().debug("Place.add(): No Place Id provided","services/place")},u.prototype.locate=function(e){var t=-1;return __.eachSync2(this.places(),function(n,i,s){n.id===e&&(t=i)}),t},u.prototype.find=function(e){var t=void 0;return __.eachSync2(this.places(),function(n,i,s){n.id===e&&(t=n)}),t},u.prototype.findByOwner=function(e){var t=void 0;return __.eachSync2(this.places(),function(n,i,s){n.owner.id===e&&(t=n)}),t},u.prototype.getOwnersPlace=function(){var e=void 0;return __.eachSync2(this.places(),function(t,n,i){!0===t.ownersPlace&&(e=t)}),e},u.prototype.getPlace=function(){var e=this.find(this.current);return e||(e=this.findByOwner(this.current)),e},u.prototype.hide=function(e){var t=this.find(e);if(t||(t=this.findByOwner(this.current)),!t)return-1;t.oVisible(!1)},u.prototype.reshow=function(e){if(!this.current)return-1;var n=this.find(this.current);if(!n)return-2;t.fire("place.shown",{place:n,options:e})},u.prototype.goOwnerHome=function(e){var n=this.kernel.invoke("getUser",{}),i=this.findByOwner(n.profileBody.id);i&&(i.id===this.current?e.doubleNav&&t.fire("breadcrumb.goto",{id:"ROOT"}):this.preshow(i),t.fire("place.shown",{place:i,options:{}}))},u.prototype.preshow=function(e){var t=e.ownerId||e.id;this.waitingToShow.push(t),this.show(t)},u.prototype.searchReverse=function(e,t){for(var n=-1,i=t.length-1;i>=0;i--)if(t[i]===e){n=i;break}return n},u.prototype.show=function(e){var i=this.find(e);i||(i=this.findByOwner(e));var s=this.searchReverse(e,this.waitingToShow);-1===s&&i.owner&&(s=this.searchReverse(i.owner.id,this.waitingToShow)),i&&s>-1?(s===this.waitingToShow.length-1?this.waitingToShow.splice(0,this.waitingToShow.length):this.waitingToShow.splice(0,s),this.current&&this.hide(this.current),i.oVisible(!0),this.current=e,t.fire("place.shown",{place:i,options:{}}),$(".place").first().focus()):this.places().length>0&&n.LogFactory().emergency("Loading place ["+e+"] ...","services/place")},u.prototype.loaded=function(e){if(e.owner&&e.owner.id){var i=this.kernel.invoke("getUser",{});i&&i.profileBody&&i.profileBody.id&&i.profileBody.id===e.owner.id&&(e.ownersPlace=!0,t.fire("place.loaded.owner",e))}if(this.store(e),this.show(e.id),e.space&&0!==e.space.length||n.LogFactory().emergency("ERROR: PLACE.loaded(): No Spaces available to load. Halting...","services/place"),this._launch||e.initialSpace.length>=1){var s=this.findLaunchSpace(this._launch,this._roadie,e);s.space?(s.hide&&this.kernel.invoke("header.hide"),t.fire("space.add",{id:s.space.id}),s.roadie&&(this.kernel.invoke("toast.show",{msg:a.resolve("place-roadieUrl-msg")}),this.pulse("pumpCo.roadie.visit.request",{url:this._roadie}),this._roadie=void 0)):t.fire("space.add",{id:e.space[0].id})}else t.fire("space.add",{id:e.space[0].id});t.fire("place.add.finish",{place:e})},u.prototype.findLaunchSpace=function(e,t,n){var i=void 0,s={space:void 0,hide:!1,roadie:t};e?(s.hide=!0,i=e.toLowerCase()):i=n.initialSpace[0].toLowerCase();for(var o=0;o<n.space.length;o++){var r=n.space[o];if(r.name.toLowerCase().indexOf(i)>-1){s.space=r;break}}return s},u.prototype.store=function(e){var t=this.find(e.id);if(t){s.compare(t,e);return!1}return this.places.unshift(e),!0},u.prototype.onException=function(e){e.getPulseHeader();var n=e.getPulseBody();t.fire("place.exception",{});__get("status.message",n)},u.prototype.toString=function(){return this.name+":"+this.version},u}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){return e.bindingHandlers.place={toggleCustom:function(e,t){if((t=t||{}).primary){var n=e.getAttribute("style");e.setAttribute("style",n+" "+t.primary)}},init:function(t,n,i,s,o){var r=n();return t.setAttribute("id",r.id),e.utils.toggleDomNodeCssClass(t,"place",!0),r.owner.id&&""!==r.owner.id&&(e.utils.toggleDomNodeCssClass(t,"is-owner",r.ownersPlace),e.utils.toggleDomNodeCssClass(t,"not-owner",!r.ownersPlace)),e.bindingHandlers.place.toggleCustom(t,r.customisation),e.utils.toggleDomNodeCssClass(t,"place-nopad",""===r.label),{controlsDescendantBindings:!1}},update:function(t,n,i,s,o){var r=n();return e.bindingHandlers.place.toggleCustom(t,r.customisation),e.utils.toggleDomNodeCssClass(t,"concealed",!r.oVisible()),{controlsDescendantBindings:!1}}},e.bindingHandlers.stopBinding}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(6),n(4),n(26),n(75)],void 0===(s=function(e,t,n,i,s,o,r){var a;n.LogFactory().debug("services/space","services/space");var c=void 0;function o(n){a=this,this.name="space",this.version="0.0.1",this.current=void 0,this.platform=n.platform,this.kernel=n.kernel,this.runtime=n.runtime||{},this._spaceShowOrder=[],c=n.model,this.extendModel(c),c.spaces=this.spaces=e.observableArray([]),this.spaces.getChildren=function(e){return[]},t.on("cog.added",function(e){this.added(e.cog,e.error)},this),t.on("space.add",function(e){this.add(e)},this),t.on("space.show",function(e){this.eventShow(e)},this),t.on("space.request.home",function(e){this.eventRequestHome(e)},this),t.on("place.shown",function(e){this.eventPlaceShown(e)},this),this.kernel.addApi("getSpace",this.getSpace,this),this.kernel.addApi("space.getSpaceBy",this.getSpaceBy,this),this.addLegacyAPI(),__mixin(this,new s(n)),this.addPulsing(),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return o.prototype={},o.prototype.addPulsing=function(){this.initEndpoint(this.name,[{className:"internal.system.space.rearrange.request",targetName:this.name}]),this.addPulseHandler("internal.system.space.rearrange.request",this.internalSystemSpaceRearrangeRequest.bind(this))},o.prototype.addLegacyAPI=function(){__ns("pumpco.utils.UserUtils"),pumpco.utils.UserUtils.getCurrentSpaceName=function(){var e=a.find(a.current);return e?e.name:void 0}},o.prototype.extendModel=function(e){e.getSpaces=function(t){for(var n=[],i=0;i<e.spaces().length;i++){var s=e.spaces()[i];s.parentId===t&&n.splice(n.length,0,s)}return n}},o.prototype.makeMobileName=function(e){var t=e.toLowerCase().indexOf("."),n=e.substring(0,t+1),i=e.substring(t+1);return n+"mobile"+(i=i.substring(0,1).toUpperCase()+i.substring(1))},o.prototype.eventRequestHome=function(e){var t=this.kernel.invoke("getPlace",{});t.initialSpace&&t.initialSpace.length>0?this.eventShow({name:t.initialSpace[0]}):this.eventShow({name:t.space[0].name})},o.prototype.eventShow=function(e){var t;if(e.name){var n=this.kernel.invoke("getPlace",{});if(!(t=this.findByNameAndParent(e.name,n.id))){var i=this.makeMobileName(e.name);t=this.findByNameAndParent(i,n.id)}}e.id&&(t=this.find(e.id)),t&&t.id!==this.current?(this._spaceShowOrder.push(t.id),this.show(t.id)):this.add(e)},o.prototype.eventPlaceShown=function(e){e.place;for(var n=e.options,i=this.findByParentId(e.place.id),s=0;s<i.length;s++)i[s].oVisible()&&(this.current=i[s].id,t.fire("space.shown",{space:i[s],options:n}))},o.prototype.add=function(e){if(e){this._spaceShowOrder.push(e.id||e.name),n.LogFactory().debug("Space.add(): space.add ["+e.id+"]","services/space"),t.fire("space.add.start",{space:e});var i=this.kernel.invoke("getPlace",{});t.fire("drive.get.space",{id:e.id,name:e.name,parentId:i.id,fn:this.loaded,scope:this})}else n.LogFactory().debug("Space.add(): No Space Id provided","services/space")},o.prototype.added=function(e,t){var i=this.find(e.parentId);t&&n.LogFactory().emergency("An error occurred loading cog ["+e.id+"]. "+t,"services/space"),i?(i.added++,i.component.length===i.added&&this.show(i.id)):n.LogFactory().debug("Space.added(): No space found for cog ["+e.id+"]","services/space")},o.prototype.find=function(e){var t=void 0;return __.eachSync2(this.spaces(),function(n,i,s){n.id===e&&(t=n)}),t},o.prototype.findByName=function(e){var t=void 0;return __.eachSync2(this.spaces(),function(n,i,s){n.name===e&&(t=n)}),t},o.prototype.findByNameAndParent=function(e,t){var n=void 0;return __.eachSync2(this.spaces(),function(i,s,o){i.name===e&&i.parentId===t&&(n=i)}),n},o.prototype.findByParentId=function(e){var t=[];return __.eachSync2(this.spaces(),function(n,i,s){n.parentId===e&&t.push(n)}),t},o.prototype.findByAppName=function(e){var t=[];return __.eachSync2(this.spaces(),function(n,i,s){n.params&&n.params.appName&&n.params.appName===e&&t.push(n)}),t},o.prototype.getSpace=function(e){e=e||{};var t=this.current;return e.id&&(t=e.id),this.find(t)},o.prototype.getSpaceBy=function(e){return"appName"===e.type?this.findByAppName(e.name)[0]:[]},o.prototype.show=function(e){var i=this.find(e);if(t.fire("space.pre.shown",{spaceId:e}),i){var s=this._spaceShowOrder.indexOf(i.id);if(-1===s&&(s=this._spaceShowOrder.indexOf(i.name)),s>=0){this._spaceShowOrder.splice(0,s+1);var o=this.findByParentId(i.parentId);if(__.eachSync2(o,function(e,t,n){e.oVisible(!1)}),this.current){var r=this.find(this.current);t.fire("space.hidden",r)}i.oVisible(!0),!0===__get("layout.spa",i)?this.kernel.invoke("header.hide"):this.kernel.invoke("header.show"),this.current=e,t.fire("space.shown",{space:i,options:{}})}}else n.LogFactory().debug("Space.show(): space NOT FOUND ["+spec.id+"]","services/space")},o.prototype.loaded=function(e,i){if(i)return n.LogFactory().emergency("Space ["+i.key+"] not found","services/space"),-1;var s=this.kernel.invoke("getUserLocale",{});s&&e.i18n(s.value),this.store(e);for(var o=0;o<e.component.length;o++)t.fire("cog.add",{id:e.component[o].id});t.fire("space.add.finish",{space:e})},o.prototype.internalSystemSpaceRearrangeRequest=function(e){e.getPulseClass();var n=e.getPulseBody(),i=this.getSpace();if(n.editmode){var s=n.editmode||!1;i.editMode(s),i.each(function(e,n){t.fire("cog.status.modify",{id:n.id,editmode:s})})}},o.prototype.store=function(e){return!this.find(e.id)&&(this.spaces.push(e),!0)},o.prototype.toString=function(){return this.name+":"+this.version},o}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){return e.bindingHandlers.space={init:function(t,n,i,s,o){var r=n();t.setAttribute("id",r.id),t.setAttribute("name",r.name),e.utils.toggleDomNodeCssClass(t,"space",!0);var a=r.layout.type||"flow";return e.utils.toggleDomNodeCssClass(t,a,!0),{controlsDescendantBindings:!1}},update:function(t,n,i,s,o){var r=n();return e.utils.toggleDomNodeCssClass(t,"concealed",!r.oVisible()),t.style.background=r.oBackground(),{controlsDescendantBindings:!1}}},e.bindingHandlers.stopBinding}.apply(t,i))||(e.exports=s)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(13),__webpack_require__(1),__webpack_require__(2),__webpack_require__(0),__webpack_require__(31),__webpack_require__(4),__webpack_require__(27),__webpack_require__(77),__webpack_require__(5),__webpack_require__(30)],__WEBPACK_AMD_DEFINE_RESULT__=function(AOSConfig,Jss,ko,events,Log,DOM,Endpoint,CogBean,BindingCog,Store,Loader){var _this;function Cog(e){_this=this,__mixin(this,new Endpoint(e)),this.initEndpoint(this.name,[{className:"pumpco.system.core.cog",targetName:"PumpHouse"},{className:"internal.event.user.modified",targetName:"PumpHouse"}]),this.name="cog",this.version="0.0.1",this.callbacks=[],this.kernel=e.kernel,this.pump=e.pump,this.runtime=e.runtime||{},this.cogDebug=e.cogDebug,this.cogParams=e.cogParams;var t=e.model;this.location=e.location,this._networkStatus=void 0,this._useMinimal=this.runtime.minimal||!1,this.extendModel(t),t.cogs=this.cogs=ko.observableArray([]),events.on("cog.add",function(e){this.add(e)},this),events.on("space.shown",function(e){this.spaceShown(e)},this),events.on("space.hidden",function(e){this.spaceHidden(e)},this),events.on("user.modified",function(e){this.onUserModified(e)},this),events.on("pump.network.status",function(e){this.onPumpNetworkStatus(e)},this),events.on("cog.status.modify",this.onCogStatusModify.bind(this)),this.kernel.addApi("cog.add.new",this.loaded,this),window.the=window.the||{},the.App=the.App||{},the.App.onReady=function(e){_this.onReady.call(_this,e)},this.kernel.invoke("kernel.process.loaded",{name:this.name})}return Log.LogFactory().debug("services/cog","services/cog"),Cog.prototype={},Cog.prototype.extendModel=function(e){e.getCogs=function(t){var n=[];if(t){for(i=0;i<e.cogs().length;i++){(s=e.cogs()[i]).parentId===t&&n.splice(n.length,0,s)}the.quickSort(n,"oOrder")}else for(var i=0;i<e.cogs().length;i++){var s=e.cogs()[i];n.splice(n.length,0,s)}return n}},Cog.prototype.add=function(e){e?(events.fire("cog.add.start",{cog:e}),Log.LogFactory().debug("Cog.add(): cog.add ["+e.id+"]","services/cog"),events.fire("drive.get.cog",{id:e.id,fn:this.loaded,scope:this})):Log.LogFactory().debug("Cog.add(): No Cog Id provided","services/cog")},Cog.prototype.find=function(e){var t=void 0;return __.eachSync2(this.cogs(),function(n){n.id===e&&(t=n)}),t},Cog.prototype.findByParentId=function(e){var t=[];return __.eachSync2(this.cogs(),function(n,i,s){n.parentId===e&&t.push(n)}),t},Cog.prototype.hide=function(e){var t=this.find(e);t&&t.oVisible(!1)},Cog.prototype.show=function(e){var t=this.find(e);t&&t.oVisible(!0)},Cog.prototype.loaded=function(e){if(Log.LogFactory().info("Cog.loaded(): RECEIVED:"+e.id,"services/cog"),e.layout=e.layout||{},e.layout.version="2",!e.isValid)return events.fire("cog.added",{cog:e,error:"No valid HTML or SCRIPT found."}),-1;if(!0===this.store(e)){this.show(e.id),this.cogDebug===e.name&&(e.params.debug=!0);var t={};if(void 0!==this.cogParams)for(var n=0;n<this.cogParams.length;n++)if(this.cogParams[n].name===e.name){t=this.cogParams[n].value;break}var i=this.kernel.invoke("getPlace",{}),s=this.kernel.invoke("getSpace",{id:e.parentId}),o=this.kernel.invoke("getUser",{}),r=i?{placeId:i.id}:{},a=this.kernel.invoke("contacts.get.contacts",r),c=this.kernel.invoke("environment.get.env",{});i&&(i=ko.toJS(i)),s&&(s=ko.toJS(s)),o&&(o=ko.toJS(o)),a&&(a=ko.toJS(a));var u=this.deriveLibraries(e);this.loadLibraries(u,function(){this.startCog(e,this.pump,i,s,o,this.kernel.platform,a,this.location,c,t),e.booted=!0,this.triggerOnReady(),events.fire("cog.added",{cog:e}),events.fire("cog.add.finish",{cog:e})}.bind(this),function(e){Log.LogFactory().emergency("services.Cog:require fail line:300","services/cog"),Log.LogFactory().emergency(JSON.stringify(e),"services/cog")})}else events.fire("cog.add.finish",{cog:e})},Cog.prototype.loadLibraries=function(libraries,done){var spec={js:{}};if(0===libraries.length)done();else{for(var i=0;i<libraries.length;i++)spec.js[this.location.pumpface+libraries[i]]=void 0;var loader=new Loader(function(json){for(var key in json.js)eval(json.js[key]);done()});loader.load(spec)}},Cog.prototype.deriveLibraries=function(e){for(var t=[],n=e.getCapabilities(),i=0;i<n.length;i++){var s=AOSConfig.getLibraryPath(n[i].name);s&&t.push(s)}return t},Cog.prototype.startCog=function(e,t,n,i,s,o,r,a,c,u,l){l=l||{},e.boot({pump:this.pump,place:n,space:i,user:s,platform:this.kernel.platform,contacts:r,store:Store,location:a,jss:Jss,runtime:this.runtime,network:this._networkStatus,environment:c,cogParams:u,libraries:l})},Cog.prototype.store=function(e){return!this.find(e.id)&&(this.cogs.push(e),!0)},Cog.prototype.spaceShown=function(e){var t=e.space,n=e.options||{},i=this.findByParentId(t.id);__.eachSync2(i,function(e,t,i){var s={visibility:"visible",compId:e.id,state:n.state||void 0};_this.pulse("pumpco.system.core.cog",s,void 0,e.id)})},Cog.prototype.spaceHidden=function(e){var t=this.findByParentId(e.id);__.eachSync2(t,function(e,t,n){_this.pulse("pumpco.system.core.cog",{visibility:"hidden",compId:e.id},void 0,e.id)})},Cog.prototype.onReady=function(e){this.callbacks.push(e)},Cog.prototype.boot=function(){cog.booted||(cog.booted=!0,this.triggerOnReady())},Cog.prototype.reboot=function(e){var t=this.find(e);if(t)return t.deboot(),t.reboot(t),t.repaint(!0),this.triggerOnReady(),t;Log.LogFactory().emergency("No cog found for id["+e+"]","services/cog")},Cog.prototype.triggerOnReady=function(){for(var e=0;e<this.callbacks.length;e++){var t=this.callbacks.shift();setTimeout(t,0)}},Cog.prototype.onUserModified=function(e){_this.pulse("internal.event.user.modified",e)},Cog.prototype.onPumpNetworkStatus=function(e){this._networkStatus=e,Log.LogFactory().debug("Network Status Changed","services/cog"),_this.pulse("internal.event.network.status",e)},Cog.prototype.onCogStatusModify=function(e){e=e||{};var t=this.find(e.id);e.editmode&&(console.log("COG: ["+t.name+"] editmode="+e.editmode),t.editMode(e.editmode),$(".draghandle").off("click"),$(".draghandle").on("click",function(){console.log("I was clicked")}))},Cog.prototype.toString=function(){return this.name+":"+this.version},Cog}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,n){var i,s;i=[n(1),n(31)],void 0===(s=function(e,t){return e.bindingHandlers.cog={template:function(e,n,i,s,o,r){var a="";if(s&&""!==s){var c='div[name="'+n+'"]',u=t.constrain(c,s),l=n.indexOf("."),p="/"+n.substring(0,l).toLowerCase()+"/"+n.substring(l+1)+"/";a+='<style type="text/css" rel="stylesheet" type="text/css" media="screen" scoped>'+(u=t.constrainUrls(o.basePath+p,u))+"</style>"}return a+="<div id='"+e+"' class='cog-body'>"+i+"</div>"},init:function(t,n,i,s,o){var r=n();e.utils.toggleDomNodeCssClass(t,"cog",!0),$(t).attr("name",r.name);var a=r.layout;return a&&a.version&&"2"===a.version&&r.repaint()&&(t.innerHTML=e.bindingHandlers.cog.template(r.id,r.name,r.html,r.style,r.params),r.repaint(!1)),{controlsDescendantBindings:!0}},update:function(t,n,i,s,o){var r=n();return e.utils.toggleDomNodeCssClass(t,"concealed",!r.oVisible()),r.repaint()&&(t.innerHTML=e.bindingHandlers.cog.template(r.id,r.name,r.html,r.style,r.params),r.repaint(!1)),{controlsDescendantBindings:!0}}},e.bindingHandlers.stopBinding}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(29),n(79)],void 0===(s=function(e,t,n,i,s){function o(e){s.call(this,e),this.name="roadie",this.version="0.0.1",this.roadieVersion="2",this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{},this.platform=e.platform,this._afterPlace=void 0,t.on("roadie.nav.space",function(e){this.onUserLoaded(e)},this),t.on("roadie.nav.url",function(e){this.navUrl(e)},this),t.on("place.shown",function(e){this.onPlaceShown(e)},this),this.kernel.addApi("roadie.getSpaceByAppName",this.getSpaceByAppName,this),this.kernel.addApi("roadie.hold",function(e){this.hold(e.key,e.obj)},this),this.kernel.addApi("roadie.release",function(e){return this.release(e.key)},this),this.kernel.addApi("roadie.peek",function(e){return this.peek(e.key)},this),this.kernel.addApi("roadie.create.url",this.createRoadieUrl,this),__ns("pumpco.core.services.RoadieUrl"),pumpco.core.services.RoadieUrl=i,__ns("the.app.model.user"),__ns("the.app.services.siteService"),the.app.services.siteService.remove=function(){},the.app.services.siteService.add=this.siteAddEvent,__ns("the.app.services.placeService"),the.app.services.placeService.show=this.placeShowEvent.bind(this),the.app.services.placeService.add=this.placeAddEvent.bind(this),__ns("the.app.services.spaceService"),the.app.services.spaceService.show=this.spaceShowEvent,this.constructor(e),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return n.LogFactory().debug("services/roadie","services/roadie"),o.prototype=s.prototype,o.prototype.getCurrentPlace=function(){return this.kernel.invoke("getPlace",{})},o.prototype.getSpaceByAppName=function(e){return e.type="appName",this.kernel.invoke("space.getSpaceBy",e)},o.prototype.eventNavToSpace=function(e){t.fire("space.show",e)},o.prototype.siteAddEvent=function(e){t.fire("site.addUserSite",e)},o.prototype.spaceShowEvent=function(e){t.fire("space.show",e)},o.prototype.placeAddEvent=function(e,n){this.kernel.invoke("getUser",{}).profileBody.id!==n.ownerId&&t.fire("place.add",n)},o.prototype.placeShowEvent=function(e){var n=this.kernel.invoke("getUser",{});__get("profileBody.id",n)===e.ownerId?t.fire("place.home",{sync:!0}):t.fire("place.show",e)},o.prototype.onPlaceShown=function(e){var t=e.place,n=Object.keys(this._renderPipeline);n.length>0&&(n.indexOf(t.id)>=0&&this.multiPassRenderer(t),n.indexOf("_CURRENT_")>=0&&this.multiPassRenderer({getType:function(){return"place"},id:"_CURRENT_"}))},o.prototype.createRoadieUrl=function(e){var t=null;return(e=e||{}).ownerId&&e.placeId&&(t="roadie://visit/place/"+e.ownerId+"/"+e.placeId),t},o}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(4)],void 0===(s=function(e){function t(t){this.name="pumpco.core.service.Roadie",this._backpack=void 0,this._renderPipeline=void 0,this._urlRegex=void 0,this._urlNames=["url","protocol","verb","identifier","user","place","space","cog","params"],this._backpack={},this._renderPipeline={},__mixin(this,new e(t)),this.addPulsing(),this._urlRegex=/^(?:([a-z]+):\/\/)([0-9.\-A-Za-z]+)?\/([0-9.\-A-Za-z]+)?\/?([0-9.\-A-Za-z]+)?\/?([0-9.\-A-Za-z]+)?\/?([0-9.\-A-Za-z]+)?\/?([0-9.\-A-Za-z]+)?(\?[^#]*)?$/,the.log.debug(this,"Instantiated successfully"),this.delayedVisitPlace=function(e,t,n){return{delay:function(n,i,s,o){setTimeout(function(){e.apply(t,o)},n)}}}(this.visitPlace,this)}return t.prototype={},t.prototype.init=function(){},t.prototype.addPulsing=function(){this.initEndpoint(this.name,[{className:"pumpCo.roadie.release.response",targetName:"PumpHouse"},{className:"pumpCo.space.ready.event",targetName:this.name},{className:"pumpCo.roadie.hold.request",targetName:this.name},{className:"pumpCo.roadie.visit.request",targetName:this.name},{className:"pumpCo.roadie.release.request",targetName:this.name}]),this.addPulseHandler("pumpCo.space.ready.event",this.pulsed.bind(this)),this.addPulseHandler("pumpCo.roadie.hold.request",this.pulsed.bind(this)),this.addPulseHandler("pumpCo.roadie.visit.request",this.pulsed.bind(this)),this.addPulseHandler("pumpCo.roadie.release.request",this.pulsed.bind(this))},t.prototype.hold=function(e,t){this._backpack[e]&&the.log.info(this,"Already holding an item for key ["+e+"]. Dropping now."),the.log.info(this,"Holding in the backpack the item with key ["+e+"]"),this._backpack[e]=t},t.prototype.peek=function(e){var t=this._backpack[e];return t&&the.log.info(this,"Peeking in the backpack for item with key ["+e+"] "),t},t.prototype.release=function(e){var t=this.peek(e);return t&&(delete this._backpack[e],the.log.info(this,"Removing from the backpack item with key ["+e+"]")),t},t.prototype.pulsed=function(e){var t=e.msgIn.body;switch(t.pulseHeader.pulseClass){case"exception":alert("Exception");break;case"pumpCo.space.ready.event":this.contextPulse&&this.endPoint.pulse(JSON.parse(this.contextPulse));break;case"pumpCo.roadie.hold.request":var n=(s=t.pulseBody).package;this.hold(s.key,n);break;case"pumpCo.roadie.release.request":var i,s=t.pulseBody,o=t.pulseHeader;i=s.clear?this.release(s.key):this.peek(s.key);e=pumpco.core.jsbean.ExchangeFacade.getInOutCommand({reqId:o.componentId,ns:"pumpCo.roadie.release.response",refId:o.referenceId,body:i});this.endPoint.pulse(e);break;default:the.log.debug(this,"Pulsed with a Visit Request");var r=e.getPulseBody();r.contextPulse&&(this.contextPulse=r.contextPulse),(r.spaceId||r.spaceName)&&(this.hold(r.spaceName,r),this.visitSpace(r)),r.place&&this.visitPlace(r),r.site&&this.visitSite(r),r.url&&this.navUrl(r)}},t.prototype.navUrl=function(e){var t=e.url,n=pumpco.core.services.RoadieUrl.getType(t);if("roadie"===n){var i=pumpco.core.services.RoadieUrl.parse(t);i.params&&(i.cog?this.hold(i.cog,i.params):i.space?this.hold(i.space,i.params):i.place?this.hold(i.place,i.params):this.hold(i.user,i.params));(this.roadieVersion&&"2"===this.roadieVersion?this.getCurrentPlace():the.app.services.placeService.getCurrentPlace()).id===i.place?this.visitSpace({spaceId:i.space}):(i.user,this.delayedVisitPlace.delay(50,void 0,void 0,[{place:{name:"Home",ownerId:i.user}}]),i.space&&(this._renderPipeline[i.place]=i.space))}else"anchor"===n&&window.location.replace(t)},t.prototype.getState=function(){return JSON.parse(this.contextPulse)},t.prototype.multiPassRenderer=function(e){the.log.debug(this,"MULTIPASS:  Render for id="+e.id);var t=this._renderPipeline[e.id];if(t)return delete this._renderPipeline[e.id],"place"===e.getType()&&(the.log.debug(this,"MULTIPASS: Space navigate to key ["+t+"]"),0===t.indexOf("'")?(t=t.substring(1,t.length-1),this.visitSpace({spaceName:t})):this.visitSpace({spaceId:t})),this;the.log.debug(this,"MULTIPASS: Nothing to render for key:"+e.id)},t.prototype.visitPlace=function(e){if(the.app.services&&the.app.services.placeService)e.place.ownerId||(e.place.ownerId=the.app.model.user.id),the.app.services.placeService.show(e.place),the.app.services.placeService.add(void 0,e.place);else{the.app.controller.placeManager.remove(e);var t={};e.place.id&&(t.id=e.place.id),e.place.name&&(t.name=e.place.name),e.place.ownerId&&(t.ownerId=e.place.ownerId),t.parentContainer=the.app.model.site.placeContainer,the.app.controller.placeManager.add(t)}},t.prototype.visitSpace=function(e){if(the.app.services&&the.app.services.spaceService){var t=e.spaceId?{id:e.spaceId}:{name:e.spaceName};the.app.services.spaceService.show(t),the.log.debug(this,"NEW: Visiting space["+t.id+"]")}else e.refresh&&!0===e.refresh&&the.app.controller.spaceManager.remove(e.spaceName),the.app.controller.spaceManager.show({id:e.spaceId,name:e.spaceName})},t.prototype.visitSite=function(e){the.app.model.user.authToken=e.authToken,the.app.services.siteService.remove(),the.app.services.siteService.add(e.site),the.log.debug(this,"Site navigation complete.")},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0)],void 0===(s=function(e,t,n){var i;function s(e){this.name="console",this.version="0.0.1",i=this,this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{},this.debug=e.debug,void 0===e.consoleParams?this.consoleEnabled=!1:this.consoleEnabled=!0,this._help={},this.aos={},this.aos.list={},this.aos.specific={},this.aos.pulse={},this.aos.cog={},this.aos.action={},this.aos.single={},this.aos.suite={},this.aos.info={},this.aos.help=function(){i.displayHelp.call(i)},this.addPumpCommands(this.aos),this.addServiceCommands(this.aos),this.addCogCommands(this.aos),this.addKernelCommands(this.aos),this.addCoreCommands(this.aos),this.kernel.addApi("addConsoleMethod",function(e){this.addAPI(e.ns,e.fn)},this),this.kernel.addApi("console.add",function(e){this.addAPI(e.ns,e.fn)},this),this.kernel.invoke("kernel.process.loaded",{name:this.name}),!0!==this.debug&&!1===this.consoleEnabled||(window.aos=this.aos)}return n.LogFactory().debug("services/console","services/console"),s.prototype={},s.prototype.addHelp=function(e,t){this._help[e]=t},s.prototype.displayHelp=function(){for(var e in console.log("aOS Console Help"),console.log("================="),this._help)console.log(e+" // "+this._help[e])},s.prototype.addCoreCommands=function(e){this.addHelp("&debug=true","Url parameter. asks for the debug version of includes."),this.addHelp("&platform=Desktop|Mobile","Url parameter. sets which site should be loaded."),this.addHelp("&socket=false","Url parameter. sets the pump to use XHR which is better for debugging."),this.addHelp("&cog=<cogname>","Url parameter. sets the cog to debug ( cogname can be found by sniffing the DOM )"),this.addHelp("&params=json","Url parameter. sets the params for every cog"),this.addHelp("e.g. https://dev.cnect.to/pumpco?socket=false&params=[{%22name%22:%22Gaia.loginCog%22,%22value%22:{%22useForm%22:false}}]"),this.addHelp("&log=1|2|3|4","Url parameter. sets the logging to higher."),this.addHelp("&console=true","Url parameter. displays the console."),this.addHelp("&drive=clear|nocache|prefer","Url parameter. clears the localstorage."),this.addHelp("&app=system.attendanceApp","Url parameter. loads a specific App as a standalone app."),this.addHelp("&wrapper=true","Url parameter. sets the platform to run as-if it is running as a wrapped app ( cordova + online/offline )"),this.addHelp("&test=true","Url parameter. sets the platform in to 'test' mode by loading the functional tests."),this.addHelp("&launch=System.convCentre","Url parameter. sets the App to load by default. In the form of Fixture.AppName, which will then try to find the Appropriate Space."),this.addHelp("&console=true","Url parameter. enables the 'aos' console in the browser developer tools.")},s.prototype.listCameletFeature=function(e,t){var n=[],s=i.pump._camelet.getStats()[e];if(t.indexOf("h")>=0)for(var o in n=[],s.items)n.push(s.items[o].name);else for(var o in s.items)n.push(s.items[o]);return n},s.prototype.addPumpCommands=function(e){e.list.channels=function(e){return e=e||"",i.listCameletFeature("channels",e)},e.list.components=function(e){return e=e||"",i.listCameletFeature("components",e)},e.list.consumers=function(e){return e=e||"",i.listCameletFeature("consumers",e)},e.list.endpoints=function(e){return e=e||"",i.listCameletFeature("endpoints",e)},e.list.producers=function(e){return e=e||"",i.listCameletFeature("producers",e)},e.pulse.request=function(e,t,n){if(0===arguments.length)return"USAGE: a.pulse.request( 'pumpco.pulse.name', { 'body':'something' }, 'component-id' );";t=t||{},i.pump.internelSend(e,t,"command-line",n)},e.pulse.event=function(e,t,n){if(0===arguments.length)return"USAGE: a.pulse.event( 'pumpco.pulse.name', { 'body':'something' }, 'component-id' );";t=t||{},i.pump.internelSend(e,t,"command-line",n)}},s.prototype.listServiceFeature=function(e,t,n){var s=[];n=n||function(e){return!0};var o=i.model[e]();if(t.indexOf("h")>=0){s=[];for(var r=0;r<o.length;r++)n(o[r])&&s.push(o[r].name)}else for(r=0;r<o.length;r++)n(o[r])&&s.push(o[r]);return s},s.prototype.addServiceCommands=function(e){e.list.sites=function(e){return e=e||"",i.listServiceFeature("sites",e)},e.specific.site=function(e,t){return t=t||"",i.listServiceFeature("sites",t,function(t){if(t.id===e)return!0})},e.list.places=function(e){return e=e||"",i.listServiceFeature("places",e)},e.specific.place=function(e,t){return t=t||"",i.listServiceFeature("places",t,function(t){if(t.id===e)return!0})},e.list.spaces=function(e){return e=e||"",i.listServiceFeature("spaces",e)},e.specific.space=function(e,t){return t=t||"",i.listServiceFeature("spaces",t,function(t){if(t.id===e)return!0})},e.list.cogs=function(e){return e=e||"",i.listServiceFeature("cogs",e)},e.specific.cog=function(e,t){return t=t||"",i.listServiceFeature("cogs",t,function(t){if(t.id===e)return!0})}},s.prototype.addCogCommands=function(e){this.addHelp("a.cog.edit(cog-id);","Enables a cog for editing ( pops up the code for viewing and editing ) "),this.addHelp("a.cog.rerun();","Reboots the cog, uses the last id used for edit as the cog to rerun."),e.cog._id=void 0,e.cog._editor=void 0,e.cog.reboot=function(t,n){return n=n||"",(t=t||e.cog._id)?(e.cog._editor.hide(),i.model.services.cog.reboot(t)):"no cog found to reboot"},e.cog.edit=function(t){e.cog._id=t,e.cog._editor.show(),e.cog.load(t)},e.cog.load=function(t){var n=i.model.services.cog.find(t);e.cog._editor.put(n.html)},e.cog.save=function(){var t=i.model.services.cog.find(e.cog._id),n=e.cog._editor.take();t.html=n},e.cog.rerun=function(){e.cog.save(),e.cog.reboot();var t=i.model.services.cog.find(e.cog._id);i.model.services.cog.spaceShown({id:t.parentId})}},s.prototype.addKernelCommands=function(e){e.list.api=function(e,t){return this.kernel.invoke("kernel.list.api",{})}.bind(this),e.info.version=function(){return this.kernel.invoke("kernel.get.info",{})}.bind(this)},s.prototype.addAPI=function(e,t,n){for(var i=e.split("."),s=this.aos,o=0;o<i.length-1;o++){var r=i[o];s&&s[r]?s=s[r]:(s[r]={},s=s[r])}s[i[i.length-1]]=t},s.prototype.toString=function(){return this.name+":"+this.version},s}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(4),n(5),n(6)],void 0===(s=function(e,t,n,i,s,o){n.LogFactory().debug("services/user","services/user");function r(n){this.name="user",this.version="0.0.1",__mixin(this,new i(n)),this.kernel=n.kernel;var s=n.model;this.pump=n.pump,this.runtime=n.runtime||{},s.user=this.user=e.observable({}),n.user&&this.loaded(n.user),this.initEndpoint(this.name,[{className:"internal.user.load",targetName:this.name},{className:"internal.event.user.profile",targetName:this.name},{className:"internal.user.profile.request",targetName:this.name},{className:"internal.user.profile.response",targetName:"PumpHouse"},{className:"pumpCo.event.core.place",targetName:this.name},{className:"internal.user.profile.save.request",targetName:this.name},{className:"internal.user.profile.save.response",targetName:"PumpHouse"},{className:"pumpCo.user.profile.save.request",targetName:"PumpHouse"},{className:"pumpCo.user.profile.save.response",targetName:this.name},{className:"internal.user.profile.event",targetName:"PumpHouse"}]),this.addPulseHandler("internal.user.load",function(e){var t=e.getPulseBody();this.load.call(this,t)}.bind(this)),this.addPulseHandler("internal.event.user.profile",this.modified),this.addPulseHandler("pumpCo.event.core.place",this.modified.bind(this)),this.addPulseHandler("internal.user.profile.request",this.internalUserProfileRequest.bind(this)),this.addPulseHandler("internal.user.profile.save.request",this.internalUserProfileSaveRequest.bind(this)),this.addPulseHandler("pumpCo.user.profile.save.response",this.pumpcoUserProfileSaveResponse.bind(this)),t.on("site.loaded",function(e){this.setSiteUser(e)},this),t.on("security.auth.success",this.load.bind(this)),t.on("security.auth.offline",this.load.bind(this)),t.on("security.auth.no.token",function(e){this.kernel.invoke("drive.clear","user.user")},this),t.on("user.get",function(e){this.getUser(e.fn,e.scope)},this),this.kernel.addApi("getUser",this.getUserSync,this),this.kernel.addApi("user.get.auth",this.getUserSync,this),this.kernel.addApi("getUserLocale",this.getUserLocaleSync,this),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return r.prototype={},r.prototype.getUser=function(t,n){n=n||this,t.call(n,e.toJS(this.user))},r.prototype.getUserSync=function(t,n){return e.toJS(this.user)},r.prototype.getUserLocaleSync=function(t,n){var i=e.toJS(this.user);return i&&i.id?i.location.locale:{type:"locale",label:"locale",value:the.getLocale()}},r.prototype.load=function(e){t.fire("drive.get.user",{id:"auth-user",fn:this.loaded,scope:this})},r.prototype.modified=function(e){t.fire("drive.get.user",{id:"auth-user",fn:this.loaded,scope:this,refresh:!0})},r.prototype.loaded=function(e){n.LogFactory().info("User.loaded(): RECEIVED:"+e.id,"services/user");var i="user.loaded";this.user().id&&(i="user.modified");var o=s.get("user.user",e.id);o&&o.id===e.profileBody.id?n.LogFactory().debug("services/user: same login. no action","services/user"):(this.kernel.invoke("drive.clean",{}),n.LogFactory().debug("services/user: different login, cleaning drive.","services/user")),s.set("user.user",{id:e.profileBody.id,username:e.profileBody.username}),this.user(e),t.fire(i,e)},r.prototype.setSiteUser=function(e){if(this.user&&this.user().id){var n=__get("owner.preferences.location",e);n&&(this.user().setLocation(n),t.fire("user.locale.updated",this.user().location.locale))}},r.prototype.internalUserProfileRequest=function(t){n.LogFactory().debug("USER.internalUserProfileRequest()","services/user");var i=t.getPulseHeader(),s=(t.getPulseBody(),i.componentId),o=e.toJS(this.user);this.pulse("internal.user.profile.response",o,void 0,void 0,s)},r.prototype.internalUserProfileSaveRequest=function(e){var t=e.getPulseHeader(),n=e.getPulseBody(),i=t.componentId;n=n;this.pulse("pumpCo.user.profile.save.request",n,void 0,void 0,i)},r.prototype.pumpcoUserProfileSaveResponse=function(e){e.getPulseHeader(),e.getPulseBody();t.fire("drive.get.user",{id:"auth-user",fn:this.profileSaved,refresh:!0,scope:this})},r.prototype.profileSaved=function(e){e&&this.user(e),this.pulse("internal.user.profile.event",{status:"updated"})},r.prototype.toString=function(){return this.name+":"+this.version},r}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(9),n(1),n(2),n(0),n(4),n(83),n(84),n(85)],void 0===(s=function(e,t,n,i,s,o,r,a){var c;function u(e){c=this;var i=e.tmpl||a;$("#insert-template-header").replaceWith(i),this.name="header",this.version="0.0.1",this.current=void 0,this.kernel=e.kernel,this.model=e.model,this.pump=e.pump,this.runtime=e.runtime||{},this._appParams=e.appParams||void 0,__mixin(this,new s(e)),this.initEndpoint(this.name,[{className:"pumpCo.roadie.visit.request",targetName:"PumpHouse"},{className:"internal.system.io.update",targetName:this.name},{className:"pumpCo.event.notification.new",targetName:this.name},{className:"internal.event.notification.update",targetName:this.name}]),this.model.header=this.header=t.observable(new o({appParams:this._appParams,signoutFn:this.signoutClicked.bind(this),settingsFn:this.settingsClicked,contactsFn:this.contactsClicked,yourPlaceFn:this.yourplaceClicked,notificationsFn:this.notificationsClicked,helpFn:this.helpClicked,breadcrumbPlacesFn:this.breadcrumbPlacesClicked.bind(this)})),this._preferHidden=!0,this.addPulseHandler("internal.system.io.update",this.onIoUpdate),this.addPulseHandler("pumpCo.event.notification.new",this.onNewNotifications),this.addPulseHandler("internal.event.notification.update",this.onNewNotifications),n.on("user.loaded",function(e){this.onUserLoaded(e)},this),n.on("user.modified",function(e){this.onUserLoaded(e)},this),n.on("user.locale.updated",function(e){this.onUserLocaleUpdated(e)},this),n.on("space.shown",function(e){this.onSpaceShown(e)},this),n.on("place.shown",function(e){this.onPlaceShown(e)},this),n.on("place.loaded.owner",function(e){this.onPlaceLoadedOwner(e)},this),n.on("breadcrumb.goto",function(e){this.onBreadCrumbGoTo(e)},this),n.on("system.action.signout",function(e){this.signoutClicked()},this),n.on("pump.socket-error",function(e){this.setErrorState()},this),this.kernel.addApi("header.hide",this.apiHeaderHide,this),this.kernel.addApi("header.show",this.apiHeaderShow,this),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return i.LogFactory().debug("services/header","services/header"),u.prototype={},u.prototype.onSpaceShown=function(e){this.header=this.model.header;var t=e.space;this.header().updateBreadCrumbWithSpace(t),this.lateBind()},u.prototype.onPlaceShown=function(e){this.header=this.model.header;var t=e.place,n=this.kernel.invoke("contacts.get.contact.by.id",{id:t.owner.id});this.header().addBreadCrumbForPlace(t,n);var i=this.kernel.invoke("getUser",{});i&&i.profileBody&&(i.profileBody.id!==t.owner.id?this.header().visiting(!0):(this.header().visiting(!1),this.header().chopBreadcrumb(this.header().breadcrumb[0]))),this.header().trimBreadcrumbForPlace(t.id),this.header().refreshPlace(t,n),this.lateBind()},u.prototype.onBreadCrumbGoTo=function(e){var t=this.header().breadcrumb()[0];c.pulse("pumpCo.roadie.visit.request",{spaceName:t.name})},u.prototype.onUserLoaded=function(e){this.header=this.model.header,this.header().setIcon(e)},u.prototype.onUserLocaleUpdated=function(){this.header().refreshI18n()},u.prototype.onPlaceLoadedOwner=function(e){this.repaint()},u.prototype.onSiteShown=function(e){this.header=this.model.header},u.prototype.onIoUpdate=function(e){__get("status",c.unwrapPulse(e))},u.prototype.onNewNotifications=function(e){var t=__get("notification.unviewed",c.unwrapPulse(e));this.header().notifications.count(t)},u.prototype.lateBind=function(){$(".header-console-placemessage").off("click"),$(".header-console-placemessage").on("click",function(){this.header().consoleExpanded(!this.header().consoleExpanded())}.bind(this)),$("#header-user").focus(),$(".btn-breadcrumb").off("click"),$(".btn-breadcrumb").on("click",this.breadcrumbClicked),$(".btn-yourpicture").off("click"),$(".btn-yourpicture").on("click",this.yourplaceClicked),$(".btn-placepicture").off("click"),$(".btn-placepicture").on("click",this.placeHomeClicked.bind(this)),$(".btn-notifications").off("click"),$(".btn-notifications").on("click",this.notificationsClicked),$(".btn-settings").off("click"),$(".btn-settings").on("click",this.settingsClicked),$(".btn-help").off("click"),$(".btn-help").on("click",this.helpClicked),$(".btn-contacts").off("click"),$(".btn-contacts").on("click",this.contactsClicked),$(".header-console-inner").off("click"),$(".header-console-inner").on("click",this.consoleClicked)},u.prototype.breadcrumbClicked=function(){var e=t.dataFor(this);c.header().chopBreadcrumb(e.id),c.pulse("pumpCo.roadie.visit.request",{spaceName:e.name})},u.prototype.settingsClicked=function(){t.dataFor(this);c.gotoHomePlace(),c.pulse("pumpCo.roadie.visit.request",{spaceName:"System.controlCentreSpace"})},u.prototype.contactsClicked=function(){c.gotoHomePlace(),c.pulse("pumpCo.roadie.visit.request",{spaceName:"System._ContactSpace"})},u.prototype.yourplaceClicked=function(){c.gotoHomePlace()},u.prototype.placeHomeClicked=function(){this.header().breadcrumbPlaces.find(this.header().currentPlace);c.onBreadCrumbGoTo({id:"ROOT"})},u.prototype.notificationsClicked=function(){c.gotoHomePlace(),c.pulse("pumpCo.roadie.visit.request",{spaceName:"System.notificationsSpace"})},u.prototype.helpClicked=function(){c.gotoHomePlace();c.pulse("pumpCo.roadie.visit.request",{url:"roadie://visit/user/431900000000000000004319"})},u.prototype.breadcrumbPlacesClicked=function(e,t){var n=this.kernel.invoke("getPlace",{});if(this.header().consoleExpanded(!this.header().consoleExpanded()),n.id!==e.id){var i=this.kernel.invoke("roadie.create.url",{ownerId:e.ownerId,placeId:e.placeId});null!==i&&c.pulse("pumpCo.roadie.visit.request",{url:i})}},u.prototype.signoutClicked=function(){n.fire("header.signout",{}),setTimeout(function(){$("body").addClass("removing")},500),this.kernel.invoke("security.logout",{wait:1500})},u.prototype.gotoHomePlace=function(){!0===c.header().visiting()?(c.header().visiting(!1),n.fire("place.home",{sync:!0})):n.fire("space.request.home",{})},u.prototype.setErrorState=function(){c.header().isError()},u.prototype.unwrapPulse=function(e){var t=e.getPulseBody();return t||void 0},u.prototype.repaint=function(){var e=document.body.getAttribute("class")||"";this._preferHidden&&-1===e.indexOf("native")?(this.header().oVisible(!1),e=e.replace("webapp","").trim(),e+=" native"):!1===this._preferHidden&&-1===e.indexOf("webapp")&&(this.header().oVisible(!0),e=e.replace("native","").trim(),e+=" webapp"),document.body.setAttribute("class",e)},u.prototype.apiHeaderHide=function(){this._preferHidden=!0,this.repaint()},u.prototype.apiHeaderShow=function(){this._preferHidden=!1,this.repaint()},u.prototype.toString=function(){return this.name+":"+this.version},u}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1),n(8),n(6),n(14)],void 0===(s=function(e,t,n,i){var s=void 0;function o(t){s=this,t=t||{},this.testPaths=["member.jpg","staff.jpg","volunterr.jpg","andym"],this.id="header",this.initials=e.observable(""),this.initialsColour=e.observable(""),this.icon=e.observable(""),this.oSingleApp=e.observable(!1),void 0!==t.appParams&&this.oSingleApp(!0),this.place=e.observable(""),this.placeIcon=e.observable(""),this.placeInitials=e.observable(""),this.placeInitialsColour=e.observable(""),this.placeMessage=e.observable(""),this.visiting=e.observable(!1),this.placeAccent=e.observable(void 0),this.space=e.observable(""),this.currentPlace=void 0,this.breadcrumbs={},this.breadcrumb=e.observableArray([]),this.breadcrumbPlaces=new i,this.breadcrumbPlacesFn=t.breadcrumbPlacesFn||function(){},this.notifications={count:e.observable(0)},this.consoleExpanded=e.observable(!1),this.status=e.observable("is-success"),this._signoutFn=t.signoutFn||function(){},this._settingsFn=t.settingsFn||function(){},this._contactsFn=t.contactsFn||function(){},this._yourPlaceFn=t.yourPlaceFn||function(){},this._notificationsFn=t.notificationsFn||function(){},this._helpFn=t.helpFn||function(){},this.actions=phil.model.ButtonMenu({button:{value:'<span class="ico-ios7 ico-more"></span>'},menu:{items:[phil.model.Button({name:"yourplace",value:"your place",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._yourPlaceFn()}}),phil.model.Button({name:"contacts",value:"contacts",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._contactsFn()}}),phil.model.Button({name:"notifications",value:"notifications",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._notificationsFn()}}),phil.model.Button({name:"settings",value:"settings",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._settingsFn()}}),phil.model.Button({name:"signout",value:"signout",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._signoutFn()}}),phil.model.Button({name:"help",value:"help",handler:function(e,t){$(t.currentTarget).parents("ul.menu").triggerHandler("blur"),s._helpFn()}})]}}),this.oVisible=e.observable(!1)}return o.prototype={},o.prototype.refreshI18n=function(){this.refreshPlace(this.place)},o.prototype.isError=function(){this.status("is-error")},o.prototype.chopBreadcrumb=function(e,t){t>-1&&e.splice(t,e.length-t)},o.prototype.findInBreadcrumb=function(e,t){for(var n=-1,i=0;i<e.length;i++)if(e[i].id===t){n=i;break}return n},o.prototype.updateBreadCrumbWithSpace=function(e){var t=this.breadcrumbs[this.currentPlace];this.space(e.label);var n=this.findInBreadcrumb(t,e.id);this.chopBreadcrumb(t,n),e.label&&t.push(e),this.breadcrumb(t)},o.prototype.switchBreadCrumbToPlace=function(e){},o.prototype.addBreadCrumbForPlace=function(e,t){var n=e.id;this.currentPlace=n,this.breadcrumbs[n]||(this.breadcrumbs[n]=[]);var i=this.breadcrumbs[this.currentPlace];if(this.breadcrumb(i),-1===this.breadcrumbPlaces.indexOf(n)&&e.owner&&""!==e.owner.id){var s=void 0!==t?t.fn:e.desc;this.breadcrumbPlaces.push({ownerId:e.owner.id,placeId:e.id,label:s,id:e.id,initialSpace:e.initialSpace});var o=e.space[0];if(e.initialSpace&&e.initialSpace.length>0)for(var r=0;r<e.space.length;r++)if(e.space[r].name===e.initialSpace[0]){o={id:e.space[r].id,name:e.space[r].name};break}i.push(o)}},o.prototype.trimBreadcrumbForPlace=function(e){var t=this.breadcrumbPlaces.indexOf(e);-1!==t&&(this.breadcrumbPlaces.length()>t&&this.breadcrumbPlaces.splice(t+1,this.breadcrumbPlaces.length()-(t-1)))},o.prototype.refreshPlace=function(e,t){if(!e)return-1;this.place(e.label),this.placeIcon(""),this.placeInitials("");var i=__get("customisation.accent",e);if(this.placeAccent(i),this.visiting()){if(this.testForPaths(e.icon)){var s=__get("fn",t);s&&(this.placeInitials(the.abbreviate(s)),this.placeInitialsColour(this.generateHexFrom(this.placeInitials())))}this.placeIcon(e.icon);var o=void 0!==t?t.fn:e.description,r=phil.markupify(phil.printf(n.resolve("header-you-are-visiting"),o));this.placeMessage(r)}else{r=phil.markupify(phil.printf(n.resolve("header-you-are-home")));this.placeMessage(r)}},o.prototype.testForPaths=function(e){var t=!1;if(!e)return t;for(var n=0;n<this.testPaths.length;n++)if(e.indexOf(this.testPaths[n])>-1){t=!0;break}return t},o.prototype.generateHexFrom=function(e){for(var t=["#"],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t.length<4&&t.push("00"),t.join("")},o.prototype.setIcon=function(e){var t="";e.profileImage&&e.profileImage.referenceID&&(t=e.profileImage.referenceID),this.initials(""),this.testForPaths(t)?(this.initials(e.getInitials()),this.initialsColour(this.generateHexFrom(this.initials()))):this.icon(t)},o}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){return e.bindingHandlers.header={init:function(t,n,i,s,o){var r=n();return r&&(t.setAttribute("id",r.id),e.utils.toggleDomNodeCssClass(t,"header",!0)),{controlsDescendantBindings:!1}},update:function(t,n,i,s,o){var r=n();if(r){if(r.placeAccent()){var a=r.placeAccent();-1===a.indexOf("!important")&&(a=a.replace(";"," !important;")),t.setAttribute("style",a)}else t.setAttribute("style","");e.utils.toggleDomNodeCssClass(t,"singleapp",r.oSingleApp()),e.utils.toggleDomNodeCssClass(t,"concealed",!r.oVisible()),e.utils.toggleDomNodeCssClass(t,"visiting",r.visiting())}return{controlsDescendantBindings:!1}}},e.bindingHandlers.stopBinding}.apply(t,i))||(e.exports=s)},function(e,t){e.exports='\x3c!-- HEADER --\x3e\r\n\r\n\x3c!-- ko if:$root.header().oVisible --\x3e\r\n\t\x3c!-- ko with:$root.header --\x3e\r\n\t<div data-bind="header:$data, css:$data.status, css:{\'concealed\':$root.places().length<1}" class="header concealed">\r\n\r\n\t\t\t\x3c!--\r\n\t\t\t\tLEFT Panel\r\n\t\t\t--\x3e\r\n\t\t\t\x3c!-- <div class="span width3-nopad align-left" style="min-width:80px;"> --\x3e\r\n\t\t\t\x3c!-- <div class="span left align-left" style="min-width:80px;"> --\x3e\r\n\t\t\t<div class="header-left">\r\n\t\t\t\t\x3c!-- Back Button --\x3e\r\n\t\t\t\t<div class="header-left-back">\r\n\t\t\t\t\x3c!-- ko with:$root.header --\x3e\r\n\t\t\t\t\t\x3c!-- ko with:$data.breadcrumb --\x3e\r\n\t\t\t\t\t\t\x3c!-- ko with:$data[$data.length-2] --\x3e\r\n\t\t\t\t\t\t\t<button name="back" class="btn btn-background btn-breadcrumb">\r\n\t\t\t\t\t\t\t\t<span class="ico-ios7 ico-back"></span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\r\n\t\t\t\t\t\t\x3c!-- ko if:$data.length<=1 --\x3e\r\n\t\t\t\t\t\t\t<button name="back" disabled class="btn btn-background">\r\n\t\t\t\t\t\t\t\t<span class="ico-ios7 ico-back-inv"></span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\x3c!-- /ko--\x3e\r\n\t\t\t\t\t\x3c!-- /ko --\x3e\r\n\t\t\t\t\x3c!-- /ko --\x3e\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t\x3c!-- User Picture --\x3e\r\n\t\t\t\t<div class="header-left-you">\r\n\t\t\t\t\t<button data-bind="style:{\'backgroundColor\': true ? \'\' + $data.initialsColour() : \'#ffffff\' }" id="header-user" name="yourpicture" class="btn btn-background btn-yourpicture" tabindex="0" style="line-height:48px;">\r\n\t\t\t\t\t\t<img data-bind="attr:{src:$data.icon}, css:{\'concealed\':$data.initials()!==\'\'}" class="concealed" style="width:40px; height:42px; margin:0;vertical-align:top;"></img>\r\n\t\t\t\t\t\t<p data-bind="html:$data.initials, css:{\'concealed\':$data.initials()==\'\'}" class="concealed font12">AM</p>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t\x3c!-- Place Icon --\x3e\r\n\t\t\t\t<div class="header-left-place">\r\n\t\t\t\t\t\x3c!-- ko if:$data.placeIcon --\x3e\r\n\t\t\t\t\t<button data-bind="style:{\'backgroundColor\': true ? \'\' + $data.placeInitialsColour() : \'#ffffff\' }" id="header-user" name="yourpicture" class="btn btn-background btn-placepicture" tabindex="1">\r\n\t\t\t\t\t\t<img data-bind="attr:{src:$data.placeIcon}, css:{\'concealed\':$data.placeInitials()!==\'\'}" class="concealed" style="width:32px; height:32px; margin: 0px 0px;" class="ico-ios7"></img>\r\n\t\t\t\t\t\t<p data-bind="html:$data.placeInitials, css:{\'concealed\':$data.placeInitials()==\'\'}" class="concealed font10"></p>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t\x3c!-- /ko --\x3e\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t\x3c!--\r\n\t\t\t\tCENTRE Panel\r\n\t\t\t--\x3e\r\n\t\t\t\x3c!-- <div class="span width5-nopad"> --\x3e\r\n\t\t\t<div class="header-centre">\r\n\t\t\t\t<div class="header-console">\r\n\r\n\t\t\t\t\t<div data-bind="css:{\'expanded\':$data.consoleExpanded()}" class="header-console-inner">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\x3c!-- Place Message --\x3e\r\n\t\t\t\t\t\t\t<p data-bind="html:$data.placeMessage" class="header-console-placemessage font10"></p>\r\n\r\n\t\t\t\t\t\t\t<p class="font8">recently visited</p>\r\n\t\t\t\t\t\t\t<div data-bind="foreach:$data.breadcrumbPlaces.array" class="flex-row flex-wrap">\r\n\t\t\t\t\t\t\t\t<button data-bind="click:$parent.breadcrumbPlacesFn,text:$data.label" class="btn btn-link font8"></button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class="header-shortcuts desktop">\r\n\r\n\t\t\t\t\t\x3c!-- Contacts --\x3e\r\n\t\t\t\t\t<div class="header-shortcuts-contacts">\r\n\t\t\t\t\t\t<button name="contacts" class="btn btn-background btn-contacts">\r\n\t\t\t\t\t\t\t<span class="ico-ios7 ico-contacts"></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\x3c!-- Notifications --\x3e\r\n\t\t\t\t\t<div class="header-shortcuts-notifications" >\r\n\t\t\t\t\t\t<button name="notifications" class="btn btn-background btn-notifications">\r\n\t\t\t\t\t\t\t<label data-bind="css:{\'concealed\':$data.notifications.count()<=0}, html:$data.notifications.count()" class="lbl lbl-ball is-small is-error"></label>\r\n\t\t\t\t\t\t\t<span class="ico-ios7 ico-flags"></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\x3c!-- Settings --\x3e\r\n\t\t\t\t\t<div class="header-shortcuts-settings">\r\n\t\t\t\t\t\t<button name="settings" class="btn btn-background btn-settings">\r\n\t\t\t\t\t\t\t<span class="ico-ios7 ico-settings"></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\x3c!-- Help --\x3e\r\n\t\t\t\t\t<div class="header-shortcuts-help">\r\n\t\t\t\t\t\t<button name="help" class="btn btn-background btn-help">\r\n\t\t\t\t\t\t\t<span class="ico-ios7 ico-info"></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\r\n\t\t\t\x3c!--\r\n\t\t\t\tRIGHT Panel\r\n\t\t\t--\x3e\r\n\t\t\t\x3c!-- <div class="span width2-nopad align-right" style=""> --\x3e\r\n\t\t\t<div class="header-right">\r\n\t\t\t\t\x3c!-- Flags --\x3e\r\n\t\t\t\t<div class="header-small-flags phone">\r\n\t\t\t\t\t<div data-bind="css:{\'new-notifications\':$data.notifications.count()>0}" class="ico-ios16 ico-flags"></div>\r\n\t\t\t\t\t<div class="">\x3c!-- Flags --\x3e</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t\x3c!-- More actions menu --\x3e\r\n\t\t\t\t<div data-bind="buttonmenu:$data.actions" class="header-more">\r\n\t\t\t\t\t<button class="btn btn-background"></button>\r\n\t\t\t\t\t<ul class="menu menu-dropdown" tabindex="99">\r\n\t\t\t\t\t\t<li><button data-bind="button:$data" type="button" class="btn btn-link"></button></li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t</div>\r\n\t\x3c!-- /ko --\x3e\r\n\x3c!-- /ko --\x3e\r\n'},function(e,t,n){var i,s;i=[n(1),n(2),n(0),n(4),n(14),n(87),n(88),n(89)],void 0===(s=function(e,t,n,i,s){var o;function r(n){o=this,this.name="toast",this.version="0.0.1",this._count=0,this._autoHide=!0,this._enabled=!1,this._timeout=4e3,this.mode=r.QUIET,this.kernel=n.kernel,this.model=n.model,this.pump=n.pump,this.runtime=n.runtime||{},this._flags={pumpSocketError:0},this.model.loader={value:e.observable(50),hidden:e.observable(!1)},n.model.snackBar={msg:e.observable(""),hidden:e.observable(!0)},n.model.toast=this.toast={messages:new s,tmpl:"toast-message"},this._toastEl=$("#toast"),this._toastEl.length>0&&(this._enabled=!0),__mixin(this,new i(n)),this.initEndpoint(this.name,[{className:"internal.system.toast.update",targetName:"toast"},{className:"pumpCo.event.achievement.updated",targetName:"toast"}]),this.registerPulseHandlers(),t.on("kernel.postservice",function(e){this.kernel.invoke("addConsoleMethod",{ns:"toast.show",fn:function(e){o.show(e)}}),this.kernel.invoke("addConsoleMethod",{ns:"toast.auto",fn:function(e){o.autoHide(e)}})},this),t.on("pump.socket-connected",function(e){this.show("Connection success.",!0,r.VERBOSE)},this),t.on("pump.socket-notconnected",function(e){var t="Connection problem<br>"+e.reason;this.show(t,!0,r.VERBOSE)},this),t.on("pump.socket-error",function(e){0===this._flags.pumpSocketError&&this.show("Your session has been inactive for too long. For security it has been disconnected. ",!1,r.SILENT,function(){t.fire("kernel.reboot",{})}),this._flags.pumpSocketError++},this),t.on("pump.socket-transport-failure",function(e){this.show("Connection transport.",!0,r.VERBOSE)},this),t.on("pump.socket-close",function(e){this.show("Connection closed.",!0,r.VERBOSE)},this),t.on("pump.socket-reconnect",function(e){e.reason,e.error;this.show("Connection reconnect",!0,r.VERBOSE)},this),t.on("header.signout",function(e){this.show("goodbye",!0)},this),t.on("site.add.start",function(e){this.showLoader("site.add.start")},this),t.on("place.add.start",function(e){this.showLoader("place.add.start")},this),t.on("space.show",function(e){this.showLoader("space.show")},this),t.on("space.shown",function(e){this.hideLoader("space.shown")},this),t.on("space.exception",function(e){this.hideLoader("space.exception")},this),t.on("place.shown",function(e){this.hideLoader("place.shown")},this),t.on("place.exception",function(e){this.hideLoader("place.exception")},this),this.kernel.addApi("toast.show",function(e){this.show(e.msg,!0)},this),this.kernel.addApi("toast.alert",function(e){this.show(e.msg,!1)},this),this.kernel.addApi("toast.okcancel",function(e){this.show(e.msg,!1,r.QUIET,{okFn:e.okFn,cancelFn:e.cancelFn})},this),this.kernel.addApi("snackbar.show",function(e){this.showSnackBar(e.msg)},this),this.kernel.addApi("snackbar.hide",function(e){this.hideSnackBar()},this),this.kernel.invoke("kernel.process.loaded",{name:this.name})}return r.SILENT=0,r.QUIET=1,r.CHATTY=2,r.VERBOSE=3,r.prototype={},r.prototype.registerPulseHandlers=function(){this.addPulseHandler("internal.system.toast.update",function(e){var t=__get("message",o.unwrapPulse(e));t&&this.show(t)}),this.addPulseHandler("pumpCo.event.achievement.updated",function(e){var t=__get("achievement",o.unwrapPulse(e));if(!t)return-1;var n=t.label||t.name;t&&this.show("congratulations, you have achieved "+n)})},r.prototype.unwrapPulse=function(e){var t=e.getPulseBody();return t||void 0},r.prototype.newToast=function(t,n,i,s){s=s||{};this._timeout;var r=function(e){var t=a.id;"ok"===e&&s.okFn&&s.okFn.call(this),"cancel"===e&&s.cancelFn&&s.cancelFn.call(this),setTimeout(function(){o.purge(t)},1e3),a.visible(!1)},a=(i&&setTimeout(r,1e3),{visible:e.observable(!0),id:t,msg:n,auto:i,btnOk:function(){r("ok")},btnCancel:s.cancelFn?function(){r("cancel")}:void 0});return a},r.prototype.show=function(e,t,n,i){if(i=i||{},n=n||r.QUIET,this._enabled){t=void 0===t?this._autoHide:t;var s=this._count++;n<=this.mode&&this.toast.messages.insert(this.newToast(s,e,t,i))}},r.prototype.purge=function(e){this.toast.messages.remove(e)},r.prototype.autoHide=function(e){return void 0!==e&&(this._autoHide=e),this._autoHide},r.prototype.showSnackBar=function(e){this.model.snackBar.msg(e),this.model.snackBar.hidden(!1)},r.prototype.hideSnackBar=function(){this.model.snackBar.hidden(!0)},r.prototype.incLoader=function(){this.model.loader.value()<100&&(this.model.loader.value(this.model.loader.value()+1),!1===this.model.loader.hidden()&&setTimeout(this.incLoader.bind(this),200))},r.prototype.showLoader=function(e){!0===this.model.loader.hidden()&&(this.model.loader.hidden(!1),this.model.loader.value(50),setTimeout(this.incLoader.bind(this),200))},r.prototype.hideLoader=function(e){this.model.loader.value(50),this.model.loader.hidden(!0)},r.prototype.userOkCancel=function(e){console.log("Toast: userOkCancel")},r.prototype.toString=function(){return this.name+":"+this.version},r}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){e.bindingHandlers.toast={makeCardAccessor:function(t){return function(){var n=t(),i=e.utils.peekObservable(n),s=void 0!==i?i.messages.data():[],o=void 0!==i?i.tmpl:"tmpl";return e.utils.unwrapObservable(n),{foreach:s,templateEngine:e.nativeTemplateEngine.instance,name:o}}},init:function(t,n,i,s,o){var r=e.bindingHandlers.toast.makeCardAccessor(n);return e.bindingHandlers.template.init(t,r),{controlsDescendantBindings:!0}},update:function(t,n,i,s,o){var r=e.bindingHandlers.toast.makeCardAccessor(n);return e.bindingHandlers.template.update(t,r,i,s,o),{controlsDescendantBindings:!0}}}}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){e.bindingHandlers.snackbar={makeCardAccessor:function(t){return function(){var n=t();e.utils.peekObservable(n);return{data:n,templateEngine:e.nativeTemplateEngine.instance,name:"snackbar-template"}}},init:function(t,n,i,s,o){if(e.utils.unwrapObservable(n())){var r=e.bindingHandlers.snackbar.makeCardAccessor(n);e.bindingHandlers.template.init(t,r)}return{controlsDescendantBindings:!0}},update:function(t,n,i,s,o){var r=e.utils.unwrapObservable(n());if(r){var a=e.bindingHandlers.snackbar.makeCardAccessor(n);e.utils.toggleDomNodeCssClass(t,"concealed",r.hidden()),e.utils.toggleDomNodeCssClass(t,"slideInUp",!r.hidden()),e.utils.toggleDomNodeCssClass(t,"animated",!r.hidden()),e.bindingHandlers.template.update(t,a,i,s,o)}return{controlsDescendantBindings:!0}}}}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){e.bindingHandlers.loader={init:function(t,n,i,s,o){e.utils.unwrapObservable(n());return{controlsDescendantBindings:!0}},update:function(t,n,i,s,o){var r=e.utils.unwrapObservable(n());return r&&(e.utils.toggleDomNodeCssClass(t,"concealed",r.hidden()),t.setAttribute("style","width:"+r.value()+"%")),{controlsDescendantBindings:!0}}}}.apply(t,i))||(e.exports=s)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(15),__webpack_require__(1),__webpack_require__(2),__webpack_require__(0),__webpack_require__(4)],__WEBPACK_AMD_DEFINE_RESULT__=function(Abstract,ko,events,Log,Endpoint){var _this,_super=Abstract.prototype;function Card(e){_this=this,Abstract.call(this,e),this.name="card",this.current=void 0,__mixin(this,new Endpoint(e)),this.initEndpoint(this.name,[{className:"pumpCo.roadie.visit.request",targetName:"PumpHouse"},{className:"internal.service.card.requires.request",targetName:this.name},{className:"internal.service.card.requires.response",targetName:"PumpHouse"},{className:"pumpCo.user.card.spec.get.request",targetName:"PumpHouse"},{className:"pumpCo.user.card.spec.get.response",targetName:this.name}]),this.addPulseHandler("internal.service.card.requires.request",this.requiresPulse),this.addPulseHandler("pumpCo.user.card.spec.get.response",this.cardSpecResponse),this.model.card=this.card={},this.card.loadedCards={},this.card.waitingCards={},this.ready(this.name)}return Card.prototype=Object.create(_super),Card.prototype.loadCard=function(e){if(e.name||Log.LogFactory().emergency("Service.Card: Invalid Card Spec, no name specified","services/card"),_this.card.loadedCards[e.name]=!0,!e.script||""===e.script)return-1;var t=e.script;return the.isArray(e.script)&&(t=e.script.join("\n")),e.html&&""!==e.html?(_this.invokeHtml(e.name,e.html),_this.invokeJs(t,e.params),0):-2},Card.prototype.invokeJs=function(_content,_params){var my={$error:log.error},params=_params;eval(_content)},Card.prototype.invokeHtml=function(e,t){var n=phil.resolveComments(t);phil.injectTmpl(e,n)},Card.prototype.requiresPulse=function(e){var t=e.getPulseBody(),n=e.getPulseHeader();t.cards&&(_this.card.waitingCards[n.componentId]={cards:t.cards,refId:n.referenceId},_this.requires(t.cards,n.componentId))},Card.prototype.requires=function(e,t){for(var n=[],i=0;i<e.length;i++)cardName=e[i],this.card.loadedCards[cardName]||n.push({name:cardName});if(n.length>0)_this.requestCards(n,t);else{var s=this.card.waitingCards[t];_this.internalServiceCardRequiresResponse(s.cards,t,s.refId)}},Card.prototype.requestCards=function(e,t){0===e.length&&_this.loadedRequiredCards();var n="routing-override::"+_this.name;this.pulse("pumpCo.user.card.spec.get.request",{card:e},n,t)},Card.prototype.cardSpecResponse=function(e){for(var t=e.getPulseBody(),n=e.getPulseHeader(),i=t.card,s=0;s<i.length;s++){var o=i[s];_this.loadCard(o)}var r=n.requestingComponentId;Log.LogFactory().debug("CardService: CardId="+r,"services/card");var a=this.card.waitingCards[r];this.internalServiceCardRequiresResponse(a.cards,r,a.refId)},Card.prototype.internalServiceCardRequiresResponse=function(e,t,n){this.pulse("internal.service.card.requires.response",{card:e,loaded:"success",compId:t},n,t)},Card.prototype.loadedRequiredCards=function(){},Card}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,n){var i,s;i=[n(15),n(4),n(1),n(2),n(0)],void 0===(s=function(e,t,n,i,s){var o=e.prototype,r="services.clipboard.data";function a(n){e.call(this,n),this.name="clipboard",__mixin(this,new t(n)),this.initPulsing(),this.ready(this.name)}return a.prototype=Object.create(o),a.prototype.initPulsing=function(){this.initEndpoint(this.name,[{className:"internal.clipboard.copy.request",targetName:this.name},{className:"internal.clipboard.copy.response",targetName:"PumpHouse"},{className:"internal.clipboard.paste.request",targetName:this.name},{className:"internal.clipboard.paste.response",targetName:"PumpHouse"}]),this.addPulseHandler("internal.clipboard.copy.request",this.internalCopyRequest.bind(this)),this.addPulseHandler("internal.clipboard.paste.request",this.internalPasteRequest.bind(this))},a.prototype.internalCopyRequest=function(e){s.LogFactory().debug("Clipboard.internalCopyRequest()","services/clipboard");var t=e.getPulseBody();if(!t.type||!t.obj)return-1;this.clip(t.obj,t.type)},a.prototype.internalPasteRequest=function(e){s.LogFactory().debug("Clipboard.internalPasteRequest()","services/clipboard");var t=this.view();this.clear(),this.pulse("internal.clipboard.paste.response",{clipboard:t})},a.prototype.createClipObject=function(e,t){if(e&&t){var n=void 0;try{n={type:e,obj:JSON.stringify(t)}}catch(e){s.LogFactory().error("ClipBoard: Error stringifying object to JSON.","services/clipboard")}return n}},a.prototype.restoreClipObject=function(e){if(e){var t=void 0;try{var n=JSON.parse(e.obj);t={type:e.type,obj:n}}catch(e){s.LogFactory().error("ClipBoard: Error parsing object from JSON.","services/clipboard")}return t}},a.prototype.clip=function(e,t){t=t||"unknown";var n=this.createClipObject(t,e);if(n){var i=this.kernel.invoke("roadie.release",{key:r});i||(i=[]),i.splice(0,0,n),this.kernel.invoke("roadie.hold",{key:r,obj:i})}},a.prototype.view=function(e){for(var t=this.kernel.invoke("roadie.peek",{key:r}),n=[],i=0;i<t.length;i++){var s=this.restoreClipObject(t[i]);void 0!==e&&s.type!==e||n.splice(0,0,s)}return n},a.prototype.unclip=function(e){for(var t=this.kernel.invoke("roadie.release",{key:r}),n=[],i=(e=the.quickSort(e)).length-1;i>=0;i--){var s=e[i],o=t.splice(s,1);if(o&&1===o.length){var a=this.restoreClipObject(o[0]);n.splice(n.length,0,a)}}return this.kernel.invoke("roadie.hold",{key:r,obj:t}),n},a.prototype.clear=function(){this.kernel.invoke("roadie.hold",{key:r,obj:[]})},a.prototype.toString=function(){return this.name+":"+this.version},a}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(15),n(4),n(2),n(0),n(93),n(94)],void 0===(s=function(e,t,n,i,s,o){var r=e.prototype;function a(n){e.call(this,n),this.name="environment",__mixin(this,new t(n)),this.initEvents(),this.browser=new s,this.cordova=new o,this._current=this.cordova.available?this.cordova:this.browser,this._current.init(),this.ready(this.name)}return a.prototype=Object.create(r),a.prototype.initEvents=function(){this.initEndpoint(this.name,[{className:"internal.environment.check.request",targetName:this.name},{className:"internal.environment.check.response",targetName:"PumpHouse"}]),this.kernel.addApi("environment.get.env",this.eventEnvironmentGetEnv,this)},a.prototype.supports=function(e){return this._current.supports(e)},a.prototype.eventEnvironmentGetEnv=function(e){return{browser:this.browser.available,cordova:this.cordova.available,device:this._current.supports("device"),batteryStatus:this._current.supports("batteryStatus"),pwa:this._current.supports("pwa")}},a.prototype.eventEnvironmentUserPrompt=function(e){this._current.promptUser(e)},a.prototype.toString=function(){return this.name+":"+this.version},a}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2)],void 0===(s=function(e){function t(){this.name="browserplugin",this._supports={batteryStatus:null,device:null,pwa:null},this._installEvent=void 0,this.supports("device"),this.available=this.isAvailable()}return t.prototype={},t.prototype.init=function(){this.supports("batteryStatus"),this.supports("device"),this.supports("pwa"),this.attachEventHandlers()},t.prototype.attachEventHandlers=function(){var e=null,t=null;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document.addEventListener(t,function(t){!0===document[e]||this.delayedEvent("platform.resume",1e3)}.bind(this),!1)},t.prototype.delayedEvent=function(t,n){this._delayedEvent&&clearTimeout(this._delayedEvent),this._delayedEvent=setTimeout(function(){e.fire("platform.resume")},n)},t.prototype.isAvailable=function(){return"undefined"!=typeof window},t.prototype.supports=function(e){return e?null===this._supports[e]?(console.log("supports "+e),this._supports[e]=this["test_"+e].call(this),this._supports[e]):void 0:Object.keys(this._supports)},t.prototype.test_batteryStatus=function(){var e={level:"na"};return navigator.getBattery&&(e.level="100%"),e},t.prototype.test_device=function(){return{desktop:the.isDesktop,cordova:!1,uuid:"na",version:navigator.appVersion}},t.prototype.test_pwa=function(){var e=!1;return!0===window.navigator.standalone&&(e=!0),!0===window.matchMedia("(display-mode: standalone)").matches&&(e=!0),window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),this._installEvent=event,console.log("ON: BeforeInstallPrompt"),kernel.invoke("toast.okcancel",{msg:"Install PWA",okFn:function(){this._installEvent.prompt()}.bind(this),cancelFn:function(){}})}.bind(this),!1),window.addEventListener("appinstalled",function(){console.log("ON: appinstalled")}),{isPinned:e}},t.prototype.promptUser=function(){this._installEvent.userChoice.then(function(e){"accepted"===e.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),deferredPrompt=null})},t}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(2),n(0)],void 0===(s=function(e,t){function n(e){this.name="cordovaplugin",this._supports={batteryStatus:"undefined",camera:"undefined",console:"undefined",contacts:"undefined",device:"undefined",deviceMotion:"undefined",deviceOrientation:"undefined",dialogs:"undefined",fileSystem:"undefined",fileTransfer:"undefined",geolocation:"undefined",globalisation:"undefined",inAppBrowser:"undefined",media:"undefined",mediaCapture:"undefined",networkInformation:"undefined",splashScreen:"undefined",statusBar:"undefined",vibration:"undefined"},this.available=this.isAvailable()}return n.prototype={},n.prototype.init=function(){this.supports("batteryStatus"),this.supports("device"),this.attachEventHandlers()},n.prototype.attachEventHandlers=function(){function t(t){e.fire("platform."+t.type,t)}for(var n=["pause","backbutton","menubutton","volumeupbutton","volumedownbutton"],i=0;i<n.length;i++)document.addEventListener(n[i],t.bind(this),!1);document.addEventListener("resume",function(e){this["_delayed"+e]&&clearTimeout(this["_delayed"+e]),setTimeout(function(){t.call(this,e)}.bind(this),1e3)}.bind(this),!1)},n.prototype.isAvailable=function(){return!!window.cordova},n.prototype.supports=function(e){return e?this._supports[e]?this["test_"+e].call(this):void 0:Object.keys(this._supports)},n.prototype.test_batteryStatus=function(){return this.available&&"undefined"===this._supports.batteryStatus&&(this._supports.batteryStatus={level:"100%"}),this._supports.batteryStatus},n.prototype.test_device=function(){return this.available&&"undefined"===this._supports.device&&window.device&&(this._supports.device=window.device),this._supports.device},n}.apply(t,i))||(e.exports=s)},function(e,t,n){var i,s;i=[n(1)],void 0===(s=function(e){return e.bindingHandlers.body={init:function(t,n,i,s,o){var r=n();return r&&r.sites&&(0===r.sites().length?e.utils.toggleDomNodeCssClass(t,"os-loading",!0):e.utils.toggleDomNodeCssClass(t,"os-background",!0)),{controlsDescendantBindings:!1}},update:function(t,n,i,s,o){var r=n();if(r&&r.sites){0===r.sites().length?(e.utils.toggleDomNodeCssClass(t,"os-loading",!0),e.utils.toggleDomNodeCssClass(t,"os-background",!1)):(e.utils.toggleDomNodeCssClass(t,"os-loading",!1),e.utils.toggleDomNodeCssClass(t,"os-background",!0));var a=__get("kernel.platform",r);a&&null!==a.size&&(e.utils.toggleDomNodeCssClass(t,"os-small",!1),e.utils.toggleDomNodeCssClass(t,"os-medium",!1),e.utils.toggleDomNodeCssClass(t,"os-large",!1),e.utils.toggleDomNodeCssClass(t,"os-"+a.size,!0),e.utils.toggleDomNodeCssClass(t,"os-landscape",!1),e.utils.toggleDomNodeCssClass(t,"os-portrait",!1),e.utils.toggleDomNodeCssClass(t,"os-"+a.orient,!0))}return{controlsDescendantBindings:!1}}},e.bindingHandlers.stopBinding}.apply(t,i))||(e.exports=s)},function(e,t){Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,s=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(s,t,o,n))return t})},function(e,t){!function(){"use strict";var e=Math.random,t=0,n="gwm"+e(),i={},s=Object.prototype.hasOwnProperty,o=Object.defineProperty,r=Object.defineProperties,a={enumerable:!1};function c(){if(!(this instanceof c))return new c;o(this,"__wm__",{value:{}}),this.clear()}function u(e,t,n){var i,s=(e=e.__wm__).key,o=l(t);return o?o&&s in o?o[s]:n:(i=e.keys.indexOf(t))<0?n:e.values[i]}function l(e,t){var i,r,a,c,u=Object.getOwnPropertyDescriptor(e,"constructor");return u&&s.call(u,"get")&&(i=r=u.get,a=u.set,s.call(i,n))?i[n]:t&&!(Object.isSealed(e)||u&&!u.configurable)?(i?(i=i.bind(),Object.getOwnPropertyNames(r).forEach(function(e){i[e]=r[e]})):(c=e.constructor,i=function(){return c},a=function(e){c=e}),o(e,"constructor",{get:i,set:a}),i[n]=Object.create(null)):void 0}function p(){if(!(this instanceof p))return new p;o(this,"__wm__",{value:{}}),this.clear()}function d(e,t,n){return Object(n)!==n?(1/n==-1/0?t:t.primitives)[n]:c.prototype.get.call(e,n)}function h(e,t,n,i){return Object(n)!==n?(1/n==-1/0?t:t.primitives)[n]=i:c.prototype.set.call(e,n,i)}function m(){if(!(this instanceof m))return new m;o(this,"__wm__",{value:{}}),this.clear()}c.prototype={clear:function(){var n=this.__wm__;n.key="c"+e()+t++,n.keys=[],n.values=[]},get:function(e){return u(this,e)},set:function(e,t){var n,i=this.__wm__,s=i.keys,o=i.values,r=l(e,1);r?r[i.key]=t:(n=s.indexOf(e))<0?(s.push(e),o.push(t)):o[n]=t},has:function(e){return u(this,e,i)!==i},delete:function(e){var t,n=this.__wm__,i=n.keys,s=l(e);if(s){if(s[n.key])return delete s[n.key],!0}else if((t=i.indexOf(e))>=0)return i.splice(t,1),n.values.splice(t,1),!0;return!1}},r(c.prototype,{clear:a,get:a,set:a,has:a,delete:a}),p.prototype={clear:function(){c.prototype.clear.call(this);var e=this.__wm__;e._keys=[],e._values=[],e.primitives={}},get:function(e){var t=this.__wm__;return t._values[d(this,t,e)]},set:function(e,t){var n=this.__wm__,i=d(this,n,e);void 0==i&&h(this,n,e,i=n._keys.push(e)-1),n._values[i]=t},has:function(e){return void 0!=d(this,this.__wm__,e)},delete:function(e){var t=this.__wm__,n=d(this,t,e);return void 0!=n&&(h(this,t,e,void 0),delete t._keys[n],delete t._values[n],!0)},forEach:function(e,t){var n=this.__wm__;n._keys.forEach(function(i,s){e.call(t,n._values[s],i,this)},this)},get size(){return Object.keys(this.__wm__._keys).length}},r(p.prototype,{clear:a,get:a,set:a,has:a,delete:a,forEach:a,size:a}),m.prototype={add:function(e){var t=this.__wm__,n=this.__wm__.map;n.has(e)||n.set(e,t.values.push(e)-1)},delete:function(e){var t=this.__wm__,n=this.__wm__.map,i=n.get(e);return i>=0&&(n.delete(e),t.values.splice(i,1),!0)},has:function(e){return this.__wm__.map.has(e)},clear:function(){var e=this.__wm__;e.values=[],e.map=new p},forEach:function(e,t){for(var n=0,i=this.__wm__.values;n<i.length;)e.call(t,i[n++],this)},get size(){return this.__wm__.values.length}},r(m.prototype,{clear:a,add:a,has:a,delete:a,forEach:a,size:a});var f=this||window;f.WeakMap=f.WeakMap||c.bind(),f.Map=f.Map||p.bind(),f.Set=f.Set||m.bind()}()},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])}return n},writable:!0,configurable:!0})}]);